Ext.ns("LBUI","LBUI.grid","LBUI.tree","LBUI.ctrl","LBUI.data","LBUI.form");Ext.ns("LBOP");Ext.Toolbar.prototype.enableOverflow=true;Ext.grid.EditorGridPanel.prototype.clicksToEdit=1;Date.prototype.getElapsed=function(a){return Math.abs((a||new Date()).getTime()-this.getTime())};Ext.data.JsonWriter.prototype.toHash=function(e){var d=e.fields.map,c={},b=(this.writeAllFields===false&&e.phantom===false)?e.getChanges():e.data,a;Ext.iterate(b,function(g,f){if((a=d[g])){c[a.mapping?a.mapping:a.name]=f}});c[this.meta.idProperty]=e.id;return c};LBUI.watingResponseTimeout=3000;LBUI.Events=new Ext.util.Observable({});LBUI.CmdType=function(){return{dialog:1,newWindow:2,noValidateCheck:5,mainFrame:6,topWindow:7,parentWindow:8}}();LBUI.RecordType=function(){return{freedom:0,current:1,check:2,edit:3,all:4,edit_check:5,isVerifyCheck:function(a){return(a===this.check||a===this.edit_check)},isVefiryEdit:function(a){return(a===this.edit||a===this.edit_check)}}}();LBUI.RefreshType=function(){return{clientRefresh:2,masterRefresh:3}}();LBUI.LBObjValue=function(a){if(a.value){return a.value}if(a.text){return a.text}return a};LBUI.LBObjDisplay=function(a){if(a.text){return a.text}if(a.value){return a.value}return a};Ext.data.SortTypes.asLBObj=function(a){return LBUI.LBObjValue(a)};Ext.Element.prototype.getAlignToXY=function(f,z,A){f=Ext.get(f);if(!f||!f.dom){throw"Element.alignToXY with an element that doesn't exist"}A=A||[0,0];z=(z=="?"?"tl-bl?":(!/-/.test(z)&&z!==""?"tl-"+z:z||"tl-bl")).toLowerCase();var J=this,G=J.dom,L,K,l,k,q,E,u,s=Ext.lib.Dom.getViewWidth()-10,F=Ext.lib.Dom.getViewHeight()-10,b,g,i,j,t,v,M=document,I=M.documentElement,n=M.body,D=(I.scrollLeft||n.scrollLeft||0)+5,C=(I.scrollTop||n.scrollTop||0)+5,H=false,e="",a="",B=z.match(/^([a-z]+)-([a-z]+)(\?|\*)?$/);if(!B){throw"Element.alignTo with an invalid alignment "+z}e=B[1];a=B[2];H=!!B[3];L=J.getAnchorXY(e,true);K=f.getAnchorXY(a,false);l=K[0]-L[0]+A[0];k=K[1]-L[1]+A[1];if(H){q=J.getWidth();E=J.getHeight();u=f.getRegion();b=e.charAt(0);g=e.charAt(e.length-1);i=a.charAt(0);j=a.charAt(a.length-1);t=((b=="t"&&i=="b")||(b=="b"&&i=="t"));v=((g=="r"&&j=="l")||(g=="l"&&j=="r"));if(l+q>s+D){l=v?u.left-q:s+D-q}if(l<D){l=v?u.right:D;if((l+q>s+D)&&B[3]==="*"){l=D}}if(k+E>F+C){k=t?u.top-E:F+C-E}if(k<C){k=t?u.bottom:C;if(k+E>F+C&&B[3]==="*"){k=C}}}return[l,k]};Ext.namespace("Ext.ux.tree");Ext.ux.tree.State=function(a){Ext.apply(this,a)};Ext.extend(Ext.ux.tree.State,Ext.util.Observable,{init:function(a){this.tree=a;if(Ext.isEmpty(this.stateName)){this.stateName="TreeState_"+this.tree.id}this.idField=this.idField||"id";if(!this.provider){if(this.sessionState){this.provider=new Ext.state.CookieProvider({expires:null})}else{this.provider=Ext.state.Manager.getProvider()||new Ext.state.CookieProvider()}}this.state=this.provider.get(this.stateName,{});this.tree.on({scope:this,collapsenode:this.onCollapse,expandnode:this.onExpand,append:this.onNodeAdded})},saveState:function(a){this.state=a||this.state;this.provider.set(this.stateName,this.state)},onNodeAdded:function(b,a,d,c){switch(this.state[d.id]){case"C":d.expanded=false;break;case"E":d.expanded=true;break}},onExpand:function(a){this.state[a.id]="E";this.saveState()},onCollapse:function(a){this.state[a.id]="C";this.saveState()}});LBUI.grid.CheckColumn=function(a){a=a||{};a=Ext.apply(a||{},{header:'<div class="x-grid3-check-col">&#160;</div>',menuDisabled:true,fixed:true,editable:false,width:30,locked:true,resizable:false,sortable:false,pluginsMode:true});if(!a.dataIndex){a.dataIndex="checkbox"}Ext.apply(this,a);if(!this.id){this.id=Ext.id()}};Ext.extend(LBUI.grid.CheckColumn,Ext.grid.Column,{init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this);if(b.lockedBody){b.lockedBody.on("mousedown",this.onMouseDown,this)}Ext.fly(b.innerHd).on("mousedown",this.onHdMouseDown,this);if(b.lockedHd){Ext.fly(b.lockedHd).on("mousedown",this.onHdMouseDown,this)}var c=this.grid.getStore();c.on("load",this.onLoad,this)},this)},onLoad:function(){try{var a=this.grid.getView();var b=Ext.fly(a.innerHd);if(b){var d=b.child("DIV[class*=x-grid3-check-col-on]");if(d){d.replaceClass("x-grid3-check-col-on","x-grid3-check-col")}}if(a.lockedHd){var d=Ext.fly(a.lockedHd).child("DIV[class*=x-grid3-check-col-on]");if(d){d.replaceClass("x-grid3-check-col-on","x-grid3-check-col")}}}catch(c){}},onMouseDown:function(f,d){if(d.className&&d.className.indexOf("x-grid3-cc-"+this.id)!=-1){f.stopEvent();var b=this.grid.getView();var c=b.findRowIndex(d);var a=this.grid.store.getAt(c);a.data[this.dataIndex]=!a.data[this.dataIndex];b.refreshRow(a);if(b.syncHeights&&b.processRows){b.processRows(c,true)}}},onHdMouseDown:function(d,b){if(b.className&&b.className.indexOf("x-grid3-check-col")!=-1){d.stopEvent();var c=Ext.fly(b);var f=c.hasClass("x-grid3-check-col-on");if(f){c.replaceClass("x-grid3-check-col-on","x-grid3-check-col");this.clearAllCheckbox()}else{c.replaceClass("x-grid3-check-col","x-grid3-check-col-on");this.selectAllCheckbox()}var a=this.grid.getView();a.refresh()}},renderer:function(b,c,a){c.css+=" x-grid3-check-col-td";return'<div class="x-grid3-check-col'+(b?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'},clearAllCheckbox:function(){for(r=0;(r<this.grid.store.getCount());r++){var a=this.grid.store.getAt(r);a.data[this.dataIndex]=false}},selectAllCheckbox:function(){for(r=0;(r<this.grid.store.getCount());r++){var a=this.grid.store.getAt(r);a.data[this.dataIndex]=true}}});LBUI.grid.RowSelectionModel=Ext.extend(Ext.grid.RowSelectionModel,{rowSelectedId:"rowSelected",alwaysSelected:true,viewScroll:null,initEvents:function(){LBUI.grid.RowSelectionModel.superclass.initEvents.call(this);var a=this.grid.view;a.on("beforerefresh",this.onBeforeRefresh,this)},onBeforeRefresh:function(){this.viewScroll=this.grid.view.getScrollState()},doSelectRow:function(b){this.selectRow(b,true);var a=this;setTimeout(function(){if(a.viewScroll){a.grid.view.restoreScroll(a.viewScroll)}a.grid.view.focusRow(b);a.viewScroll=null},150)},onRefresh:function(){var c=this.grid.store,h;var k=this.getSelections();this.clearSelections(true);var d=false;if(!this.hasSelection()){for(var e=0,j=c.getCount();(e<j);e++){var b=c.getAt(e);if(b.data[this.rowSelectedId]){d=true;var f=0;var g=k.length;for(;f<g;f++){var a=k[f];if((e==c.indexOfId(a.id))){break}}if(f==g){this.viewScroll=null}this.doSelectRow(e);if(this.singleSelect){break}}}}if(d===false){for(var e=0,j=k.length;e<j;e++){var b=k[e];if((h=c.indexOfId(b.id))!=-1){this.doSelectRow(h,false);if(this.singleSelect){break}}}}if(this.alwaysSelected&&!this.hasSelection()){if(c.getCount()>0){this.selectFirstRow()}else{if(k.length>0){this.fireEvent("selectionclear",this)}}d=true}if(d||k.length!=this.selections.getCount()){this.fireEvent("selectionchange",this)}},onEditorKey:function(m,j){var d=j.getKey(),f,h=this.grid,n=h.lastEdit,i=h.activeEditor,o,n,a,l;var b=j.shiftKey;if(d==j.TAB){j.stopEvent();i.completeEdit();if(b){f=h.walkCells(i.row,i.col-1,-1,this.acceptsNav,this)}else{f=h.walkCells(i.row,i.col+1,1,this.acceptsNav,this)}}else{if(d==j.ENTER){if(this.moveEditorOnEnter!==false){if(b){f=h.walkCells(n.row-1,n.col,-1,this.acceptsNav,this)}else{f=h.walkCells(n.row+1,n.col,1,this.acceptsNav,this)}}}}if(f){a=f[0];l=f[1];if(n.row!=a){this.selectRow(a)}if(h.isEditor&&h.editing){o=h.activeEditor;if(o&&o.field.triggerBlur){try{o.field.triggerBlur()}catch(j){}}}(function(){try{h.startEditing(a,l)}catch(c){}}).defer(100)}}});LBUI.Tip=function(){var b;function a(e,f,d){var c=['<div class="msg">','<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>','<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc">','<table><tr><td class="lb-tip-header">'];if(e&&e.length>0){c.push(["<h3>",e,"</h3>"].join(""))}c.push('</td><td width="16px" align="right" rowspan=2 valign="top"><div class="lb-icon-close"></div></td></tr>');c.push("<tr><td>");if(d){if(d.indexOf("icon:")==0){d=d.substring(5);c.push(['<div class="lb-tip-icon"><img src="',d,'" ></div>'].join(""))}else{c.push(['<div class="lb-tip-icon ',d,'"></div>'].join(""))}c.push('<div class="lb-tip-text">')}c.push(f);if(d){c.push("</div>")}c.push("</td></tr></table>");c.push(["</div></div></div>",'<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div>',"</div>"].join(""));return c.join("")}return{msg:function(f,e,c){var d=String.format.apply(String,Array.prototype.slice.call(arguments,1));this.show(f,d,3,c)},error:function(f,e,c){var d=String.format.apply(String,Array.prototype.slice.call(arguments,1));this.show(f,d,10,c||"lb-tip-error")},alert:function(f,e,c){var d=String.format.apply(String,Array.prototype.slice.call(arguments,1));this.show(f,d,5,c||"lb-tip-warn")},show:function(h,f,d,e){if(!b){b=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},true)}var c=Ext.DomHelper.append(b,{html:a(h,f,e)},true);c.slideIn("t");var g=setTimeout(function(){c.ghost("t",{remove:true})},d*1000);c.on({click:function(k,j,l){var i=Ext.fly(j);if(i.hasClass("lb-icon-close")){if(g){clearTimeout(g)}c.ghost("t",{remove:true})}}})}}}();LBUI.PagingToolbar=Ext.extend(Ext.PagingToolbar,{pageNo:0,onLoad:function(b,e,i){if(!this.rendered){this.dsLoaded=[b,e,i];return}var f=this.getParams();if(b.getTotalCount()>0){var a=b.getAt(0);if(a&&a.data.lbPageInfo){this.pageSize=a.data.lbPageInfo.pageSize;this.pageNo=a.data.lbPageInfo.pageNo;this.cursor=(this.pageNo-1)*this.pageSize}else{this.cursor=(i.params&&i.params[f.start])?i.params[f.start]:0}}else{this.cursor=0}if(this.cursor<0){this.cursor=0}var h=this.getPageData(),c=h.activePage,g=h.pages;this.afterTextItem.setText(String.format(this.afterPageText,h.pages));this.inputItem.setValue(c);this.first.setDisabled(c==1);this.prev.setDisabled(c==1);this.next.setDisabled(c==g);this.last.setDisabled(c==g);this.refresh.enable();this.updateInfo();this.fireEvent("change",this,h)}});LBUI.RecordNavigatorToolbar=Ext.extend(LBUI.PagingToolbar,{displayInfo:false,firstText:"第一条",prevText:"前一条",nextText:"下一条",lastText:"最后一条",afterPageText:"条  共 {0} 条",doLoad:function(b){var a={};if(Ext.isNumber(b)){a.Navigate=b}else{Ext.apply(a,b)}if(this.fireEvent("beforechange",this,a)!==false){this.store.load({params:a})}},moveFirst:function(){this.doLoad({Navigate:"first"})},movePrevious:function(){this.doLoad({Navigate:"prev"})},moveNext:function(){this.doLoad({Navigate:"next"})},moveLast:function(){this.doLoad({Navigate:"last"})},refresh:function(){this.doLoad({})}});LBUI.grid.ExtendProto={autoAdjustColumnWidth:true,autoAdjustMaxWidth:360,initComponentEx:function(){var a=this.getColumnModel();for(var b=0;b<a.getColumnCount();b++){var d=a.config[b];if(d.pluginsMode){this.initPlugin(d)}}this.on("afterrender",function(c){try{if(this.autoAdjustColumnWidth){if(c.getStore().getCount()<1){c.getStore().on("datachanged",c.adjustColumnWidth,c,{single:true,delay:100})}else{c.adjustColumnWidth()}}c.getSelectionModel().onRefresh()}catch(f){}},this,{single:true,delay:10})},adjustColumnWidth:function(){try{var h=this.getColumnModel();var k=this.getView();var m=this.getStore();var b=false;for(var d=0;d<h.getColumnCount();d++){var g=h.config[d];if(!g.fixed&&!g.hidden){var l=g.width;if(g.id===this.master_column_id){l+=120}for(var a=0;(a<m.getCount()&&a<20);a++){var j=k.getCell(a,d);if(l<j.children[0].scrollWidth){l=j.children[0].scrollWidth+4}}if(l>this.autoAdjustMaxWidth){l=this.autoAdjustMaxWidth}if(l!=g.width){h.setColumnWidth(d,l,true);b=true}}}if(b){k.updateAllColumnWidths()}}catch(f){}}};LBUI.GridPanel=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){LBUI.GridPanel.superclass.initComponent.call(this);this.initComponentEx()}});Ext.override(LBUI.GridPanel,LBUI.grid.ExtendProto);LBUI.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{initComponent:function(){LBUI.EditorGridPanel.superclass.initComponent.call(this);this.store.on({scope:this,write:this.onWrite,beforesave:this.onBeforeSave,exception:this.onWriteException});this.initComponentEx()},onWrite:function(c,e,a,d,b){LBUI.requestTime=null;if(d.message&&d.message!==""){LBUI.Tip.alert("",d.message)}},onWriteException:function(d,e,f,b,c,a){LBUI.requestTime=null;if(e==="remote"){if(c.message&&c.message!==""){LBUI.Tip.error("错误",c.message)}}},postEditValue:function(d,a,b,e){if(Ext.isDate(d)){var f=this.colModel.getColumnById(e);if(f&&f.editor&&f.valType==="text"){return f.editor.field.formatDate(d)}}return this.autoEncode&&typeof d=="string"?Ext.util.Format.htmlEncode(d):d},onAdd:function(){var a=new this.store.recordType({});this.stopEditing();this.store.insert(0,a);this.startEditing(0,1)},onDelete:function(){this.stopEditing(true);var a=this.getSelectionModel().getSelected();if(!a){return false}this.store.remove(a)},onSave:function(){this.store.save()},onBeforeSave:function(a,b){LBUI.requestTime=new Date()}});LBUI.checkRequestTime=function(b,a,c){if(LBUI.requestTime&&(new Date().getTime()-LBUI.requestTime.getTime())<(c||LBUI.watingResponseTimeout)){(function(){LBUI.checkRequestTime(b,a,c)}).defer(30)}else{b.call(a)}};Ext.override(LBUI.EditorGridPanel,LBUI.grid.ExtendProto);LBUI.form.BasicForm=Ext.extend(Ext.form.BasicForm,{onSubmit:function(a){}});LBUI.FormPanel=Ext.extend(Ext.FormPanel,{popup:false,createForm:function(){var a=Ext.applyIf({listeners:{}},this.initialConfig);return new LBUI.form.BasicForm(this.formId,a)},reloadDoc:function(b){if(this.popup){LBUI.setActiveDialog(LBOP.dialog)}var a=this.getForm().getEl().dom.action;if(Ext.isString(b)){a=Ext.urlAppend(a,b)}else{a=Ext.urlEncode(b,a)}document.location=Ext.urlEncode({PopupWin:this.popup},a)}});LBUI.ctrl.TriggerField=Ext.extend(Ext.form.TriggerField,{onResize:function(a,c){if(typeof a=="number"){var b=this.getTriggerWidth();this.el.setWidth(a-b);this.wrap.setWidth(this.el.getWidth()+b)}},onRender:function(b,a){LBUI.ctrl.TriggerField.superclass.onRender.call(this,b,a);if(this.width&&typeof this.width=="string"){this.wrap.setWidth(this.width);if(this.width==="100%"){this.el.addClass("lb-field-autosize");this.trigger.addClass("lb-field-trigger-autosize")}}}});LBUI.ctrl.AutoSizeComboBox=Ext.extend(Ext.form.ComboBox,{onResize:function(a,c){if(typeof a=="number"){var b=this.getTriggerWidth();this.el.setWidth(a-b);this.wrap.setWidth(this.el.getWidth()+b)}},onRender:function(b,a){LBUI.ctrl.AutoSizeComboBox.superclass.onRender.call(this,b,a);if(this.width&&typeof this.width=="string"){this.wrap.setWidth(this.width);if(this.width==="100%"){this.el.addClass("lb-field-autosize");this.trigger.addClass("lb-field-trigger-autosize")}}}});LBUI.Top=new function(){if(!Ext.isDefined(parent)||parent==null){return window}try{var a=window.self;while((a!=null&&a!=undefined)&&a!=a.parent){if(a.parent===null){return a.window}a=a.parent}return a.window}catch(b){return window}};LBUI.Master=new function(){if(!Ext.isDefined(parent)||parent==null){return window}try{var a=window.self;if(a.name==="fraRightFrame"){return window}a=a.parent;while((a!=null&&a!=undefined)&&a!=a.parent){if((a.name=="fraRightFrame"&&Ext.isDefined(a.Ext))||a.parent===null){return a.window}a=a.parent}return a.window}catch(b){return window}};LBUI.Ext=new function(){if(!Ext.isDefined(parent)||parent==null){return Ext}try{var a=window.self;while((a!=null&&a!=undefined)&&a!=a.parent){if(a.parent===null){return a.Ext}a=a.parent}return a.Ext}catch(b){return Ext}};LBUI.createField=function(e,c,d){d=Ext.create(d);var b=document.forms[e].elements[c];if(b){d.applyToMarkup(b)}var a=Ext.getCmp(e);if(!a){a=new LBUI.FormPanel({formId:e,id:e})}a.getForm().add(d);return d};LBUI.addField=function(c,b){var a=Ext.getCmp(c);if(!a){a=new LBUI.FormPanel({formId:c,id:c})}a.getForm().add(b)};LBUI.urlEncode=function(b,a){if(a&&Ext.isString(a)){if(a.indexOf("?")==-1){a+="?"}}return Ext.urlEncode(b,a)};LBUI.showModalDialog=function(c,b){b=b||{};var h=(b.autoResize===false)||b.height||b.width||false;var g=LBUI.Top;var e=b.width||640;var a=b.height||500;var f=LBUI.Ext.getBody();if(f){if(e>f.getWidth()){e=f.getWidth()-10}if(a>f.getHeight()){a=f.getHeight()-10}}b.width=e;b.height=a;var d=new g.Ext.Window({tbar:b.topbar||null,fbar:b.footerbar||null,layout:"fit",width:b.width,height:b.height,hasResized:h,plain:false,maximizable:true,modal:true,html:'<iframe src="'+LBUI.urlEncode({extWindow:true,PopupWin:true},c)+'" FRAMEBORDER="no" bordercolor="#FFFFFF"  width="100%" height="100%" border=0 ></iframe>',listeners:{maximize:function(i){this.hasResized=true}}});g.LBUI.dialog=d;g.Ext.apply(d,b);d.show(b.target,b.callback,b.scope);return d};LBUI.getActiveDialog=function(){var a=LBUI.Top;return a.LBUI.dialog};LBUI.setActiveDialog=function(b){var a=LBUI.Top;a.LBUI.dialog=b};LBUI.menuFun={fun:{callback:function(a){if(!Ext.isEmpty(a.message)){LBUI.Tip.msg("",a.message)}}}};LBUI.columnEvent=function(frmName,colName,eventType){LBUI.checkRequestTime(function(){var form=Ext.getCmp(frmName).getForm();eventType=eventType||"0";LBUI.requestTime=new Date();form.submit({url:Ext.urlEncode({extResponse:true,EVENT_SOURCE:colName,EVENT_TYPE:eventType},form.getEl().dom.action),clientValidation:false,success:function(fp,o){LBUI.requestTime=null;var resp=o.result.response;LBUI.displayMsg(resp);if(resp.type==1){for(var i=0;i<resp.columns.length;i++){var col=resp.columns[i];var repHtml=function(){var fe=document.forms[frmName].elements["$C{"+col.name+"}"];if(fe==null){LBUI.Ext.MessageBox.alert("获取控件消息失败");return false}var p=fe.parentNode;if((p===null||p===undefined)&&fe.length){p=fe[0].parentNode}if((p===null||p===undefined)){LBUI.Ext.MessageBox.alert("获取控件位置失败");return false}Ext.DomHelper.overwrite(p,col.html);return true};if(col.detach){var field=form.findField(col.name);if(field){form.remove(field);if(field.ownerCt){delete field.ownerCt}field.destroy()}}if(!Ext.isEmpty(col.html)&&col.html.length>0&&col.replaceHtml){if(!repHtml()){return}}if(Ext.isDefined(col.config)){var field=form.findField(col.name);if(field){field.reconfig(col.config)}else{if(!Ext.isEmpty(col.html)&&col.html.length>0){if(!repHtml()){return}}field=LBUI.createField(frmName,col.config.elId||col.name,col.config)}if(field&&col.name===resp.eventSource&&!Ext.isEmpty(col.validateError)){field.markInvalid(col.validateError)}}if(Ext.isDefined(col.script)&&!Ext.isEmpty(col.script)){eval(col.script)}}LBUI.Events.fireEvent("columnEvent",resp,frmName,colName,eventType)}else{if(resp.type==0){Ext.getCmp(frmName).reloadDoc(resp.parameters)}}},failure:function(){LBUI.requestTime=null}})},this)};LBUI.displayMsg=function(g){try{var b=Ext.getDom("msgBar");var f=false;if(b.className!=="MsgNone"){b.className="MsgNone";f=true}if(Ext.isString(g.message)&&!Ext.isEmpty(g.message)){if(g.type==0||g.msgType==3){alert(g.message)}else{if(g.msgType==4){var a=null;if(!Ext.isEmpty(g.eventSource)){var c=Ext.get("$C{"+g.eventSource+"}");if(c!=null){a=c.parent()}}if(a){var h=new Ext.ToolTip({html:g.message,target:a,anchor:"buttom",closable:true,listeners:{hide:function(i){if(i.target){i.target=Ext.get(i.target);i.target.un("mouseover",i.onTargetOver,i);i.target.un("mouseout",i.onTargetOut,i);i.target.un("mousemove",i.onMouseMove,i)}}}});h.show()}else{LBUI.Tip.msg("",g.message)}}else{if(g.msgType==1){b.className="Success"}else{if(g.msgType==2){b.className="Error"}else{b.className="Warn"}}b.innerHTML=g.message;f=true}}}if(f){LBUI.Events.fireEvent("msgStyleChange",b,b.className)}}catch(d){}};function setHtmlEditorContent(a,f){try{var d=FCKeditorAPI.GetInstance(a);var b=d.GetHTML();if(b!==f){d.SetHTML(f)}}catch(c){}}LBUI.getStyleSize=function(b){if(typeof(b)==="string"){var a=b.indexOf("px");if(a>0){return parseInt(b.substr(0,a))}else{return parseInt(b)}}return b};LBOP.resizeDialog=function(c,a,k,e){if(c.hasResized){return}if(!Ext.isEmpty(a)&&a!=="auto"){if(a==="maximize"){if(c.isVisible()){c.maximize()}}else{var d=a.split("*");if(d.length==2){var g=LBUI.getStyleSize(d[0]);var b=LBUI.getStyleSize(d[1]);c.setSize(g,b);if(c.isVisible()){c.center()}}}c.hasResized=true}else{if(k&&e){var j=240;var i=540;var f=LBUI.Ext.getBody();if(i>f.getHeight()){i=f.getHeight()}k=LBUI.getStyleSize(k);e=LBUI.getStyleSize(e);if(e>f.getWidth()){e=f.getWidth()}if(k<j){k=j}if(k<i){c.setHeight(k)}else{if(c.getHeight()>i){c.setHeight(i)}}if(e>0){c.setWidth(e)}c.center()}}};Ext.apply(Ext.grid.GridView.prototype,{onLayout:function(b,d){var a=this.grid;if(a.autoHeight){var c=this;c.scroller.dom.style.overflow="auto";setTimeout(function(){c.onAdjustSize(b,d)},60)}},onAdjustSize:function(d,h){var b=this.grid;var f=this.mainHd.getHeight();h=this.scroller.dom.scrollHeight;if(this.scroller.dom.scrollWidth>d){h+=17}var a=f+h;if(b.maxHeight&&a>b.maxHeight){a=b.maxHeight;h=a-f}if(b.minHeight&&a<b.minHeight){a=b.minHeight;h=a-f}if(Ext.isIE){a+=b.body.getBorderWidth("tb")+b.body.getPadding("tb")}var e=b.getGridEl();if(!Ext.isIE||a>e.dom.clientHeight||(b.maxHeight&&b.maxHeight<e.dom.clientHeight)){this.adjustViewSize(d,h,a)}else{this.adjustViewSize(d)}},adjustViewSize:function(b,c,a){if(a){this.grid.body.dom.style.height=(a)+"px"}if(b&&c){this.scroller.setSize(b,c)}else{if(b){this.scroller.setWidth(b)}}if(this.innerHd&&b){this.innerHd.style.width=(b)+"px"}}});LBUI.ctrl.DataGridField=Ext.extend(LBUI.GridPanel,{layout:"fit",border:true,stripeRows:true,autoHeight:true,maxHeight:240,minHeight:65,height:65,layoutCt:null,useBodyLayout:false,fixWin:null,initComponent:function(){LBUI.ctrl.DataGridField.superclass.initComponent.call(this);var c=this;if(this.topToolbar){this.topToolbar.items.each(function(d){switch(d.name){case"add":d.handler=function(e){c.onAdd()};break;case"edit":d.handler=function(e){c.onEdit()};break;case"delete":d.handler=function(e){c.onDelete()};break;case"select":d.handler=function(e){c.onSelect()};break;case"maximize":d.handler=function(e){c.onMaximize()};break;case"restore":d.handler=function(e){c.onRestore()};break;default:break}})}if(this.layoutCt){this.layoutCt=Ext.get(this.layoutCt);if(this.autoHeight){this.layoutCt.dom.style.height="auto"}else{var a=this.layoutCt.getHeight();if(a>0){this.height=a}}var b=this.layoutCt.getWidth();if(b>0){this.width=b}this.registerLayouResizeEvent();LBUI.Events.on("groupExpand",this.onGroupExpand,this,{delay:100})}},registerLayouResizeEvent:function(){if(this.useBodyLayout){LBUI.Events.on("bodyLayout",this.onLayoutResize,this,{delay:150})}else{var a=Ext.getCmp("viewport");if(a){a.on("afterlayout",this.onLayoutResize,this,{delay:100})}else{if(Ext.isIE){this.layoutCt.on("resize",this.onLayoutResize,this)}else{Ext.EventManager.onWindowResize(this.onLayoutResize,this)}}}},unRegisterLayouResizeEvent:function(){if(this.useBodyLayout){LBUI.Events.un("bodyLayout",this.onLayoutResize,this)}else{var a=Ext.getCmp("viewport");if(a){a.un("afterlayout",this.onLayoutResize,this)}else{if(Ext.isIE){this.layoutCt.un("resize",this.onLayoutResize,this)}else{Ext.EventManager.removeResizeListener(this.onLayoutResize,this)}}}},onLayoutResize:function(){width=this.layoutCt.getWidth();if(this.autoHeight){height=this.getHeight()}else{height=this.layoutCt.getHeight()}if(height>0&&width>0){this.setSize(width,height)}this.doViewLayout()},doViewLayout:function(){if(this.autoHeight){var a=this.getView();var d=this.getGridEl();var b=d.getSize(true);a.onLayout(b.width,b.height)}},onGroupExpand:function(b,a){if(a){var c=Ext.get(b).next();for(;c&&c.dom.className!=b.className;c=c.next()){if(c.child("DIV[id="+this.layoutCt.id+"]")){this.onLayoutResize();break}}}},onRestore:function(){this.parentPanel.hide()},onMaximize:function(){if(this.maximizedPanel){this.maximizedPanel.show();this.maximizedPanel.setPosition(0,0);return}if(this.maximizeCfg){var b=Ext.getBody().getViewSize();var a=new LBUI.ctrl.DataGridField(this.maximizeCfg);this.maximizedPanel=new Ext.Panel({header:false,floating:true,width:b.width,height:b.height,items:a,border:false,shadow:false,layout:"fit"});a.parentPanel=this.maximizedPanel;this.maximizedPanel.render(Ext.getBody());this.maximizedPanel.setPosition(0,0);Ext.EventManager.onWindowResize(this.onMaximizedResize,this)}},onMaximizedResize:function(){var a=Ext.getBody().getViewSize();this.maximizedPanel.setSize(a)},onAdd:function(){var a=this;LBUI.checkRequestTime(function(){var b=document.forms[this.formId];LBUI.showModalDialog(Ext.urlEncode({Column:this.column,SubmitForm:this.formId,EVENT_SOURCE:"AddHypotObj"},b.action),{fun:a})},this)},onDelete:function(){var b=this.getSelectionModel();var a=b.getSelected();if(a){this.doDelete(a.data.id)}else{LBUI.Ext.Msg.alert("","请先选择一条记录");return}},doDelete:function(d){var b=document.forms[this.formId];var c={EVENT_SOURCE:"RemoveHypotObj",Column:this.column,HYPOT_ID:d,SubmitForm:this.formId,extResponse:true};var a=this;Ext.Ajax.request({url:b.action,params:c,success:function(g,h){try{var f=Ext.decode(g.responseText);a.callback(f)}catch(i){LBUI.Ext.MessageBox.alert("","数据出错")}},failure:function(){LBUI.Ext.MessageBox.alert("","请求失败")}})},onEdit:function(){var b=this.getSelectionModel();var a=b.getSelected();if(a){this.doEdit(a.data.id)}else{LBUI.Ext.Msg.alert("","请先选择一条记录");return}},doEdit:function(b){var a=this;LBUI.checkRequestTime(function(){var c=document.forms[this.formId];LBUI.showModalDialog(Ext.urlEncode({Column:this.column,HYPOT_ID:b,SubmitForm:this.formId,EVENT_SOURCE:"ModifyHypotObj"},c.action),{fun:a})},this)},doView:function(d){var b=document.forms[this.formId];var a=this;var c={Column:this.column,HYPOT_ID:d,SubmitForm:this.formId};if(b.action.indexOf("OperateID")==-1&&b.action.indexOf("/WorkProcessor")==-1){c.operate="ViewHypotObj"}else{c.EVENT_SOURCE="ViewHypotObj"}LBUI.showModalDialog(Ext.urlEncode(c,b.action),{fun:a})},onSelect:function(){var a=this;LBUI.checkRequestTime(function(){var b=document.forms[this.formId];LBUI.showModalDialog(Ext.urlEncode({Column:this.column,SubmitForm:this.formId,EVENT_SOURCE:"SelectHypotObj"},b.action),{fun:a})},this)},callback:function(a){if(a.retVal){if(!this.isEventSource&&a.data){this.store.loadData(a.data)}else{LBUI.columnEvent(this.formId,this.column)}}else{LBUI.Ext.MessageBox.alert("",resp.message)}}});LBUI.ctrl.EditorGridField=Ext.extend(LBUI.EditorGridPanel,{layout:"fit",border:true,stripeRows:true,autoHeight:true,maxHeight:240,minHeight:100,layoutCt:null,editStatus:"lb_edit_status",useBodyLayout:false,initComponent:function(){LBUI.ctrl.EditorGridField.superclass.initComponent.call(this);var c=this;if(this.topToolbar){this.topToolbar.items.each(function(d){switch(d.name){case"add":d.handler=function(e){c.onAdd()};break;case"delete":d.handler=function(e){c.onDelete()};break;case"select":d.handler=function(e){c.onSelect()};break;case"maximize":d.handler=function(e){c.onMaximize()};break;case"restore":d.handler=function(e){c.onRestore()};break;default:break}})}if(this.layoutCt){this.layoutCt=Ext.get(this.layoutCt);if(this.autoHeight){this.layoutCt.dom.style.height="auto"}else{var a=this.layoutCt.getHeight();if(a>0){this.height=a}}var b=this.layoutCt.getWidth();if(b>0){this.width=b}this.registerLayouResizeEvent();LBUI.Events.on("groupExpand",this.onGroupExpand,this,{delay:100})}},registerLayouResizeEvent:function(){if(this.useBodyLayout){LBUI.Events.on("bodyLayout",this.onLayoutResize,this,{delay:150})}else{var a=Ext.getCmp("viewport");if(a){a.on("afterlayout",this.onLayoutResize,this,{delay:100})}else{if(Ext.isIE){this.layoutCt.on("resize",this.onLayoutResize,this)}else{Ext.EventManager.onWindowResize(this.onLayoutResize,this)}}}},unRegisterLayouResizeEvent:function(){if(this.useBodyLayout){LBUI.Events.un("bodyLayout",this.onLayoutResize,this)}else{var a=Ext.getCmp("viewport");if(a){a.un("afterlayout",this.onLayoutResize,this)}else{if(Ext.isIE){this.layoutCt.un("resize",this.onLayoutResize,this)}else{Ext.EventManager.removeResizeListener(this.onLayoutResize,this)}}}},doViewLayout:function(){if(this.autoHeight){var a=this.getView();var d=this.getGridEl();var b=d.getSize(true);a.onLayout(b.width,b.height)}},onLayoutResize:function(){width=this.layoutCt.getWidth();if(this.autoHeight){if(width>0){this.setWidth(width)}}else{height=this.layoutCt.getHeight();if(height>0&&width>0){this.setSize(width,height)}}this.doViewLayout()},onGroupExpand:function(c,b){if(b){var d=Ext.get(c).next();var a="DIV[id="+this.layoutCt.id+"]";for(;d&&d.dom.className!=c.className;d=d.next()){if(d.child(a)){this.onLayoutResize();break}}}},onRestore:function(){this.parentPanel.hide()},onMaximize:function(){if(this.maximizedPanel){this.maximizedPanel.show();this.maximizedPanel.setPosition(0,0);return}if(this.maximizeCfg){var b=Ext.getBody().getViewSize();var a=new LBUI.ctrl.EditorGridField(this.maximizeCfg);this.maximizedPanel=new Ext.Panel({header:false,floating:true,width:b.width,height:b.height,items:a,border:false,shadow:false,layout:"fit"});a.parentPanel=this.maximizedPanel;this.maximizedPanel.render(Ext.getBody());this.maximizedPanel.setPosition(0,0);Ext.EventManager.onWindowResize(this.onMaximizedResize,this)}},onMaximizedResize:function(){var a=Ext.getBody().getViewSize();this.maximizedPanel.setSize(a)},doView:function(d){var b=document.forms[this.formId];var a=this;var c={Column:this.column,HYPOT_ID:d,SubmitForm:this.formId};if(b.action.indexOf("OperateID")==-1){c.operate="ViewHypotObj"}else{c.EVENT_SOURCE="ViewHypotObj"}LBUI.showModalDialog(Ext.urlEncode(c,b.action),{fun:a})},onSelect:function(){var b=document.forms[this.formId];var a=this;LBUI.showModalDialog(Ext.urlEncode({Column:this.column,SubmitForm:this.formId,EVENT_SOURCE:"SelectHypotObj"},b.action),{fun:a})},onAdd:function(){var a=new this.store.recordType({});this.stopEditing();this.store.insert(0,a);this.startEditing(0,1);this.doViewLayout()},onDelete:function(){this.stopEditing(true);var a=this.getSelectionModel().getSelected();if(!a){return false}this.store.remove(a);this.doViewLayout()},callback:function(a){if(a.retVal){if(!this.isEventSource&&a.data){this.store.loadData(a.data);this.doViewLayout()}else{LBUI.columnEvent(this.formId,this.column,a.eventType)}}else{LBUI.Ext.MessageBox.alert("",resp.message)}},isStoreCommitted:function(){if(this.store.modified&&this.store.modified.length>0){return false}if(this.store.removed&&this.store.removed.length>0){return false}return true},isStoreValidate:function(){for(r=0;(r<this.store.getCount());r++){var a=this.store.getAt(r);var b=a.get(this.editStatus);if(b&&b.error){return false}}return true},validate:function(){if(!this.isStoreValidate()){LBUI.Tip.error("","表格中还有错误未修正!");return false}if(!this.isStoreCommitted()){LBUI.Tip.msg("","表格数据正在提交中,请稍候!");return false}return true},onWrite:function(c,e,a,d,b){LBUI.ctrl.EditorGridField.superclass.onWrite.call(this,c,e,a,d,b);if(this.isEventSource){LBUI.columnEvent(this.formId,this.column)}}});LBUI.ctrl.EditorValidateField=Ext.extend(Ext.form.Hidden,{validate:function(){var a=Ext.getCmp(this.gridId);return a.validate()}});LBUI.ctrl.DataGridField.CommandColumn=function(a){a=a||{};Ext.apply(this,a)};LBUI.ctrl.DataGridField.CommandColumn=Ext.extend(Ext.grid.Column,{header:'<div class="cmd-col-hd">&#160;</div>',menuDisabled:true,pluginsMode:true,fixed:true,editable:false,resizable:false,sortable:false,locked:true,id:"cmd-col",init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this);b.mainBody.on("mouseover",this.onMouseOver,this);b.mainBody.on("mouseout",this.onMouseOut,this);if(b.lockedBody){b.lockedBody.on("mousedown",this.onMouseDown,this);b.lockedBody.on("mouseover",this.onMouseOver,this);b.lockedBody.on("mouseout",this.onMouseOut,this)}},this)},onMouseDown:function(f,d){var a=Ext.fly(d);if(a.hasClass("lb-grid-ctrl-cmd")){f.stopEvent();var c=this.grid.getView().findRowIndex(d.parentNode);this.grid.getSelectionModel().selectRow(c);if(a.hasClass("lb-grid-ctrl-edit")){this.grid.doEdit(this.grid.store.getAt(c).data.id)}else{if(a.hasClass("lb-grid-ctrl-delete")){this.grid.doDelete(this.grid.store.getAt(c).data.id)}else{if(a.hasClass("lb-grid-ctrl-view")){this.grid.doView(this.grid.store.getAt(c).data.id)}}}}},onMouseOver:function(b,a){if(Ext.fly(a).hasClass("lb-grid-ctrl-cmd")){Ext.fly(a.parentNode).addClass("lb-grid-ctrl-cmd-over")}},onMouseOut:function(b,a){if(Ext.fly(a).hasClass("lb-grid-ctrl-cmd")){Ext.fly(a.parentNode).removeClass("lb-grid-ctrl-cmd-over")}},renderer:function(){var a=[];if(this.grid.allowViewLink){a.push('<div class="lb-grid-ctrl-cmd-p" ><div class="lb-grid-ctrl-cmd lb-grid-ctrl-view" ext:qtip="查看"></div></div>')}if(this.grid.allowEdit){a.push('<div class="lb-grid-ctrl-cmd-p" ><div class="lb-grid-ctrl-cmd lb-grid-ctrl-edit" ext:qtip="修改"></div></div>')}if(this.grid.allowDelete){a.push('<div class="lb-grid-ctrl-cmd-p"><div class="lb-grid-ctrl-cmd lb-grid-ctrl-delete" ext:qtip="删除"></div></div>')}return a.join("")}});LBUI.data.EmptyStore=Ext.extend(Ext.data.Store,{loadData:function(b,a){},load:function(a){LBUI.fun.showMark();if(LBOP&&LBOP.dialog){LBUI.setActiveDialog(LBOP.dialog)}if(this.url){try{document.location=Ext.urlEncode(a,this.url)}catch(b){document.location.reload()}}else{document.location.reload()}}});LBUI.TreePanel=Ext.extend(Ext.tree.TreePanel,{reload:function(b){var a=this;Ext.Ajax.request({url:b.url,method:b.method||"POST",params:b.params,success:function(e,i){var k=a.getSelectionModel();var c=k.getSelectedNode();var g=null;if(c){g=c.id}var d=Ext.decode(e.responseText);a.setRootNode(d);if(g){var j=function(p){if(p.id==g){return p}var o=p.childNodes;for(var l=0,f=o.length;l<f;l++){var m=j.call(o[l],o[l]);if(m!==null){return m}}return null};var h=j(a.getRootNode());if(h){a.getSelectionModel().select(h)}else{if(a.getRootNode().childNodes.length>0){a.getSelectionModel().select(a.getRootNode().childNodes[0])}else{a.getSelectionModel().clearSelections()}}}},failure:function(){LBUI.Ext.MessageBox.alert("","请求失败")}})}});LBUI.IFramePanel=function(a){a=a||{};a.html='<iframe src="'+a.src+'" '+(a.frameId?(['id="',a.frameId,'" name="',a.frameId,'"'].join("")):"")+' FRAMEBORDER="no" bordercolor="#FFFFFF"  width="100%" height="100%" border=0 ></iframe>';LBUI.IFramePanel.superclass.constructor.apply(this,arguments)};Ext.extend(LBUI.IFramePanel,Ext.Panel,{});LBUI.Template=Ext.extend(Ext.Template,{re:/#\{((?:\$[\w-]{0,4}\{)?(?:[\w-]+)(?:\})?)(?:\:([\w\.]*)(?:\((.*?)?\))?)?\}/g});LBUI.XTemplate=function(){LBUI.XTemplate.superclass.constructor.apply(this,arguments);var w=this,h=w.html,o=/<tpl\b[^>]*>((?:(?=([^<]+))\2|<(?!tpl\b[^>]*>))*?)<\/tpl>/,d=/^<tpl\b[^>]*?for="(.*?)"/,t=/^<tpl\b[^>]*?if="(.*?)"/,v=/^<tpl\b[^>]*?exec="(.*?)"/,p,n=0,i=[],l="values",u="parent",j="xindex",k="xcount",e="return ",c="with(values){ ";h=["<tpl>",h,"</tpl>"].join("");while((p=h.match(o))){var b=p[0].match(d),a=p[0].match(t),y=p[0].match(v),f=null,g=null,q=null,x=b&&b[1]?b[1]:"";if(a){f=a&&a[1]?a[1]:null;if(f){g=new Function(l,u,j,k,c+e+(Ext.util.Format.htmlDecode(f))+"; }")}}if(y){f=y&&y[1]?y[1]:null;if(f){q=new Function(l,u,j,k,c+(Ext.util.Format.htmlDecode(f))+"; }")}}if(x){switch(x){case".":x=new Function(l,u,c+e+l+"; }");break;case"..":x=new Function(l,u,c+e+u+"; }");break;default:x=new Function(l,u,e+l+"['"+x+"'];")}}i.push({id:n,target:x,exec:q,test:g,body:p[1]||""});h=h.replace(p[0],"#{xtpl"+n+"}");++n}Ext.each(i,function(m){w.compileTpl(m)});w.master=i[i.length-1];w.tpls=i};Ext.extend(LBUI.XTemplate,Ext.Template,{re:/#\{([(\$\w{0,4})*\w-\.\#(\})*}\{]+)(?:\:([\w\.]*)(?:\((.*?)?\))?)?(\s?[\+\-\*\\]\s?[\d\.\+\-\*\\\(\)]+)?\}/g,codeRe:/\{\[((?:\\\]|.|\n)*?)\]\}/g,applySubTemplate:function(a,h,g,d,c){var f=this,e,j=f.tpls[a],i,b=[];if((j.test&&!j.test.call(f,h,g,d,c))||(j.exec&&j.exec.call(f,h,g,d,c))){return""}i=j.target?j.target.call(f,h,g):h;e=i.length;g=j.target?h:g;if(j.target&&Ext.isArray(i)){Ext.each(i,function(k,l){b[b.length]=j.compiled.call(f,k,g,l+1,e)});return b.join("")}return j.compiled.call(f,i,g,d,c)},compileTpl:function(tpl){var fm=Ext.util.Format,useF=this.disableFormats!==true,sep=Ext.isGecko?"+":",",body;function fn(m,name,format,args,math){if(name.substr(0,4)=="xtpl"){return"'"+sep+"this.applySubTemplate("+name.substr(4)+", values, parent, xindex, xcount)"+sep+"'"}var v;if(name==="."){v="values"}else{if(name==="#"){v="xindex"}else{if(name.indexOf(".")!=-1){v=name}else{v="values['"+name+"']"}}}if(math){v="("+v+math+")"}if(format&&useF){args=args?","+args:"";if(format.substr(0,5)!="this."){format="fm."+format+"("}else{format='this.call("'+format.substr(5)+'", ';args=", values"}}else{args="";format="("+v+" === undefined ? '' : "}return"'"+sep+format+v+args+")"+sep+"'"}function codeFn(m,code){return"'"+sep+"("+code+")"+sep+"'"}if(Ext.isGecko){body="tpl.compiled = function(values, parent, xindex, xcount){ return '"+tpl.body.replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn).replace(this.codeRe,codeFn)+"';};"}else{body=["tpl.compiled = function(values, parent, xindex, xcount){ return ['"];body.push(tpl.body.replace(/(\r\n|\n)/g,"\\n").replace(/'/g,"\\'").replace(this.re,fn).replace(this.codeRe,codeFn));body.push("'].join('');};");body=body.join("")}eval(body);return this},applyTemplate:function(a){return this.master.compiled.call(this,a,{},1,1)},compile:function(){return this}});LBUI.grid.ColumnModel=Ext.extend(Ext.grid.ColumnModel,{getRenderer:function(a){var b=this.config[a];return function(g,h,e,k,d,f){if(b.cssClass){h.css+=b.cssClass}if(e){var j=e.get("@@CSS");if(j){h.css+=" "+j}}if(b.renderer){return b.renderer(g,h,e,k,d,f)}else{return Ext.grid.ColumnModel.defaultRenderer(g,h,e,k,d,f)}}}});Ext.grid.Column.prototype.renderer=function(d,e,b,f,a,c){if(Ext.isString(d)){if(d.length<1){return"&#160;"}if(!this.plainDisplay&&d.length>25){e.attr='title="'+d.replace(/"/g,"&quot;")+'"'}}return d};LBUI.grid.NumberColumn=Ext.extend(Ext.grid.Column,{format:"0,000.00",renderer:function(d,e,b,f,a,c){if(d==null||d===""){return""}return Ext.util.Format.number(d,this.format)}});LBUI.grid.RatingColumn=Ext.extend(Ext.grid.Column,{renderer:function(e,f,c,g,b,d){if(e==null||e===""){return""}var a=Ext.num(e,NaN);if(isNaN(a)||a<0){return""}if(a>5){a=5}return["<IMG  align=absMiddle height=12 src='","/images/control/rating/r_s_",a,".gif","' width=64 border=0>"].join("")}});LBUI.grid.ColorColumn=Ext.extend(Ext.grid.Column,{renderer:function(d,e,b,g,a,c){var f=d;if(!f){return""}if(Ext.isNumber(f)){f=f.toString(16);if(f.length==4){f="00"+f}f="#"+f.toUpperCase()}else{if(Ext.isString(f)&&f.charAt(0)!=="#"){f="#"+Ext.num(f,0).toString(16)}}return['<div style="padding:0px;margin:0px;background-color:',f,'">',f,"</div>"].join("")}});LBUI.grid.DocumentColumn=Ext.extend(Ext.grid.Column,{renderer:function(d,e,b,g,a,c){if(d==null||d===""){return""}var f=[];f.push('<a href="#" onclick="fnViewAttachment(\'');f.push(this.baseURL);f.push("&Type=View&");if(b.id.indexOf("=")==-1){f.push("ID=")}f.push(b.id);f.push("'");if(this.image){f.push(",null,'image/*'")}f.push(');"');f.push(' class="');f.push("link");f.push('"  >');if(this.dispfilename){f.push(d)}else{f.push("查看")}f.push("</a>");f.push("&nbsp;&nbsp;");f.push("<a href='");f.push(this.baseURL);f.push("&Type=Attachment&");if(b.id.indexOf("=")==-1){f.push("ID=")}f.push(b.id);f.push("'");f.push(' class="');f.push("link download");f.push('"  >');f.push("下载");f.push("</a>");return f.join("")}});LBUI.grid.TemplateObjLinkColumn=Ext.extend(Ext.grid.Column,{constructor:function(a){LBUI.grid.TemplateObjLinkColumn.superclass.constructor.call(this,a);var b=typeof Ext.isObject(this.tpl)?this.tpl:new LBUI.Template(this.tpl);this.renderer=function(d,e,c){if(d==null||d===""){return""}if((d.value===undefined||d.value===null||d.value==="")){return d.text}return b.apply(d)};this.tpl=b}});LBUI.grid.HypotColumn=Ext.extend(Ext.grid.Column,{renderer:function(d,e,b,g,a,c){if(!this.baseURL||this.baseURL===""){return""}var f=[];f.push('<a href="#" onclick="');f.push("LBUI.fun.onCmd({url:'");f.push(this.baseURL);f.push("&");if(b.id.indexOf("=")==-1){f.push("ID=")}f.push(b.id);f.push("',select:false,popup :true,message:''})");f.push('" class="');f.push("link");f.push('"  >');f.push("详细信息");f.push("</a>");return f.join("")}});LBUI.grid.MultiObjLinkColumn=Ext.extend(Ext.grid.Column,{constructor:function(a){a.pluginsMode=true;LBUI.grid.MultiObjLinkColumn.superclass.constructor.call(this,a);if(this.tpl){var b=typeof Ext.isObject(this.tpl)?this.tpl:new LBUI.Template(this.tpl);this.tpl=b}},tips:[],init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this);b.mainBody.on("mouseover",this.onMouseOver,this);b.on("refresh",function(){this.tips=[]},this)},this)},onMouseDown:function(g,f){var a=Ext.fly(f);if(a.hasClass("lb-grid-mul-"+this.id)){g.stopEvent();var d=this.grid.getView().findRowIndex(f);var c=this.grid.store.getAt(d);if(this.tips[c.id]){this.tips[c.id].show()}}},onMouseOver:function(g,f){var a=Ext.fly(f);if(a.hasClass("lb-grid-mul-"+this.id)){var d=this.grid.getView().findRowIndex(f);var c=this.grid.store.getAt(d);if(!this.tips[c.id]){g.stopEvent();this.tips[c.id]=new Ext.ToolTip({target:f,autoLoad:{url:this.baseURL,method:"POST",params:{items:c.data[this.dataIndex].items}},title:"&nbsp;",hideDelay:5000,showDelay:1500,width:230,anchor:"left",closable:true,draggable:true})}}},renderer:function(d,e,b,g,a,c){if(d==null||d===""){return""}var f=[];if(this.tpl){f.push(this.tpl.apply(d))}else{if(d.link){f.push(d.link)}}if(d.itemSize>1&&(this.baseURL&&this.baseURL!=="")){f.push('<div class="lb-grid-mul-lk lb-grid-mul-');f.push(this.id);f.push('">&gt;&gt;&gt;</div>')}return f.join("")}});LBUI.grid.GenObjLinkColumn=Ext.extend(Ext.grid.Column,{constructor:function(a){a.pluginsMode=true;LBUI.grid.GenObjLinkColumn.superclass.constructor.call(this,a)},tips:[],init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this);b.mainBody.on("mouseover",this.onMouseOver,this);b.on("refresh",function(){this.tips=[]},this)},this)},onMouseDown:function(g,f){var a=Ext.fly(f);if(a.hasClass("lb-grid-gen-"+this.id)){g.stopEvent();var d=this.grid.getView().findRowIndex(f);var c=this.grid.store.getAt(d);if(this.tips[c.id]){this.tips[c.id].show()}}},onMouseOver:function(g,f){var a=Ext.fly(f);if(a.hasClass("lb-grid-gen-"+this.id)){var d=this.grid.getView().findRowIndex(f);var c=this.grid.store.getAt(d);if(!this.tips[c.id]){g.stopEvent();this.tips[c.id]=new Ext.ToolTip({target:f,autoLoad:{url:this.baseURL,method:"POST",params:{value:c.data[this.dataIndex].itemVal}},title:"&nbsp;",hideDelay:5000,showDelay:1500,width:270,anchor:"left",closable:true,draggable:true})}}},renderer:function(d,e,b,g,a,c){if(d==null||d===""){return""}if(!d.itemVal||!(d.itemSize>1)){return d}var f=[];if(d.link){f.push(d.link)}if(this.baseURL&&this.baseURL!==""){f.push('<div class="lb-grid-gen-lk lb-grid-gen-');f.push(this.id);f.push('">&gt;&gt;&gt;</div>')}return f.join("")}});LBUI.grid.LinkColumn=Ext.extend(Ext.grid.Column,{renderer:function(d,e,b,f,a,c){if(d==null||d===""){return""}if(d.link){return(d.link)}if(d.text){return d.text}return d}});LBUI.grid.BoolColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}};Ext.extend(LBUI.grid.BoolColumn,Ext.grid.Column,{init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this)},this)},onMouseDown:function(d,c){if(c.className&&c.className.indexOf("x-grid3-cc-"+this.id)!=-1){d.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);a.set(this.dataIndex,!a.data[this.dataIndex])}},renderer:function(b,c,a){if(!this.pluginsMode&&(b===null||b==="")){return""}c.css+=" x-grid3-check-col-td";return'<div class="x-grid3-check-col'+(b?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'}});LBUI.grid.ComboColumn=Ext.extend(Ext.grid.Column,{renderer:function(d,g,b,j,a,c){if(d==null||d===""){return""}if((b.dirty)||b.phantom||b.data.lb_edit_status){var f=this.editor.field;if(f&&f.store){var h=f.store.getById(d);if(h){return h.get(f.displayField)}}}return d}});LBUI.grid.EditStatusColumn=Ext.extend(Ext.grid.Column,{header:'<div class="cmd-col-hd">&#160;</div>',width:18,sortable:false,fixed:true,locked:true,menuDisabled:true,dataIndex:"",renderer:function(b,c,a,d){if(this.rowspan){c.cellAttr='rowspan="'+this.rowspan+'"'}if(!b){return""}if(b.error){return['<div class="lb-row-edit-error"',b.errorMsg?'ext:qtip="'+b.errorMsg+'"':"",">&#160;</div>"].join("")}if(b.create){return'<div class="lb-row-edit-create">&#160;</div>'}if(b.dirty){return'<div class="lb-row-edit-dirty">&#160;</div>'}return""}});LBUI.grid.MultiDocumentColumn=Ext.extend(Ext.grid.Column,{constructor:function(a){a.pluginsMode=true;LBUI.grid.MultiDocumentColumn.superclass.constructor.call(this,a)},tips:[],viewIcon:"/images/control/file/view.gif",downloadIcon:"/images/control/file/download.gif",fileTpl:null,lastTip:null,maxNameLength:30,init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this);b.mainBody.on("mouseover",this.onMouseOver,this);b.on("refresh",function(){this.tips=[];this.lastTip=null},this)},this)},onMouseDown:function(g,f){var a=Ext.fly(f);if(a.hasClass("lb-grid-multi-doc-"+this.id)){g.stopEvent();var d=this.grid.getView().findRowIndex(f);var c=this.grid.store.getAt(d);if(this.tips[c.id]){this.tips[c.id].show()}}},onMouseOver:function(j,n){var m=Ext.fly(n);if(m.hasClass("lb-grid-multi-doc-"+this.id)){var h=this.grid.getView().findRowIndex(n);var d=this.grid.store.getAt(h);if(!this.tips[d.id]){j.stopEvent();var k=d.data[this.dataIndex].items;if(k&&k.length>0){if(!this.fileTpl){this.fileTpl=new Ext.XTemplate(['<tr class="lb-tip-filerow">','<td nowrap class="lb-tip-file lb-uf-state-{state}"  >','<span class="lb-uf-filename" title="{fullname}" >{name}</span>',"</td>",'<td nowrap  class="lb-tip-buttons">','<a  href="',,this.baseURL,"&Type=View&{recordId}",'&fileid={id}" title="查看" target="_blank"><img src="'+this.viewIcon+'"></a>&nbsp;','<a href="',this.baseURL,"&Type=Attachment&{recordId}",'&fileid={id}" ',' title="下载" ><img src="'+this.downloadIcon+'"></a>',"</td>","</tr>"])}var l=['<table class="lb-grid-tip-uf-table"'];var g=(d.id.indexOf("=")==-1?("ID="+d.id):d.id);for(var c=0;c<k.length;c++){var a=k[c];if((a.state==2||a.state==3)){continue}a.fullname=a.name;a.name=Ext.util.Format.ellipsis(a.name.split(/[\/\\]/).pop(),this.maxNameLength);a.recordId=g;l.push(this.fileTpl.apply(a))}l.push("</table>");var f=this;this.tips[d.id]=new Ext.ToolTip({target:n,html:l.join(""),autoHide:false,showDelay:1000,anchor:"top",width:270,title:"文件信息",closable:true,draggable:true,listeners:{show:function(b){if(f.lastTip&&f.lastTip!==b){f.lastTip.hide()}f.lastTip=b}}})}}}},renderer:function(d,e,b,g,a,c){if(d==null||d===""){return""}if(!d.items||!(d.items.length>0)){return""}var f=[];if(this.baseURL&&this.baseURL!==""){f.push('<div class="lb-grid-multidoc-lk lb-grid-multi-doc-');f.push(this.id);f.push('">(');f.push(d.items.length);f.push(")个文件</div>")}return f.join("")}});LBUI.valNote=function(a){Ext.apply(this,a);this.toString=function(){if(!this.value&&!this.text){return""}return["[",this.value,"]",this.text].join("")}};LBUI.grid.OptSearchField=Ext.extend(LBUI.ctrl.TriggerField,{triggerClass:"x-form-search-trigger",hasSearch:false,isEventSource:false,noteValue:"",onTriggerClick:function(){var c=this.value;var b=0;if(this.value.value){c=this.value.value}else{if(this.value.text){c=this.value.text}}if(this.value.ctrl){b=this.value.ctrl}var d={extResponse:true,Value:c,Control:b};if(this.editor){d.ID=this.editor.record.id}var a=this;LBUI.showModalDialog(Ext.urlEncode(d,this.optUrl),{target:a,width:450,height:500})},setValue:function(a){this.value=a;var b=this.getTextValue();if(this.rendered){this.el.dom.value=(Ext.isEmpty(b)?"":b);this.validate()}return this},getValue:function(){if(!this.rendered){return this.value}var a=this.el.getValue();if(a===this.emptyText||a===undefined){a=""}if(this.value===null||this.value===undefined){return this.value}if(a===this.value.text){return this.value}this.value=new LBUI.valNote({text:a,ctrl:"1"});return this.value},getTextValue:function(){if(this.value&&this.value.text){return this.value.text}return this.value},onSelect:function(b,a){this.setOptValue(b,a,"0")},setOptValue:function(c,a,b){if(Ext.isObject(a)){a=LBUI.LBObjDisplay(a)}if(Ext.isObject(c)){c=LBUI.LBObjValue(c)}this.value=new LBUI.valNote({value:c,text:a,ctrl:b});this.el.dom.value=a}});LBUI.SelectBox=function(a){this.searchResetDelay=1000;a=a||{};a=Ext.apply(a||{},{editable:false,forceSelection:true,rowHeight:false,lastSearchTerm:false,triggerAction:"all",mode:"local"});LBUI.SelectBox.superclass.constructor.apply(this,arguments);this.lastSelectedIndex=this.selectedIndex||0};Ext.extend(LBUI.SelectBox,Ext.form.ComboBox,{});LBUI.grid.ComboField=LBUI.SelectBox;Ext.grid.Column.types.lbnumbercolumn=LBUI.grid.NumberColumn;Ext.grid.Column.types.ratingcolumn=LBUI.grid.RatingColumn;Ext.grid.Column.types.colorcolumn=LBUI.grid.ColorColumn;Ext.grid.Column.types.documentcolumn=LBUI.grid.DocumentColumn;Ext.grid.Column.types.objlinkcolumn=LBUI.grid.TemplateObjLinkColumn;Ext.grid.Column.types.multiobjlinkcolumn=LBUI.grid.MultiObjLinkColumn;Ext.grid.Column.types.hypotcolumn=LBUI.grid.HypotColumn;Ext.grid.Column.types.genobjlinkcolumn=LBUI.grid.GenObjLinkColumn;Ext.grid.Column.types.lbboolcolumn=LBUI.grid.BoolColumn;Ext.grid.Column.types.combocolumn=LBUI.grid.ComboColumn;Ext.grid.Column.types.linkcolumn=LBUI.grid.LinkColumn;Ext.grid.Column.types.multidocumentcolumn=LBUI.grid.MultiDocumentColumn;Ext.data.Record.PREFIX="lb-new-record";LBUI.JsonReader=Ext.extend(Ext.data.JsonReader,{realize:function(b,d){if(Ext.isArray(b)){for(var c=b.length-1;c>=0;c--){if(Ext.isArray(d)){this.realize(b.splice(c,1).shift(),d.splice(c,1).shift())}else{this.realize(b.splice(c,1).shift(),d)}}}else{if(Ext.isArray(d)&&d.length==1){d=d.shift()}if(!this.isData(d)){throw new Ext.data.DataReader.Error("realize",b)}var a=this.extractValues(d,b.fields.items,b.fields.items.length);var e=d[this.meta.idProperty];b.phantom=(e.indexOf(Ext.data.Record.PREFIX)==0);b._phid=b.id;b.id=e;b.data=a;b.commit()}}});LBUI.VTypes=function(){var a=function(d){if(null==d){return 0}var b=0;for(var c=0;c<d.length;c++){b++;if(d.charCodeAt(c)>255){b++}}return b};return{maxlength:function(c,b,d){return c.length<=b.arg},minlength:function(c,b,d){return c.length>=b.arg},maxbytelength:function(c,b,d){return a(c)<=b.arg},minbytelength:function(c,b,d){return a(c)>=b.arg},mask:function(d,b,e){var c=new RegExp(b.arg);return c.test(d)}}}();Ext.apply(Ext.form.Field.prototype,{reconfig:function(a){this.setValue(a.value);this.setDisabled(a.disabled);if(typeof a.readOnly==="boolean"){this.readOnly=a.readOnly;this.el.dom.readOnly=a.readOnly}},extendValidate:function(e){if(e.length>0&&e!==this.emptyText&&this.validators){var a=this.validators.length;for(var d=0;d<a;d++){var b=this.validators[d];var c=Ext.form.VTypes[b.vtype];if(c){if(!c(e,this)){this.markInvalid(String.format(b.invalidText,e));return false}}else{c=LBUI.VTypes[b.vtype];if(c&&!c(e,b,this)){this.markInvalid(String.format(b.invalidText,e));return false}}}}return true}});Ext.apply(Ext.form.TriggerField.prototype,{checkTab:function(a,b){if(b.getKey()==b.TAB||(b.getKey()==b.ENTER&&Ext.isIE&&LBUI.enterToTab===true)){this.triggerBlur()}}});LBUI.ctrl.TextField=Ext.extend(Ext.form.TextField,{validateValue:function(b){var a=LBUI.ctrl.TextField.superclass.validateValue.call(this,b);if(a){a=this.extendValidate(b)}return a}});Ext.reg("lb.textfield",LBUI.ctrl.TextField);LBUI.ctrl.TextArea=Ext.extend(Ext.form.TextArea,{growMin:40,growMax:270,grow:true,validateValue:function(b){var a=LBUI.ctrl.TextArea.superclass.validateValue.call(this,b);if(a){a=this.extendValidate(b)}return a},reconfig:function(a){LBUI.ctrl.TextArea.superclass.reconfig.call(this,a);if(a.readOnly){this.el.addClass("readonly_input")}else{this.el.removeClass("readonly_input")}}});Ext.reg("lb.textarea",LBUI.ctrl.TextArea);LBUI.ctrl.DateField=Ext.extend(Ext.form.DateField,{initComponent:function(){LBUI.ctrl.DateField.superclass.initComponent.call(this);var a=this;this.on("change",function(c,d,b){a.onValueChange(d,b)},this)},formId:"",isEventSource:false,onValueChange:function(b,a){if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}},onTriggerClick:function(){if(this.disabled){return}if(this.menu==null){this.menu=new Ext.menu.DateMenu({hideOnClick:false})}this.onFocus();Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,"tl-bl*");this.menuEvents("on")}});Ext.reg("lb.datefield",LBUI.ctrl.DateField);LBUI.ctrl.OptSearchField=Ext.extend(LBUI.ctrl.TriggerField,{initComponent:function(){LBUI.ctrl.OptSearchField.superclass.initComponent.call(this);var a=this;this.on("change",function(c,d,b){a.onValueChange(d,b)},this)},formId:"",triggerClass:"x-form-search-trigger",hasSearch:false,isEventSource:false,eventName:"OptSearch",onValueChange:function(b,a){document.forms[this.formId].elements[this.id].value=b;document.forms[this.formId].elements["$C{"+this.id+"}"].value="1";if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}else{if(this.isMultiDisp){this.loadMultiDisp({CODEVALUE:b})}}},onTriggerClick:function(){var c=this.id;var f=document.forms[this.formId];var e=f.elements["$C{"+this.id+"}"].value;var b=c+".OPT";var g=f[b].value;var d=f.elements[this.id].value;if(e!="0"&&d!=g){d=""}else{d=encodeURIComponent(d)}var a=this;LBUI.showModalDialog(Ext.urlEncode({extResponse:true,Column:c,Value:d,Control:e,EVENT_SOURCE:this.eventName},f.action),{target:a,width:450,height:500})},loadMultiDisp:function(b){var a=document.forms[this.formId];b=Ext.apply(b||{},{EVENT_SOURCE:"OptSearch.SubDisplayJSON",Column:this.id,extResponse:true});Ext.Ajax.request({url:a.action,params:b,success:function(c,d){try{var g=Ext.decode(c.responseText);if(g.retVal){Ext.DomHelper.overwrite(g.bodyId,g.html)}else{LBUI.Ext.MessageBox.alert("",g.message)}}catch(f){LBUI.Ext.MessageBox.alert("","数据出错")}},failure:function(){LBUI.Ext.MessageBox.alert("","请求失败")}})},onSelect:function(b,a){this.setOptValue(b,a,"0");if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}else{if(this.isMultiDisp){this.loadMultiDisp({ID:b})}}},setOptValue:function(d,a,c){if(Ext.isObject(a)){a=LBUI.LBObjDisplay(a)}if(Ext.isObject(d)){d=LBUI.LBObjValue(d)}this.setValue(a);this.startValue=this.getValue();var b=document.forms[this.formId];b.elements[this.id].value=d;b.elements["$C{"+this.id+"}"].value=c},reconfig:function(a){this.setOptValue(a.internalVal,a.value,a.ctrl);this.setDisabled(a.disabled)},onBlur:function(){var a=this.getValue();if(String(a)!==String(this.startValue)){document.forms[this.formId].elements[this.id].value=a;document.forms[this.formId].elements["$C{"+this.id+"}"].value="1"}}});Ext.reg("lb.opfield",LBUI.ctrl.OptSearchField);LBUI.ctrl.FitBodyPanel=Ext.extend(Ext.Panel,{header:false,autoScroll:true,initComponent:function(){LBUI.ctrl.FitBodyPanel.superclass.initComponent.call(this);if(this.autoHiddenItem){this.on("afterrender",function(){var b=Ext.get(this.autoHiddenItem);b.setDisplayed(false)},this,{single:true,delay:50})}var a=Ext.getCmp("viewport");if(a){a.on("afterlayout",this.onLayoutResize,this,{delay:150})}},onLayoutResize:function(){var b=Ext.getCmp("body");if(b){if(Ext.isWebKit){var d=b.body||b.el;if(d){d.setOverflow("hidden")}}var a=b.getInnerHeight()-12;var c=b.getInnerWidth()-15;this.setSize(c,a);setTimeout(function(){LBUI.Events.fireEvent("bodyLayout")},150)}}});LBUI.ctrl.FitBodyTabPanel=Ext.extend(Ext.TabPanel,{enableTabScroll:true,initComponent:function(){LBUI.ctrl.FitBodyTabPanel.superclass.initComponent.call(this);if(this.autoHiddenItem){this.on("afterrender",function(){var b=Ext.get(this.autoHiddenItem);b.setDisplayed(false)},this,{single:true,delay:50})}var a=Ext.getCmp("viewport");if(a){a.on("afterlayout",this.onLayoutResize,this,{delay:150})}this.on({tabchange:function(c,b){LBUI.Events.fireEvent("bodyLayout")}})},onLayoutResize:function(){var b=Ext.getCmp("body");if(b){if(Ext.isWebKit){var d=b.body||b.el;if(d){d.setOverflow("hidden")}}var a=b.getInnerHeight()-12;var c=b.getInnerWidth()-15;this.setSize(c,a);setTimeout(function(){LBUI.Events.fireEvent("bodyLayout")},150)}}});LBUI.ctrl.LayoutCtTabPanel=Ext.extend(Ext.TabPanel,{enableTabScroll:true,layoutCt:null,initComponent:function(){LBUI.ctrl.LayoutCtTabPanel.superclass.initComponent.call(this);if(this.autoHiddenItem){this.on("afterrender",function(){var b=Ext.get(this.autoHiddenItem);b.setDisplayed(false)},this,{single:true,delay:100})}if(this.layoutCt){this.layoutCt=Ext.get(this.layoutCt);this.width=this.layoutCt.getWidth();this.height=this.layoutCt.getHeight()+30;var a=Ext.getCmp("viewport");if(a){a.on("afterlayout",this.onLayoutResize,this,{delay:50})}else{if(Ext.isIE){this.layoutCt.on("resize",this.onLayoutResize,this)}else{Ext.EventManager.onWindowResize(this.onLayoutResize,this)}}}this.on({tabchange:function(c,b){LBUI.Events.fireEvent("bodyLayout")}})},onLayoutResize:function(){width=this.layoutCt.getWidth();this.setWidth(width);setTimeout(function(){LBUI.Events.fireEvent("bodyLayout")},150)}});LBUI.MenuButton=Ext.extend(Ext.Toolbar.Button,{handler:function(c,d){if(!c.isXType("button")){return}var a="_self";if(c.hrefTarget){a=c.hrefTarget}window.open(c.href,a)}});Ext.reg("lb.menubutton",LBUI.MenuButton);LBUI.MenuTreePanel=Ext.extend(Ext.tree.TreePanel,{initComponent:function(){LBUI.MenuTreePanel.superclass.initComponent.call(this);this.on("click",function(h,g){if(h.attributes.href){var f=g.getTarget("a");if(f){return}else{var d=h.attributes;var c="_self";if(d.hrefTarget){c=d.hrefTarget}window.open(d.href,c)}}})}});Ext.reg("lb-menutreepanel",LBUI.MenuTreePanel);Ext.ux.GridTotals=Ext.extend(Ext.util.Observable,{init:function(b){var a=b.getView();b.gridTotals=this;this.grid=b;this.store=b.getStore();this.store.on({reconfigure:this.onGridReconfigure,scope:this});a.updateTotals=this.updateTotals;a.onLayout=a.onLayout.createSequence(this.onLayout);a.onAllColumnWidthsUpdated=a.onAllColumnWidthsUpdated.createSequence(this.updateTotals)},onLayout:function(){this.updateTotals();this.scroller.setHeight(this.scroller.getHeight()-this.totalsRow.getHeight())},updateTotals:function(){if(!this.totalsRow){this.mainWrap.setStyle("position","relative");this.totalsRow=this.templates.row.append(this.mainWrap,{tstyle:"width:"+this.getTotalWidth(),cells:""},true);this.totalsRow.addClass("x-grid-total-row");this.totalsTr=this.totalsRow.child("tr").dom}var m=this.getColumnData();var b=new Array(m.length);var o=this.grid.store;var j=o.recordType.prototype.fields;for(var h=0,d=this.grid.store.getCount();h<d;h++){var e=o.getAt(h);for(var n=0,g=m.length;n<g;n++){var k=m[n].name;var w=j.get(k).type;if(w=="int"||w=="float"){var s=e.get(k);if(Ext.isDefined(b[n])){b[n]+=s}else{b[n]=s}}}}var u="",a={};for(var n=0,g=m.length,q=g-1;n<g;n++){a.id=m[n].id;a.style=m[n].style;a.css=h==0?"x-grid3-cell-first ":(h==q?"x-grid3-cell-last ":"");var s=Ext.isDefined(b[n])?b[n]:"";u+=this.templates.cell.apply(Ext.apply({value:m[n].renderer(s,a)},m[n]))}Ext.DomHelper.insertHtml("afterBegin",this.totalsTr,u)},onGridReconfigure:Ext.emptyFn});LBUI.ValidationStatus=function(a){Ext.apply(this,a);this.errors=new Ext.util.MixedCollection();if(a.autoStart){this.startMonitoring()}};Ext.extend(LBUI.ValidationStatus,Ext.util.Observable,{startMonitoring:function(){this.form.items.each(function(a){a.on("invalid",this.onFieldValidation,this);a.on("valid",this.onFieldValidation,this)},this)},stopMonitoring:function(){this.form.items.each(function(a){a.un("invalid",this.onFieldValidation,this);a.un("valid",this.onFieldValidation,this)},this);this.errors.clear()},onFieldValidation:function(a,b){if(b){this.errors.add(a.id,{field:a,msg:b})}else{this.errors.removeKey(a.id)}},getErrorList:function(){if(this.errors.getCount()>0){var a='<ul  class="err-list">';this.errors.each(function(b){a+=("<li>"+b.msg+"</li>")},this);return(a+"</ul>")}else{return("")}},fouceError:function(){if(this.errors.getCount()>0){try{this.errors.first().field.focus()}catch(a){}}}});
Ext.override(Ext.grid.GridView,{ensureVisible:function(t,f,e){var r=this.resolveCell(t,f,e);if(!r||!r.row){return}var k=r.row,g=r.cell,n=this.scroller.dom,s=0,d=k,o=this.el.dom;var d=k,o=this.el.dom;while(d&&d!=o){s+=d.offsetTop;d=d.offsetParent}s-=this.mainHd.dom.offsetHeight;var q=s+k.offsetHeight;var a=n.clientHeight;var o=parseInt(n.scrollTop,10);var m=o+a;if(s<o){n.scrollTop=s}else{if(q>m){n.scrollTop=q-a}}if(e!==false){var l=parseInt(g.offsetLeft,10);var j=l+g.offsetWidth;var h=parseInt(n.scrollLeft,10);var b=h+n.clientWidth;if(l<h){n.scrollLeft=l}else{if(j>b){n.scrollLeft=j-n.clientWidth}}}return this.getResolvedXY(r)}});Ext.namespace("Ext.ux.maximgb.tg");Ext.ux.maximgb.tg.AbstractTreeStore=Ext.extend(Ext.data.Store,{leaf_field_name:"_is_leaf",page_offset:0,active_node:null,constructor:function(a){Ext.ux.maximgb.tg.AbstractTreeStore.superclass.constructor.call(this,a);if(!this.paramNames.active_node){this.paramNames.active_node="NODEID"}if(!this.paramNames.action_name){this.paramNames.action_name="ACTIONNAME"}this.addEvents("beforeexpandnode","expandnode","expandnodefailed","beforecollapsenode","collapsenode","beforeactivenodechange","activenodechange")},remove:function(a){if(a===this.active_node){this.setActiveNode(null)}this.removeNodeDescendants(a);Ext.ux.maximgb.tg.AbstractTreeStore.superclass.remove.call(this,a)},removeNodeDescendants:function(d){var c,a,b=this.getNodeChildren(d);for(c=0,a=b.length;c<a;c++){this.remove(b[c])}},load:function(a){if(a){if(a.params){if(a.params[this.paramNames.active_node]===undefined){a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}}else{a.params={};a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}}else{a={params:{}};a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}if(a.params[this.paramNames.active_node]!==null){a.add=true}return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.load.call(this,a)},loadRecords:function(c,q,k){if(!c||k===false){if(k!==false){this.fireEvent("load",this,[],q)}if(q.callback){q.callback.call(q.scope||this,[],q,false)}return}var a=c.records,p=c.totalRecords||a.length,l=this.getPageOffsetFromOptions(q),n=this.getLoadedNodeIdFromOptions(q),j,d,g,f,h,e,m=this;if(!q||q.add!==true||q.params===null||q.params[this.paramNames.action_name]!=="expandnode"||n===null){if(this.pruneModifiedRecords){this.modified=[]}for(var d=0,g=a.length;d<g;d++){f=a[d];h=this.indexOfId(f.id);if(h!=-1){var b=this.getAt(h);if(b){this.setNodeExpanded(f,this.isExpandedNode(b))}}f.join(this)}if(this.snapshot){this.data=this.snapshot;delete this.snapshot}this.data.clear();this.data.addAll(a);this.page_offset=l;this.totalLength=p;this.applySort();this.fireEvent("datachanged",this)}else{if(n){j=this.getById(n);h=this.indexOfId(n)}if(j){this.setNodeChildrenOffset(j,l);this.setNodeChildrenTotalCount(j,Math.max(p,a.length));this.removeNodeDescendants(j)}this.suspendEvents();e={};for(d=0,g=a.length;d<g;d++){f=a[d];e[f.id]=false;f.join(this);this.data.insert(h+d+1,f)}this.applySort();this.resumeEvents();for(d=0,g=a.length;d<g;d++){f=a[d];if(e[f.id]==true){this.fireEvent("update",this,f,Ext.data.Record.COMMIT)}else{this.fireEvent("add",this,[f],this.data.indexOf(f))}}}this.fireEvent("load",this,a,q);if(q.callback){q.callback.call(q.scope||this,a,q,true)}},sort:function(b,a){if(this.remoteSort){this.setActiveNode(null);if(this.lastOptions){this.lastOptions.add=false;if(this.lastOptions.params){this.lastOptions.params[this.paramNames.active_node]=null}}}return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.sort.call(this,b,a)},applySort:function(){if(this.sortInfo&&!this.remoteSort){var a=this.sortInfo,b=a.field;this.sortData(b,a.direction)}else{this.applyTreeSort()}},sortData:function(c,d){d=d||"ASC";var a=this.fields.get(c).sortType;var b=function(f,e){var h=a(f.data[c]),g=a(e.data[c]);return h>g?1:(h<g?-1:0)};this.data.sort(d,b);if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(d,b)}this.applyTreeSort()},applyTreeSort:function(){var e,a,d,f,c=[],b=this.getRootNodes();for(e=0,a=b.length;e<a;e++){f=b[e];c.push(f);this.collectNodeChildrenTreeSorted(c,f)}if(c.length>0){this.data.clear();this.data.addAll(c)}if(this.snapshot&&this.snapshot!==this.data){d=this.data;this.data=this.snapshot;this.snapshot=null;this.applyTreeSort();this.snapshot=this.data;this.data=d}},collectNodeChildrenTreeSorted:function(b,e){var d,a,f,c=this.getNodeChildren(e);for(d=0,a=c.length;d<a;d++){f=c[d];b.push(f);this.collectNodeChildrenTreeSorted(b,f)}},getActiveNode:function(){return this.active_node},setActiveNode:function(a){if(this.active_node!==a){if(a){if(this.data.indexOf(a)!=-1){if(this.fireEvent("beforeactivenodechange",this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}}else{throw"Given record is not from the store."}}else{if(this.fireEvent("beforeactivenodechange",this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}}}},isExpandedNode:function(a){if(a.ux_maximgb_tg_expanded===null||a.ux_maximgb_tg_expanded===undefined){a.ux_maximgb_tg_expanded=a.data._is_node_expanded}return a.ux_maximgb_tg_expanded===true},setNodeExpanded:function(b,a){b.ux_maximgb_tg_expanded=a},isVisibleNode:function(e){var c,b,d=this.getNodeAncestors(e),a=true;for(c=0,b=d.length;c<b;c++){a=a&&this.isExpandedNode(d[c]);if(!a){break}}return a},isLeafNode:function(a){return a.get(this.leaf_field_name)==true},isLoadedNode:function(b){var a;if(b.ux_maximgb_tg_loaded!==undefined){a=b.ux_maximgb_tg_loaded}else{if(this.isLeafNode(b)||this.hasChildNodes(b)){a=true}else{a=false}}return a},setNodeLoaded:function(b,a){b.ux_maximgb_tg_loaded=a},getNodeChildrenOffset:function(a){return a.ux_maximgb_tg_offset||0},setNodeChildrenOffset:function(b,a){b.ux_maximgb_tg_offset=a},getNodeChildrenTotalCount:function(a){return a.ux_maximgb_tg_total||0},setNodeChildrenTotalCount:function(b,a){b.ux_maximgb_tg_total=a},collapseNode:function(a){if(this.isExpandedNode(a)&&this.fireEvent("beforecollapsenode",this,a)!==false){this.setNodeExpanded(a,false);this.fireEvent("collapsenode",this,a)}},expandNode:function(a){var b;if(!this.isExpandedNode(a)&&this.fireEvent("beforeexpandnode",this,a)!==false){if(this.isLoadedNode(a)){this.setNodeExpanded(a,true);this.fireEvent("expandnode",this,a)}else{b={};b[this.paramNames.active_node]=a.id;b[this.paramNames.action_name]="expandnode";this.load({add:true,params:b,callback:this.expandNodeCallback,scope:this})}}},expandNodeCallback:function(b,a,d){var c=this.getById(a.params[this.paramNames.active_node]);if(d&&c){this.setNodeLoaded(c,true);this.setNodeExpanded(c,true);this.fireEvent("expandnode",this,c)}else{this.fireEvent("expandnodefailed",this,a.params[this.paramNames.active_node],c)}},expandAll:function(){var d,c,a,b=this.data.getRange();this.suspendEvents();for(c=0,a=b.length;c<a;c++){d=b[c];if(!this.isExpandedNode(d)){this.expandNode(d)}}this.resumeEvents();this.fireEvent("datachanged",this)},collapseAll:function(){var d,c,a,b=this.data.getRange();this.suspendEvents();for(c=0,a=b.length;c<a;c++){d=b[c];if(this.isExpandedNode(d)){this.collapseNode(d)}}this.resumeEvents();this.fireEvent("datachanged",this)},getLoadedNodeIdFromOptions:function(b){var a=null;if(b&&b.params&&b.params[this.paramNames.active_node]){a=b.params[this.paramNames.active_node]}return a},getPageOffsetFromOptions:function(b){var a=0;if(b&&b.params&&b.params[this.paramNames.start]){a=parseInt(b.params[this.paramNames.start],10);if(isNaN(a)){a=0}}return a},hasNextSiblingNode:function(a){return this.getNodeNextSibling(a)!==null},hasPrevSiblingNode:function(a){return this.getNodePrevSibling(a)!==null},hasChildNodes:function(a){return this.getNodeChildrenCount(a)>0},getNodeAncestors:function(c){var b=[],a;a=this.getNodeParent(c);while(a){b.push(a);a=this.getNodeParent(a)}return b},getNodeChildrenCount:function(a){return this.getNodeChildren(a).length},getNodeNextSibling:function(d){var e,c,b,a=null;c=this.getNodeParent(d);if(c){e=this.getNodeChildren(c)}else{e=this.getRootNodes()}b=e.indexOf(d);if(b<e.length-1){a=e[b+1]}return a},getNodePrevSibling:function(d){var e,c,b,a=null;c=this.getNodeParent(d);if(c){e=this.getNodeChildren(c)}else{e=this.getRootNodes()}b=e.indexOf(d);if(b>0){a=e[b-1]}return a},getRootNodes:function(){throw"Abstract method call"},getNodeDepth:function(a){throw"Abstract method call"},getNodeParent:function(a){throw"Abstract method call"},getNodeChildren:function(a){throw"Abstract method call"},addToNode:function(a,b){throw"Abstract method call"},removeFromNode:function(a,b){throw"Abstract method call"},getPageOffset:function(){return this.page_offset},getActiveNodePageOffset:function(){var a;if(this.active_node){a=this.getNodeChildrenOffset(this.active_node)}else{a=this.getPageOffset()}return a},getActiveNodeCount:function(){var a;if(this.active_node){a=this.getNodeChildrenCount(this.active_node)}else{a=this.getRootNodes().length}return a},getActiveNodeTotalCount:function(){var a;if(this.active_node){a=this.getNodeChildrenTotalCount(this.active_node)}else{a=this.getTotalCount()}return a}});Ext.ux.maximgb.tg.AdjacencyListStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{parent_id_field_name:"_parent",getRootNodes:function(){var d,b,a=[],c=this.data.getRange();for(d=0,b=c.length;d<b;d++){if(c[d].get(this.parent_id_field_name)==null){a.push(c[d])}}return a},getNodeDepth:function(a){return this.getNodeAncestors(a).length},getNodeParent:function(a){return this.getById(a.get(this.parent_id_field_name))},getNodeChildren:function(e){var d,b,a=[],c=this.data.getRange();for(d=0,b=c.length;d<b;d++){if(c[d].get(this.parent_id_field_name)==e.id){a.push(c[d])}}return a},addToNode:function(a,b){b.set(this.parent_id_field_name,a.id);this.addSorted(b)},removeFromNode:function(a,b){this.remove(b)}});Ext.reg("Ext.ux.maximgb.tg.AdjacencyListStore",Ext.ux.maximgb.tg.AdjacencyListStore);Ext.ux.maximgb.tg.NestedSetStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{left_field_name:"_lft",right_field_name:"_rgt",level_field_name:"_level",root_node_level:1,getRootNodes:function(){var d,b,a=[],c=this.data.getRange();for(d=0,b=c.length;d<b;d++){if(c[d].get(this.level_field_name)==this.root_node_level){a.push(c[d])}}return a},getNodeDepth:function(a){return a.get(this.level_field_name)-this.root_node_level},getNodeParent:function(a){var m=null,g,f=this.data.getRange(),h,j,l,e,k,d,c,b;l=a.get(this.left_field_name);k=a.get(this.right_field_name);c=a.get(this.level_field_name);for(h=0,j=f.length;h<j;h++){g=f[h];e=g.get(this.left_field_name);d=g.get(this.right_field_name);b=g.get(this.level_field_name);if(b==c-1&&e<l&&d>k){m=g;break}}return m},getNodeChildren:function(a){var j,e,h,d,b,c,f,g,k=[];f=this.data.getRange();j=a.get(this.left_field_name);h=a.get(this.right_field_name);b=a.get(this.level_field_name);for(i=0,len=f.length;i<len;i++){g=f[i];e=g.get(this.left_field_name);d=g.get(this.right_field_name);c=g.get(this.level_field_name);if(c==b+1&&e>j&&d<h){k.push(g)}}return k}});Ext.ux.maximgb.tg.JsonStore=Ext.extend(Ext.ux.maximgb.tg.AdjacencyListStore,{constructor:function(a){Ext.ux.maximgb.tg.JsonStore.superclass.constructor.call(this,Ext.apply(a,{reader:new Ext.data.JsonReader(a)}))}});Ext.ux.maximgb.tg.GridView=Ext.extend(Ext.grid.GridView,{expanded_icon_class:"ux-maximgb-tg-elbow-minus",last_expanded_icon_class:"ux-maximgb-tg-elbow-end-minus",collapsed_icon_class:"ux-maximgb-tg-elbow-plus",last_collapsed_icon_class:"ux-maximgb-tg-elbow-end-plus",skip_width_update_class:"ux-maximgb-tg-skip-width-update",initTemplates:function(){var a=this.templates||{};if(!a.row){a.row=new Ext.Template('<div class="x-grid3-row ux-maximgb-tg-level-{level} {alt}" style="{tstyle} {display_style}">','<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody>","<tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody>","</table>","</div>")}if(!a.mastercell){a.mastercell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="ux-maximgb-tg-mastercell-wrap">',"{treeui}",'<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</div>","</td>")}if(!a.treeui){a.treeui=new Ext.Template('<div class="ux-maximgb-tg-uiwrap" style="width: {wrap_width}px">',"{elbow_line}",'<div style="left: {left}px" class="{cls}">&#160;</div>',"</div>")}if(!a.elbow_line){a.elbow_line=new Ext.Template('<div style="left: {left}px" class="{cls}">&#160;</div>')}this.templates=a;Ext.ux.maximgb.tg.GridView.superclass.initTemplates.call(this)},doRender:function(g,k,s,a,q,w){var b=this.templates,f=b.cell,h=b.row,l=q-1;var d="width:"+this.getTotalWidth()+";";var z=[],t,A,u={},m={tstyle:d},o;for(var v=0,y=k.length;v<y;v++){o=k[v];t=[];var n=(v+a);var e=this.renderRow(o,n,q,s,this.cm.getTotalWidth());if(e===false){for(var x=0;x<q;x++){A=g[x];u.id=A.id;u.css=x==0?"x-grid3-cell-first ":(x==l?"x-grid3-cell-last ":"");u.attr=u.cellAttr="";u.value=A.renderer(o.data[A.name],u,o,n,x,s);u.style=A.style;if(Ext.isEmpty(u.value)){u.value="&#160;"}if(this.markDirty&&o.dirty&&typeof o.modified[A.name]!=="undefined"){u.css+=" x-grid3-dirty-cell"}if(A.id==this.grid.master_column_id){u.treeui=this.renderCellTreeUI(o,s);f=b.mastercell}else{f=b.cell}t[t.length]=f.apply(u)}}else{t.push(e)}var B=[];if(w&&((n+1)%2==0)){B[0]="x-grid3-row-alt"}if(o.dirty){B[1]=" x-grid3-dirty-row"}m.cols=q;if(this.getRowClass){B[2]=this.getRowClass(o,n,m,s)}m.alt=B.join(" ");m.cells=t.join("");if(!s.isVisibleNode(o)){m.display_style="display: none;"}else{m.display_style=""}m.level=s.getNodeDepth(o);z[z.length]=h.apply(m)}return z.join("")},renderCellTreeUI:function(a,b){var c=this.templates.treeui,h=this.templates.elbow_line,e={},g,d,f=level=b.getNodeDepth(a);e.wrap_width=(f+1)*16;if(level>0){e.elbow_line="";g=a;left=0;while(level--){d=b.getNodeParent(g);if(d){if(b.hasNextSiblingNode(d)){e.elbow_line=h.apply({left:level*16,cls:"ux-maximgb-tg-elbow-line"})+e.elbow_line}else{e.elbow_line=h.apply({left:level*16,cls:"ux-maximgb-tg-elbow-empty"})+e.elbow_line}}else{throw ["Tree inconsistency can't get level ",level+1," node(id=",g.id,") parent."].join("")}g=d}}if(b.isLeafNode(a)){if(b.hasNextSiblingNode(a)){e.cls="ux-maximgb-tg-elbow"}else{e.cls="ux-maximgb-tg-elbow-end"}}else{e.cls="ux-maximgb-tg-elbow-active ";if(b.isExpandedNode(a)){if(b.hasNextSiblingNode(a)){e.cls+=this.expanded_icon_class}else{e.cls+=this.last_expanded_icon_class}}else{if(b.hasNextSiblingNode(a)){e.cls+=this.collapsed_icon_class}else{e.cls+=this.last_collapsed_icon_class}}}e.left=1+f*16;return c.apply(e)},renderRow:function(a,b,e,d,c){return false},afterRender:function(){Ext.ux.maximgb.tg.GridView.superclass.afterRender.call(this);this.updateAllColumnWidths()},updateAllColumnWidths:function(){var d=this.getTotalWidth(),k=this.cm.getColumnCount(),f=[],e,b;for(b=0;b<k;b++){f[b]=this.getColumnWidth(b)}this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;for(b=0;b<k;b++){var c=this.getHeaderCell(b);c.style.width=f[b]}var h=this.getRows(),l,g;for(b=0,e=h.length;b<e;b++){l=h[b];l.style.width=d;if(l.firstChild){l.firstChild.style.width=d;g=l.firstChild.rows[0];for(var a=0;a<k&&a<g.childNodes.length;a++){if(!Ext.fly(g.childNodes[a]).hasClass(this.skip_width_update_class)){g.childNodes[a].style.width=f[a]}}}}this.onAllColumnWidthsUpdated(f,d)},updateColumnWidth:function(b,a){var h=this.getColumnWidth(b);var e=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=e;this.mainBody.dom.style.width=e;var d=this.getHeaderCell(b);d.style.width=h;var g=this.getRows(),j;for(var c=0,f=g.length;c<f;c++){j=g[c];j.style.width=e;if(j.firstChild){j.firstChild.style.width=e;if(b<j.firstChild.rows[0].childNodes.length){if(!Ext.fly(j.firstChild.rows[0].childNodes[b]).hasClass(this.skip_width_update_class)){j.firstChild.rows[0].childNodes[b].style.width=h}}}}this.onColumnWidthUpdated(b,h,e)},updateColumnHidden:function(a,e){var d=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;var g=e?"none":"";var c=this.getHeaderCell(a);c.style.display=g;var h=this.getRows(),k,j;for(var b=0,f=h.length;b<f;b++){k=h[b];k.style.width=d;if(k.firstChild){k.firstChild.style.width=d;if(a<k.firstChild.rows[0].childNodes.length){if(!Ext.fly(k.firstChild.rows[0].childNodes[a]).hasClass(this.skip_width_update_class)){k.firstChild.rows[0].childNodes[a].style.display=g}}}}this.onColumnHiddenUpdated(a,e,d);delete this.lastViewWidth;this.layout()},processRows:function(a,d){var b=0;if(this.ds.getCount()<1){return}d=!this.grid.stripeRows;a=a||0;var c=this.getRows();var b=0;Ext.each(c,function(f,e){f.rowIndex=e;f.className=f.className.replace(this.rowClsRe," ");if(f.style.display!="none"){if(!d&&((b+1)%2===0)){f.className+=" x-grid3-row-alt"}b++}},this);Ext.fly(c[0]).addClass(this.firstRowCls);Ext.fly(c[c.length-1]).addClass(this.lastRowCls)},ensureVisible:function(e,b,d){var c,a=this.ds.getAt(e);if(!this.ds.isVisibleNode(a)){c=this.ds.getNodeAncestors(a);while(c.length>0){a=c.shift();if(!this.ds.isExpandedNode(a)){this.ds.expandNode(a)}}}return Ext.ux.maximgb.tg.GridView.superclass.ensureVisible.call(this,e,b,d)},expandRow:function(d,f){var b=this.ds,c,g,k,h,a,e,j;if(typeof d=="number"){e=d;d=b.getAt(e)}else{e=b.indexOf(d)}f=f||false;k=this.getRow(e);h=Ext.fly(k).child(".ux-maximgb-tg-elbow-active");if(h){if(b.hasNextSiblingNode(d)){h.removeClass(this.collapsed_icon_class);h.removeClass(this.last_collapsed_icon_class);h.addClass(this.expanded_icon_class)}else{h.removeClass(this.collapsed_icon_class);h.removeClass(this.last_collapsed_icon_class);h.addClass(this.last_expanded_icon_class)}}if(b.isVisibleNode(d)){a=b.getNodeChildren(d);for(c=0,g=a.length;c<g;c++){j=b.indexOf(a[c]);k=this.getRow(j);k.style.display="block";if(b.isExpandedNode(a[c])){this.expandRow(j,true)}}}if(!f){this.processRows(0)}},collapseRow:function(d,e){var b=this.ds,c,g,a,j,f,h;if(typeof d=="number"){f=d;d=b.getAt(f)}else{f=b.indexOf(d)}e=e||false;j=this.getRow(f);pmel=Ext.fly(j).child(".ux-maximgb-tg-elbow-active");if(pmel){if(b.hasNextSiblingNode(d)){pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.collapsed_icon_class)}else{pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.last_collapsed_icon_class)}}a=b.getNodeChildren(d);for(c=0,g=a.length;c<g;c++){h=b.indexOf(a[c]);j=this.getRow(h);if(j.style.display!="none"){j.style.display="none";this.collapseRow(h,true)}}if(!e){this.processRows(0)}},initData:function(b,a){Ext.ux.maximgb.tg.GridView.superclass.initData.call(this,b,a);if(this.ds){this.ds.un("expandnode",this.onStoreExpandNode,this);this.ds.un("collapsenode",this.onStoreCollapseNode,this)}if(b){b.on("expandnode",this.onStoreExpandNode,this);b.on("collapsenode",this.onStoreCollapseNode,this)}},onLoad:function(b,a,c){var d;if(c&&c.params&&(c.params[b.paramNames.active_node]===null||b.indexOfId(c.params[b.paramNames.active_node])==-1)){Ext.ux.maximgb.tg.GridView.superclass.onLoad.call(this,b,a,c)}},onAdd:function(c,a,b){Ext.ux.maximgb.tg.GridView.superclass.onAdd.call(this,c,a,b);if(this.mainWrap){this.processRows(0)}},onRemove:function(d,a,b,c){Ext.ux.maximgb.tg.GridView.superclass.onRemove.call(this,d,a,b,c);if(c!==true){if(this.mainWrap){this.processRows(0)}}},onUpdate:function(b,a){Ext.ux.maximgb.tg.GridView.superclass.onUpdate.call(this,b,a);if(this.mainWrap){this.processRows(0)}},onStoreExpandNode:function(a,b){this.expandRow(b)},onStoreCollapseNode:function(a,b){this.collapseRow(b)}});Ext.ux.maximgb.tg.GridPanel=Ext.extend(LBUI.GridPanel,{master_column_id:0,tg_cls:"ux-maximgb-tg-panel",initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.GridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(b,a){Ext.ux.maximgb.tg.GridPanel.superclass.onRender.call(this,b,a);this.el.addClass(this.tg_cls)},getView:function(){if(!this.view){this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig)}return this.view},onClick:function(c){var d=c.getTarget(),g=this.getView(),k=g.findRowIndex(d),h=this.getStore(),a=this.getSelectionModel(),b,f,j=true;if(k!==false){if(Ext.fly(d).hasClass("ux-maximgb-tg-elbow-active")){b=h.getAt(k);if(h.isExpandedNode(b)){h.collapseNode(b)}else{h.expandNode(b)}j=false}}if(j){Ext.ux.maximgb.tg.GridPanel.superclass.onClick.call(this,c)}},onMouseDown:function(b){var a=b.getTarget();if(!Ext.fly(a).hasClass("ux-maximgb-tg-elbow-active")){Ext.ux.maximgb.tg.GridPanel.superclass.onMouseDown.call(this,b)}},onTreeGridSelectionChange:function(e,d){var a,c,b=this.getStore();if(e.getSelected){a=e.getSelected();b.setActiveNode(a)}else{if(e.getSelectedCell&&d){a=d.record;b.setActiveNode(a)}}if(a){if(!b.isVisibleNode(a)){c=b.getNodeAncestors(a);while(c.length>0){b.expandNode(c.pop())}}}}});Ext.ux.maximgb.tg.EditorGridPanel=Ext.extend(LBUI.EditorGridPanel,{master_column_id:0,initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.EditorGridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(b,a){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onRender.call(this,b,a);this.el.addClass("ux-maximgb-tg-panel")},getView:function(){if(!this.view){this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig)}return this.view},onClick:function(c){var d=c.getTarget(),g=this.getView(),k=g.findRowIndex(d),h=this.getStore(),a=this.getSelectionModel(),b,f,j=true;if(k!==false){if(Ext.fly(d).hasClass("ux-maximgb-tg-elbow-active")){b=h.getAt(k);if(h.isExpandedNode(b)){h.collapseNode(b)}else{h.expandNode(b)}j=false}}if(j){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onClick.call(this,c)}},onMouseDown:function(b){var a=b.getTarget();if(!Ext.fly(a).hasClass("ux-maximgb-tg-elbow-active")){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onMouseDown.call(this,b)}},onTreeGridSelectionChange:function(e,d){var a,c,b=this.getStore();if(e.getSelected){a=e.getSelected();b.setActiveNode(a)}else{if(e.getSelectedCell&&d){a=d.record;b.setActiveNode(a)}}if(a){if(!b.isVisibleNode(a)){c=b.getNodeAncestors(a);while(c.length>0){b.expandNode(c.pop())}}}}});Ext.ux.maximgb.tg.PagingToolbar=Ext.extend(Ext.PagingToolbar,{onRender:function(b,a){Ext.ux.maximgb.tg.PagingToolbar.superclass.onRender.call(this,b,a);this.updateUI()},getPageData:function(){var a=0,b=0;if(this.store){b=this.store.getActiveNodePageOffset();a=this.store.getActiveNodeTotalCount()}return{total:a,activePage:Math.ceil((b+this.pageSize)/this.pageSize),pages:a<this.pageSize?1:Math.ceil(a/this.pageSize)}},updateInfo:function(){var b=0,d=0,a=0,c;if(this.displayItem){if(this.store){d=this.store.getActiveNodePageOffset();b=this.store.getActiveNodeCount();a=this.store.getActiveNodeTotalCount()}c=b==0?this.emptyMsg:String.format(this.displayMsg,d+1,d+b,a);this.displayItem.setText(c)}},updateUI:function(){var c=this.getPageData(),a=c.activePage,b=c.pages;this.afterTextItem.setText(String.format(this.afterPageText,c.pages));this.inputItem.setValue(a);this.first.setDisabled(a==1);this.prev.setDisabled(a==1);this.next.setDisabled(a==b);this.last.setDisabled(a==b);this.refresh.enable();this.updateInfo()},bindStore:function(a,b){if(!b&&this.store){this.store.un("activenodechange",this.onStoreActiveNodeChange,this)}if(a){a.on("activenodechange",this.onStoreActiveNodeChange,this)}Ext.ux.maximgb.tg.PagingToolbar.superclass.bindStore.call(this,a,b)},beforeLoad:function(a,b){var c=this.getParams();Ext.ux.maximgb.tg.PagingToolbar.superclass.beforeLoad.call(this,a,b);if(b&&b.params){if(b.params[c.start]===undefined){b.params[c.start]=0}if(b.params[c.limit]===undefined){b.params[c.limit]=this.pageSize}}},moveFirst:function(){this.doLoad(0)},movePrevious:function(){var a=this.store,b=a?a.getActiveNodePageOffset():0;this.doLoad(Math.max(0,b-this.pageSize))},moveNext:function(){var a=this.store,b=a?a.getActiveNodePageOffset():0;this.doLoad(b+this.pageSize)},moveLast:function(){var b=this.store,d=b?b.getActiveNodePageOffset():0,c=b?b.getActiveNodeTotalCount():0,a=c%this.pageSize;this.doLoad(a?(c-a):c-this.pageSize)},onStoreActiveNodeChange:function(b,c,a){if(this.rendered){this.updateUI()}}});Ext.reg("Ext.ux.maximgb.tg.GridPanel",Ext.ux.maximgb.tg.GridPanel);Ext.reg("Ext.ux.maximgb.tg.EditorGridPanel",Ext.ux.maximgb.tg.EditorGridPanel);Ext.reg("Ext.ux.maximgb.tg.PagingToolbar",Ext.ux.maximgb.tg.PagingToolbar);
Ext.ns("LBUI.grid");LBUI.grid.LockingGridView=Ext.extend(Ext.grid.GridView,{lockText:"冻结列",unlockText:"取消冻结",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:true,initTemplates:function(){var a=this.templates||{};if(!a.master){a.master=new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>")}this.templates=a;LBUI.grid.LockingGridView.superclass.initTemplates.call(this)},getEditorParent:function(a){return this.el.dom},initElements:function(){var c=Ext.Element;var b=this.grid.getGridEl().dom.firstChild;var a=b.childNodes;this.el=new c(b);this.lockedWrap=new c(a[0]);this.lockedHd=new c(this.lockedWrap.dom.firstChild);this.lockedInnerHd=this.lockedHd.dom.firstChild;this.lockedScroller=new c(this.lockedWrap.dom.childNodes[1]);this.lockedBody=new c(this.lockedScroller.dom.firstChild);this.mainWrap=new c(a[1]);this.mainHd=new c(this.mainWrap.dom.firstChild);if(this.grid.hideHeaders){this.lockedHd.setDisplayed(false);this.mainHd.setDisplayed(false)}this.innerHd=this.mainHd.dom.firstChild;this.scroller=new c(this.mainWrap.dom.childNodes[1]);if(this.forceFit){this.scroller.setStyle("overflow-x","hidden")}this.mainBody=new c(this.scroller.dom.firstChild);this.focusEl=new c(this.scroller.dom.childNodes[1]);this.focusEl.swallowEvent("click",true);this.resizeMarker=new c(a[2]);this.resizeProxy=new c(a[3])},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(a){return this.getLockedRows()[a]},getCell:function(c,a){var b=this.cm.getLockedCount();if(a<b){return this.getLockedRow(c).getElementsByTagName("td")[a]}return LBUI.grid.LockingGridView.superclass.getCell.call(this,c,a-b)},getHeaderCell:function(a){var b=this.cm.getLockedCount();if(a<b){return this.lockedHd.dom.getElementsByTagName("td")[a]}return LBUI.grid.LockingGridView.superclass.getHeaderCell.call(this,a-b)},addRowClass:function(c,a){var b=this.getLockedRow(c);if(b){this.fly(b).addClass(a)}LBUI.grid.LockingGridView.superclass.addRowClass.call(this,c,a)},removeRowClass:function(c,a){var b=this.getLockedRow(c);if(b){this.fly(b).removeClass(a)}LBUI.grid.LockingGridView.superclass.removeRowClass.call(this,c,a)},removeRow:function(a){Ext.removeNode(this.getLockedRow(a));LBUI.grid.LockingGridView.superclass.removeRow.call(this,a)},removeRows:function(c,a){var b=this.lockedBody.dom;for(var d=c;d<=a;d++){Ext.removeNode(b.childNodes[c])}LBUI.grid.LockingGridView.superclass.removeRows.call(this,c,a)},syncScroll:function(a){var b=this.scroller.dom;this.lockedScroller.dom.scrollTop=b.scrollTop;LBUI.grid.LockingGridView.superclass.syncScroll.call(this,a)},updateSortIcon:function(c,b){var g=this.sortClasses,d=this.lockedHd.select("td").removeClass(g),f=this.mainHd.select("td").removeClass(g),e=this.cm.getLockedCount(),a=g[b=="DESC"?1:0];if(c<e){d.item(c).addClass(a)}else{f.item(c-e).addClass(a)}},updateAllColumnWidths:function(){var g=this.getTotalWidth(),n=this.cm.getColumnCount(),b=this.getLockedWidth(),d=this.cm.getLockedCount(),k=[],h,e;this.updateLockedWidth();for(e=0;e<n;e++){k[e]=this.getColumnWidth(e);var f=this.getHeaderCell(e);f.style.width=k[e]}var a=this.getLockedRows(),m=this.getRows(),o,l,c;for(e=0,h=m.length;e<h;e++){o=a[e];o.style.width=b;if(o.firstChild){o.firstChild.style.width=b;l=o.firstChild.rows[0];for(c=0;c<d;c++){l.childNodes[c].style.width=k[c]}}o=m[e];o.style.width=g;if(o.firstChild){o.firstChild.style.width=g;l=o.firstChild.rows[0];for(c=d;c<n;c++){l.childNodes[c-d].style.width=k[c]}}}this.onAllColumnWidthsUpdated(k,g);this.syncHeaderHeight()},updateColumnWidth:function(d,a){var l=this.getColumnWidth(d),e=this.cm.getLockedCount(),k,b,j,m;this.updateLockedWidth();if(d<e){k=this.getLockedRows();b=this.getLockedWidth();j=d}else{k=this.getRows();b=this.getTotalWidth();j=d-e}var g=this.getHeaderCell(d);g.style.width=l;for(var f=0,h=k.length;f<h;f++){m=k[f];m.style.width=b;if(m.firstChild){m.firstChild.style.width=b;m.firstChild.rows[0].childNodes[j].style.width=l}}this.onColumnWidthUpdated(d,l,this.getTotalWidth());this.syncHeaderHeight()},updateColumnHidden:function(b,g){var d=this.cm.getLockedCount(),l,a,k,m,j=g?"none":"";this.updateLockedWidth();if(b<d){l=this.getLockedRows();a=this.getLockedWidth();k=b}else{l=this.getRows();a=this.getTotalWidth();k=b-d}var f=this.getHeaderCell(b);f.style.display=j;for(var e=0,h=l.length;e<h;e++){m=l[e];m.style.width=a;if(m.firstChild){m.firstChild.style.width=a;m.firstChild.rows[0].childNodes[k].style.display=j}}this.onColumnHiddenUpdated(b,g,this.getTotalWidth());delete this.lastViewWidth;this.layout()},doRender:function(g,l,t,a,s,x){var d=this.templates,f=d.cell,h=d.row,n=s-1,e="width:"+this.getTotalWidth()+";",b="width:"+this.getLockedWidth()+";",A=[],D=[],v,k,B,u={},m={},q;for(var w=0,z=l.length;w<z;w++){q=l[w];v=[];k=[];var o=(w+a);for(var y=0;y<s;y++){B=g[y];u.id=B.id;u.css=(y===0?"x-grid3-cell-first ":(y==n?"x-grid3-cell-last ":""))+(this.cm.config[y].cellCls?" "+this.cm.config[y].cellCls:"");u.attr=u.cellAttr="";u.value=B.renderer(q.data[B.name],u,q,o,y,t);u.style=B.style;if(Ext.isEmpty(u.value)){u.value="&#160;"}if(this.markDirty&&q.dirty&&Ext.isDefined(q.modified[B.name])){u.css+=" x-grid3-dirty-cell"}if(B.locked){k[k.length]=f.apply(u)}else{v[v.length]=f.apply(u)}}var C=[];if(x&&((o+1)%2===0)){C[0]="x-grid3-row-alt"}if(q.dirty){C[1]=" x-grid3-dirty-row"}m.cols=s;if(this.getRowClass){C[2]=this.getRowClass(q,o,m,t)}m.alt=C.join(" ");m.cells=v.join("");m.tstyle=e;A[A.length]=h.apply(m);m.cells=k.join("");m.tstyle=b;D[D.length]=h.apply(m)}return[A.join(""),D.join("")]},processRows:function(k,g){if(!this.ds||this.ds.getCount()<1){return}var m=this.getRows(),e=this.getLockedRows(),l,j;g=g||!this.grid.stripeRows;k=k||0;for(var c=0,d=m.length;c<d;++c){l=m[c];j=e[c];l.rowIndex=c;j.rowIndex=c;if(!g){l.className=l.className.replace(this.rowClsRe," ");j.className=j.className.replace(this.rowClsRe," ");if((c+1)%2===0){l.className+=" x-grid3-row-alt";j.className+=" x-grid3-row-alt"}}if(this.syncHeights){var b=Ext.get(l),a=Ext.get(j),h=b.getHeight(),f=a.getHeight();if(h>f){a.setHeight(h)}else{if(f>h){b.setHeight(f)}}}}if(k===0){Ext.fly(m[0]).addClass(this.firstRowCls);Ext.fly(e[0]).addClass(this.firstRowCls)}Ext.fly(m[m.length-1]).addClass(this.lastRowCls);Ext.fly(e[e.length-1]).addClass(this.lastRowCls)},afterRender:function(){if(!this.ds||!this.cm){return}var a=this.renderRows()||["&#160;","&#160;"];this.mainBody.dom.innerHTML=a[0];this.lockedBody.dom.innerHTML=a[1];this.processRows(0,true);if(this.deferEmptyText!==true){this.applyEmptyText()}},renderUI:function(){var d=this.renderHeaders();var a=this.templates.body.apply({rows:"&#160;"});var b=this.templates.master.apply({body:a,header:d[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:a,lockedHeader:d[1],lstyle:"width:"+this.getLockedWidth()+";"});var c=this.grid;c.getGridEl().dom.innerHTML=b;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(c.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(c,this.mainHd.dom);this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom));this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))}if(c.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(c,this.innerHd);this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd));this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd));this.columnDrop=new Ext.grid.HeaderDropZone(c,this.mainHd.dom)}if(c.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:c.id+"-hctx"});this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});if(this.grid.enableColLock!==false){this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"})}if(c.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:c.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(c.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut});this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(c.enableDragDrop||c.enableDrag){this.dragZone=new Ext.grid.GridDragZone(c,{ddGroup:c.ddGroup||"GridDD"})}this.updateHeaderSortState()},layout:function(){if(!this.mainBody){return}var d=this.grid;var h=d.getGridEl();var a=h.getSize(true);var b=a.width;if(!d.hideHeaders&&(b<20||a.height<20)){return}this.syncHeaderHeight();if(d.autoHeight){this.scroller.dom.style.overflow="visible";this.lockedScroller.dom.style.overflow="visible";if(Ext.isWebKit){this.scroller.dom.style.position="static";this.lockedScroller.dom.style.position="static"}}else{this.el.setSize(a.width,a.height);var f=this.mainHd.getHeight();var e=a.height-(f)}this.updateLockedWidth();if(this.forceFit){if(this.lastViewWidth!=b){this.fitColumns(false,false);this.lastViewWidth=b}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(b,e)},onLayout:function(b,d){var a=this.grid;if(a.autoHeight){var c=this;c.scroller.dom.style.overflow="auto";c.lockedScroller.dom.style.overflow="hidden";setTimeout(function(){var g=c.mainHd.getHeight();d=c.scroller.dom.scrollHeight;if(c.scroller.dom.scrollWidth>b){d+=17}var e=g+d;if(a.maxHeight&&e>a.maxHeight){e=a.maxHeight;d=e-g}if(a.minHeight&&e<a.minHeight){e=a.minHeight;d=e-g}if(Ext.isIE){e+=a.body.getBorderWidth("tb")+a.body.getPadding("tb")}var f=a.getGridEl();if(!Ext.isIE||e>f.dom.clientHeight||(a.maxHeight&&a.maxHeight<f.dom.clientHeight)){a.body.dom.style.height=(e)+"px";c.el.dom.style.height=(e)+"px";c.lockedScroller.dom.style.height=d+"px";c.scroller.dom.style.height=d+"px"}},60)}},getOffsetWidth:function(){return(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+this.getScrollOffset())+"px"},renderHeaders:function(){var h=this.cm,f=this.templates,d=f.hcell,b=[],g=[],a={},e=h.getColumnCount(),j=e-1;for(var c=0;c<e;c++){a.id=h.getColumnId(c);a.value=h.getColumnHeader(c)||"";a.style=this.getColumnStyle(c,true);a.tooltip=this.getColumnTooltip(c);a.css=(c===0?"x-grid3-cell-first ":(c==j?"x-grid3-cell-last ":""))+(h.config[c].headerCls?" "+h.config[c].headerCls:"");if(h.config[c].align=="right"){a.istyle="padding-right:16px"}else{delete a.istyle}if(h.isLocked(c)){g[g.length]=d.apply(a)}else{b[b.length]=d.apply(a)}}return[f.header.apply({cells:b.join(""),tstyle:"width:"+this.getTotalWidth()+";"}),f.header.apply({cells:g.join(""),tstyle:"width:"+this.getLockedWidth()+";"})]},updateHeaders:function(){var b=this.renderHeaders();this.innerHd.firstChild.innerHTML=b[0];this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth();this.lockedInnerHd.firstChild.innerHTML=b[1];var a=this.getLockedWidth();this.lockedInnerHd.firstChild.style.width=a;this.lockedInnerHd.firstChild.firstChild.style.width=a},getResolvedXY:function(a){if(!a){return null}var d=a.cell,b=a.row;return d?Ext.fly(d).getXY():[this.scroller.getX(),Ext.fly(b).getY()]},syncFocusEl:function(c,a,b){LBUI.grid.LockingGridView.superclass.syncFocusEl.call(this,c,a,a<this.cm.getLockedCount()?false:b)},ensureVisible:function(c,a,b){return LBUI.grid.LockingGridView.superclass.ensureVisible.call(this,c,a,a<this.cm.getLockedCount()?false:b)},insertRows:function(a,g,d,f){var c=a.getCount()-1;if(!f&&g===0&&d>=c){this.refresh()}else{if(!f){this.fireEvent("beforerowsinserted",this,g,d)}var b=this.renderRows(g,d),e=this.getRow(g);if(e){if(g===0){this.removeRowClass(0,this.firstRowCls)}Ext.DomHelper.insertHtml("beforeBegin",e,b[0]);e=this.getLockedRow(g);Ext.DomHelper.insertHtml("beforeBegin",e,b[1])}else{this.removeRowClass(c-1,this.lastRowCls);Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,b[0]);Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,b[1])}if(!f){this.fireEvent("rowsinserted",this,g,d);this.processRows(g)}else{if(g===0||g>=c){this.addRowClass(g,g===0?this.firstRowCls:this.lastRowCls)}}}this.syncFocusEl(g)},getColumnStyle:function(a,c){var b=!c?this.cm.config[a].cellStyle||this.cm.config[a].css||"":this.cm.config[a].headerStyle||"";b+="width:"+this.getColumnWidth(a)+";";if(this.cm.isHidden(a)){b+="display:none;"}var d=this.cm.config[a].align;if(d){b+="text-align:"+d+";"}return b},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px"},getTotalWidth:function(){return(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth())+"px"},getColumnData:function(){var d=[],a=this.cm,e=a.getColumnCount();for(var c=0;c<e;c++){var b=a.getDataIndex(c);d[c]={name:(!Ext.isDefined(b)?this.ds.fields.get(c).name:b),renderer:a.getRenderer(c),id:a.getColumnId(c),style:this.getColumnStyle(c),locked:a.isLocked(c)}}return d},renderBody:function(){var a=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:a[0]}),this.templates.body.apply({rows:a[1]})]},refreshRow:function(a){LBUI.grid.LockingGridView.superclass.refreshRow.call(this,a);var b=Ext.isNumber(a)?a:this.ds.indexOf(a);this.getLockedRow(b).rowIndex=b},refresh:function(b){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var a=this.renderBody();this.mainBody.update(a[0]).setWidth(this.getTotalWidth());this.lockedBody.update(a[1]).setWidth(this.getLockedWidth());if(b===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},onDenyColumnLock:function(){},initData:function(b,a){if(this.cm){this.cm.un("columnlockchange",this.onColumnLock,this)}LBUI.grid.LockingGridView.superclass.initData.call(this,b,a);if(this.cm){this.cm.on("columnlockchange",this.onColumnLock,this)}},onColumnLock:function(){this.refresh(true)},handleHdMenuClick:function(d){var b=this.hdCtxIndex,a=this.cm,e=d.getItemId(),c=a.getLockedCount();switch(e){case"lock":if(a.getColumnCount(true)<=c+1){this.onDenyColumnLock();return}if(c!=b){a.setLocked(b,true,true);a.moveColumn(b,c);this.grid.fireEvent("columnmove",b,c)}else{a.setLocked(b,true)}break;case"unlock":if(c-1!=b){a.setLocked(b,false,true);a.moveColumn(b,c-1);this.grid.fireEvent("columnmove",b,c-1)}else{a.setLocked(b,false)}break;default:return LBUI.grid.LockingGridView.superclass.handleHdMenuClick.call(this,d)}return true},handleHdDown:function(g,d){LBUI.grid.LockingGridView.superclass.handleHdDown.call(this,g,d);if(this.grid.enableColLock!==false){if(Ext.fly(d).hasClass("x-grid3-hd-btn")){var f=this.findHeaderCell(d),c=this.getCellIndex(f),b=this.hmenu.items,a=this.cm;b.get("lock").setDisabled(a.isLocked(c));b.get("unlock").setDisabled(!a.isLocked(c))}}},syncHeaderHeight:function(){this.innerHd.firstChild.firstChild.style.height="auto";this.lockedInnerHd.firstChild.firstChild.style.height="auto";var c=this.innerHd.firstChild.firstChild.offsetHeight,b=this.lockedInnerHd.firstChild.firstChild.offsetHeight,a=(b>c?b:c)+"px";this.innerHd.firstChild.firstChild.style.height=a;this.lockedInnerHd.firstChild.firstChild.style.height=a},updateLockedWidth:function(){var g=this.cm.getTotalLockedWidth(),a=this.cm.getTotalWidth()-g,c=this.grid.getGridEl().getSize(true),b=Ext.isBorderBox?0:this.lockedBorderWidth,d=Ext.isBorderBox?0:this.rowBorderWidth,e=(c.width-g-b-d)+"px",f=this.getScrollOffset();if(!this.grid.autoHeight){var h=(c.height-this.mainHd.getHeight())+"px";this.lockedScroller.dom.style.height=h;this.scroller.dom.style.height=h}this.lockedWrap.dom.style.width=(g+d)+"px";this.scroller.dom.style.width=e;this.mainWrap.dom.style.left=(g+b+d)+"px";if(this.innerHd){this.lockedInnerHd.firstChild.style.width=g+"px";this.lockedInnerHd.firstChild.firstChild.style.width=g+"px";this.innerHd.style.width=e;this.innerHd.firstChild.style.width=(a+d+f)+"px";this.innerHd.firstChild.firstChild.style.width=a+"px"}if(this.mainBody){this.lockedBody.dom.style.width=(g+d)+"px";this.mainBody.dom.style.width=(a+d)+"px"}}});LBUI.grid.LockingColumnModel=Ext.extend(LBUI.grid.ColumnModel,{isLocked:function(a){return this.config[a].locked===true},setLocked:function(b,c,a){if(this.isLocked(b)==c){return}this.config[b].locked=c;if(!a){this.fireEvent("columnlockchange",this,b,c)}},getTotalLockedWidth:function(){var b=0;for(var c=0,a=this.config.length;c<a;c++){if(this.isLocked(c)&&!this.isHidden(c)){b+=this.getColumnWidth(c)}}return b},getLockedCount:function(){for(var b=0,a=this.config.length;b<a;b++){if(!this.isLocked(b)){return b}}},moveColumn:function(b,a){if(b<a&&this.isLocked(b)&&!this.isLocked(a)){this.setLocked(b,false,true)}else{if(b>a&&!this.isLocked(b)&&this.isLocked(a)){this.setLocked(b,true,true)}}LBUI.grid.LockingColumnModel.superclass.moveColumn.apply(this,arguments)}});
Ext.ns("LBUI.grid");LBUI.grid.GridSummary=function(a){Ext.apply(this,a)};Ext.extend(LBUI.grid.GridSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;if(this.grid.autoHeight){a.afterMethod("adjustViewSize",this.onLayout,this)}else{a.afterMethod("onLayout",this.onLayout,this)}a.afterMethod("render",this.refreshSummary,this);a.afterMethod("refresh",this.refreshSummary,this);a.afterMethod("syncScroll",this.syncSummaryScroll,this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);b.store.on({add:this.refreshSummary,remove:this.refreshSummary,clear:this.refreshSummary,update:this.refreshSummary,scope:this});if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row x-grid3-gridsummary-row-offset">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table>","</div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},calculate:function(c,l){var e={},h=l.config;for(var f=0,k=h.length;f<k;f++){var b=h[f],g=b.dataIndex;e[g]=0;if(b.summaryType){for(var d=0,m=c.length;d<m;d++){var a=c[d];e[g]=LBUI.grid.GridSummary.Calculations[b.summaryType](a.get(g),a,g,e,d)}}}return e},onLayout:function(a,b){if(Ext.type(b)!="number"){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.view.scroller.setHeight(b-this.view.summary.getHeight())}},syncSummaryScroll:function(){var a=this.view.scroller.dom;this.view.summaryWrap.dom.scrollLeft=a.scrollLeft;this.view.summaryWrap.dom.scrollLeft=a.scrollLeft},doWidth:function(c,a,b){var d=this.view.summary.dom;d.firstChild.style.width=b;d.firstChild.rows[0].childNodes[c].style.width=a},doAllWidths:function(a,b){var e=this.view.summary.dom,f=a.length;e.firstChild.style.width=b;var d=e.firstChild.rows[0].childNodes;for(var c=0;c<f;c++){d[c].style.width=a[c]}},doHidden:function(b,d,a){var c=this.view.summary.dom,e=d?"none":"";c.firstChild.style.width=a;c.firstChild.rows[0].childNodes[b].style.display=e},renderSummary:function(d,g,l){g=g||this.view.getColumnData();var h=l.config,e=[],m=g.length-1;for(var f=0,j=g.length;f<j;f++){var k=g[f],b=h[f],a={};a.id=k.id;a.style=k.style;a.css=f===0?"x-grid3-cell-first ":(f==m?"x-grid3-cell-last ":"");if(b.summaryType||b.summaryRenderer){a.value=(b.summaryRenderer||k.renderer)(d.data[k.name],a)}else{a.value=""}if(a.value===undefined||a.value===""){a.value="&#160;"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},refreshSummary:function(){var e=this.grid,h=e.store,d=this.view.getColumnData(),a=this.cm,b=h.getRange(),f=this.calculate(b,a),c=this.renderSummary({data:f},d,a);if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}this.view.summary=this.view.summaryWrap.update(c).first()},toggleSummary:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-gridsummary")}a[b?"removeClass":"addClass"]("x-grid-hide-gridsummary");this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Ext.reg("gridsummary",LBUI.grid.GridSummary);LBUI.grid.GridSummary.Calculations={sum:function(b,a,d,c){return(b||0)+c[d]},count:function(b,a,d,c){return c[d+"count"]?++c[d+"count"]:(c[d+"count"]=1)},max:function(c,b,e,d){var c=b.data[e];var a=d[e+"max"]===undefined?(d[e+"max"]=c):d[e+"max"];return c>a?(d[e+"max"]=c):a},min:function(b,a,e,d){var b=a.data[e];var c=d[e+"min"]===undefined?(d[e+"min"]=b):d[e+"min"];return b<c?(d[e+"min"]=b):c},avg:function(b,a,f,e){var g=e[f+"count"]?++e[f+"count"]:(e[f+"count"]=1);var d=(e[f+"total"]=((e[f+"total"]||0)+(a.data[f]||0)));return d===0?0:d/g}};
Ext.ns("LBUI.ctrl");LBUI.ctrl.MultiRefObjSearchField=Ext.extend(Ext.form.Field,{MultiRefObjSearch:function(){var d=document.forms[this.formId];var b=this.id;var c=d.elements[this.id].value;var a=Ext.urlEncode({extResponse:true,Column:b,Value:c,EVENT_SOURCE:this.eventName},d.action);var e=this;LBUI.showModalDialog(a,{target:e,width:650,height:500})},getTrigger:function(){return Ext.get(this.id+".EditBtn")},initComponent:function(){LBUI.ctrl.MultiRefObjSearchField.superclass.initComponent.call(this);var a=this.getTrigger();if(a!=null){a.on("click",this.MultiRefObjSearch,this)}},isEventSource:false,response:function(b){var g=document.forms[this.formId];var f=this.id;var h=f+".OPT";var e=Ext.get(h);var d=b;var a=d.value;if(a==g.elements[f].value){return}g.elements[f].value=a;if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}else{var c=d.response;Ext.DomHelper.overwrite(e.dom,c);if(Ext.isIE){e.setVisibilityMode(Ext.Element.DISPLAY);if(c!=null&&c.length>0){e.show()}else{e.hide()}}}},setDisabled:function(a){LBUI.ctrl.MultiRefObjSearchField.superclass.setDisabled.call(this,a);var b=this.getTrigger();if(b!=null){if(a){b.hide()}else{b.show()}}},reconfig:function(a){this.setValue(a.internalVal);this.setDisabled(a.disabled)}});Ext.reg("lb.multioptfield",LBUI.ctrl.MultiRefObjSearchField);LBUI.RemoteComponent=function(a){var d=a.xtype||"panel";Ext.applyIf(a,{purgeSubscribers:true});this.initialConfig=a;Ext.apply(this,a);this.addEvents({beforecontainshow:true});LBUI.RemoteComponent.superclass.constructor.call(this,a);var b=function(e){component=this.container.add(e);return component}.createDelegate(this);var c=function(f){var g=Ext.decode(f.responseText);var e=null;if(g instanceof Array){Ext.each(g,function(h,k){e=b(h).show()})}else{e=b(g).show()}this.fireEvent("beforecontainshow",e,this);this.container.doLayout();if(this.purgeSubscribers){this.purgeListeners()}}.createDelegate(this);this.load=function(){Ext.Ajax.request(Ext.apply(a,{success:c,scope:this}))};this.init=function(e){e.on("beforedestroy",function(){this.purgeListeners()},this);this.container=e;e.on(a.loadOn,this.load,this,{single:true})}};Ext.extend(LBUI.RemoteComponent,Ext.util.Observable);LBUI.ctrl.GeneralObjSearchField=Ext.extend(Ext.form.Field,{getTrigger:function(){return Ext.get(this.id+".EditBtn")},initComponent:function(){LBUI.ctrl.MultiRefObjSearchField.superclass.initComponent.call(this);var a=this.getTrigger();if(a!=null){a.on("click",this.GeneralObjSearch,this)}},GeneralObjSearch:function(){var d=document.forms[this.formId];var b=this.id;var c=d.elements[this.id].value;var a=Ext.urlEncode({extResponse:true,Column:b,Value:c,EVENT_SOURCE:this.eventName},d.action);var e=this;LBUI.showModalDialog(a,{target:e,width:650,height:500})},isEventSource:false,response:function(b){var g=document.forms[this.formId];var f=this.id;var h=f+".OPT";var e=Ext.get(h);var d=b;var a=d.value;if(a==g.elements[f].value){return}g.elements[f].value=a;if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}else{var c=d.response;Ext.DomHelper.overwrite(e.dom,c)}},setDisabled:function(a){LBUI.ctrl.MultiRefObjSearchField.superclass.setDisabled.call(this,a);var b=this.getTrigger();if(b!=null){if(a){b.hide()}else{b.show()}}},reconfig:function(a){this.setValue(a.internalVal);this.setDisabled(a.disabled)}});Ext.reg("lb.genobjfield",LBUI.ctrl.GeneralObjSearchField);LBUI.ctrl.SingleGenObjField=Ext.extend(LBUI.ctrl.TriggerField,{initComponent:function(){LBUI.ctrl.SingleGenObjField.superclass.initComponent.call(this)},formId:"",triggerClass:"x-form-search-trigger",hasSearch:false,isEventSource:false,editable:false,onTriggerClick:function(){if(this.disabled){return}var b=document.forms[this.formId];var a=this;LBUI.showModalDialog(Ext.urlEncode(this.getTriggerParams(b),b.action),{target:a,width:450,height:500})},response:function(b){var f=document.forms[this.formId];var e=this.id;var h=e+".OPT";var d=Ext.get(h);var c=b;var a=c.value;if(a==f.elements[e].value){return}f.elements[e].value=a;if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}else{var g=c.response;d.dom.value=g}},reconfig:function(a){this.setValue(a.internalVal);this.setDisabled(a.disabled)},getTriggerParams:function(e){var b=this.id;var d=e.elements["$C{"+this.id+"}"].value;var a=b+".OPT";var f=e[a].value;var c=e.elements[this.id].value;if(d!="0"&&c!=f){c=""}else{c=encodeURIComponent(c)}return{extResponse:true,Column:b,Value:c,Control:d,EVENT_SOURCE:this.eventName}}});Ext.reg("lb.singlegenobjfield",LBUI.ctrl.SingleGenObjField);Ext.clone=function(d,e,b){if(b){Ext.apply(d,b)}if(d&&e&&typeof e=="object"){for(var a in e){if(Ext.isObject(e[a])){d[a]=new Object();Ext.apply(d[a],e[a])}else{d[a]=e[a]}}}return d};LBUI.ctrl.DropOptListField=Ext.extend(LBUI.ctrl.AutoSizeComboBox,{initComponent:function(){LBUI.ctrl.DropOptListField.superclass.initComponent.call(this)},typeAhead:false,loadingText:"加载...",hideTrigger:false,resizable:false,selectOnFocus:false,triggerAction:"all",minChars:1,editable:true,forceSelection:true,listeners:{afterrender:function(a){if(Ext.isObject(a.store.proxy)){var c=document.forms[a.formId];var b=c.action;a.store.proxy.api.read.url=b}},select:function(f,a,c){var e=document.forms[this.formId];var d=this.id;var b=a.id;if(b==e.elements[d].value){return}e.elements[d].value=b;if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}else{if(this.isMultiDisp){this.loadMultiDisp({ID:b})}}},expand:function(b){if(this.mode=="local"){return}var a=335;if(a>b.list.getWidth()){b.list.setWidth(a);b.innerList.setWidth(a-b.list.getFrameWidth("lr"));b.pageTb.syncSize()}},blur:function(d){var c=document.forms[this.formId];var b=this.id;var a=d.value;if(a!=c.elements[this.id].value){c.elements[this.id].value=a;if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}else{if(this.isMultiDisp){this.loadMultiDisp({ID:a})}}}}},loadMultiDisp:function(b){var a=document.forms[this.formId];b=Ext.apply(b||{},{EVENT_SOURCE:"OptSearch.SubDisplayJSON",Column:this.id,extResponse:true});Ext.Ajax.request({url:a.action,params:b,success:function(c,d){try{var g=Ext.decode(c.responseText);if(g.retVal){Ext.DomHelper.overwrite(g.bodyId,g.html)}else{LBUI.Ext.MessageBox.alert("",g.message)}}catch(f){LBUI.Ext.MessageBox.alert("","数据出错")}},failure:function(){LBUI.Ext.MessageBox.alert("","请求失败")}})},doRemoteQuery:function(b){this.lastServerQuery=b;this.getCacheStore().baseParams[this.queryParam]=b;var a=this;this.getCacheStore().load({params:this.getParams(b),callback:function(d,c,g){if(g){try{var h=a.getCacheStore().reader.jsonData.hasMore;if(Ext.isBoolean(h)){this.hasMore=h}}catch(f){}a.getCachedData()}else{}}});this.expand()},doQuery:function(f,e){if(this.mode=="local"){return LBUI.ctrl.DropOptListField.superclass.doQuery.call(this)}f=Ext.isEmpty(f)?"":f;var d={query:f,forceAll:e,combo:this,cancel:false};if(this.fireEvent("beforequery",d)===false||d.cancel){return false}f=d.query;e=d.forceAll;if(e===true||(f.length>=this.minChars)){if(this.lastQuery!==f||this.cachestore==null){var a=Ext.isString(this.lastServerQuery)&&this.lastServerQuery.length>0&&f.indexOf(this.lastServerQuery)!=-1;this.lastQuery=f;if(a){this.selectedIndex=-1;if(e){this.getCacheStore().clearFilter()}else{var b=this;var c=function(g,j,i){if(!Ext.isString(j)){return false}var h=g.get(j);if(!Ext.isString(h)){return false}return h.indexOf(i)!=-1};this.getCacheStore().filterBy(function(g,h){if(c(g,b.codeField,f)||(b.codeField!=b.displayField&&c(g,b.displayField,f))){return true}else{return false}})}if(this.isNeedRemoteQuery()){this.doRemoteQuery(f)}else{this.getCachedData()}}else{this.doRemoteQuery(f)}}else{this.selectedIndex=-1;this.getCachedData()}}},getCacheStore:function(){if(!Ext.isObject(this.cachestore)){this.cachestore=new Ext.data.Store({});Ext.clone(this.cachestore,this.store)}return this.cachestore},getCachedData:function(h){var a=this.pageTb.pageSize;var g=0;if(h==null){g=this.pageTb.cursor}else{g=h.start}this.store.removeAll();var b=[];for(var c=g;c<this.cachestore.getCount()&&c<g+a;c++){var d=this.cachestore.getAt(c);var f=new Object();f.store=this.store;b[b.length]=f;Ext.applyIf(f,d)}var j=Ext.apply({add:false},{params:h});var e;if(this.cachestore.isFiltered()){e=this.cachestore.getCount()}else{e=this.cachestore.getTotalCount()}this.store.loadRecords({success:true,records:b,totalRecords:e},j,true);this.select(0,true)},reconfig:function(a){this.el.dom.value=(Ext.isEmpty(a.value)?"":a.value);this.value=a.internalVal;var c=document.forms[this.formId];var b=this.id;c.elements[this.id].value=a.internalVal;this.setDisabled(a.disabled);if(Ext.isBoolean(a.clearCache)&&a.clearCache){this.cachestore=null}},initList:function(){LBUI.ctrl.DropOptListField.superclass.initList.call(this);var a=this;if(this.pageTb!=null){this.pageTb.doLoad=function(d){var c={},b=this.getParams();c[b.start]=d;c[b.limit]=this.pageSize;if(this.fireEvent("beforechange",this,c)!==false){if(a.lastQuery==null||a.lastQuery.length<=0){this.store.load({params:c})}else{if(a.isNeedRemoteQuery()){a.doRemoteQuery(null)}else{a.getCachedData(c)}}}}}},isNeedRemoteQuery:function(){return this.getCacheStore().hasMore==true&&(this.getCacheStore().getCount()<Math.ceil((this.pageTb.cursor+this.pageTb.pageSize)/this.pageTb.pageSize)*this.pageTb.pageSize)},setValue:function(a){var c=a;if(this.valueField){var b=this.findRecord(this.valueField,a);if(b){c=b.data[this.displayField]}else{if(Ext.isDefined(this.valueNotFoundText)){c=this.valueNotFoundText}}}if(Ext.isObject(c)){c=LBUI.LBObjDisplay(c)}this.lastSelectionText=c;if(this.hiddenField){this.hiddenField.value=Ext.value(a,"")}Ext.form.ComboBox.superclass.setValue.call(this,c);this.value=a;return this},validateBlur:function(){return false}});Ext.reg("lb.dropoptfield",LBUI.ctrl.DropOptListField);LBUI.ctrl.DatasetOptListField=Ext.extend(LBUI.ctrl.OptSearchField,{onSelect:function(g,d,f){var e=document.forms[this.formId];var c=this.id;var b=c+".OPT";var a=this;Ext.Ajax.request({url:Ext.urlEncode({action:"submit",ID:g},f),success:function(h,i){if(a.isEventSource){LBUI.columnEvent(a.formId,a.id)}else{if(a.isMultiDisp){var j=Ext.decode(h.responseText);e.elements[c].value=j.response.val;e.elements[b].value=j.response.dspval;a.loadMultiDisp({ID:g})}}},failure:function(h,i){}})}});Ext.reg("lb.datasetopfield",LBUI.ctrl.DatasetOptListField);Ext.namespace("Ext.ux");Date.prototype.getFirstDateOfWeek=function(){var a=this.clearTime();a=a.add(Date.DAY,1);var b=a.getWeekOfYear();while(b==a.getWeekOfYear()){a=a.add(Date.DAY,-1)}a=a.add(Date.DAY,1);return a};Ext.ux.DatePickerSelectionModel=function(a){this.MODE_DAY="day";this.MODE_WEEK="week";this.MODE_MONTH="month";this.selectDates=[];this.mode=this.MODE_DAY;this.addEvents("selectionchange","modechange");Ext.apply(this,a);Ext.ux.DatePickerSelectionModel.superclass.constructor.call(this)};Ext.extend(Ext.ux.DatePickerSelectionModel,Ext.util.Observable,{init:function(a){this.picker=a},getMode:function(){return this.mode},setMode:function(a){if(this.mode==a){return}this.mode=a;this.fireEvent("modechange",this,this.mode)},onSelect:function(f,c){if(c==null){this.clearSelection();return}var h=c.getDaysInMonth();var a=c.getFirstDateOfMonth();var e=a.getDay()-f.startDay;if(e<=f.startDay){e+=7}h+=e;this.selectDates=[];var j=f.cells.elements;for(var d=0;d<42;d++){var g=j[d];var b=g.firstChild.dateValue;if(this._isSelected(f,b)){this.selectDates.push(b)}}this.fireEvent("selectionchange",this,this.selectDates)},_isSelected:function(b,c){var a=new Date(c);if(this.getMode()==this.MODE_DAY){return a.clearTime().getTime()==b.value.clearTime().getTime()}if(this.getMode()==this.MODE_MONTH){return a.getFirstDateOfMonth().clearTime().getTime()==b.value.getFirstDateOfMonth().clearTime().getTime()}if(this.getMode()==this.MODE_WEEK){return a.getFirstDateOfWeek().clearTime().getTime()==b.value.getFirstDateOfWeek().clearTime().getTime()}return false},getExpression:function(){var b=this.picker.activeDate;if(b==null){return null}var c=b.getFullYear();var d=b.getMonth()+1;if(d<10){d="0"+d}var a=b.getDate();if(a<10){a="0"+a}switch(this.mode){case this.MODE_DAY:return"$DAY{"+c+""+d+""+a+"}";break;case this.MODE_WEEK:return"$WEEK{"+c+""+d+""+a+"}";break;case this.MODE_MONTH:return"$MONTH{"+c+""+d+""+a+"}";break;default:return null}},isSelected:function(a){if(a==null){return false}if(this.selectDates==null||this.selectDates.length<=0){return false}var b=false;Ext.each(this.selectDates,function(c){if(c==a.clearTime().getTime()){b=true;return false}});return b},clearSelection:function(){this.selectDates=[];this.picker.updateSelection(this.picker.activeDate||new Date())},hasSelection:function(){return this.selectDates!=null&&this.selectDates.length>0}});Ext.ux.DatePickerRangeState=function(a){this.STATE_ACTIVE_DATE="activeDate";this.STATE_MODE="mode";Ext.apply(this,a)};Ext.extend(Ext.ux.DatePickerRangeState,Ext.util.Observable,{init:function(a){this.picker=a;if(Ext.isEmpty(this.stateName)){this.stateName="DatePickerRange_"+this.picker.id}if(!this.provider){if(this.sessionState){this.provider=new Ext.state.CookieProvider({expires:null})}else{this.provider=Ext.state.Manager.getProvider()||new Ext.state.CookieProvider()}}this.state=this.provider.get(this.stateName,{});this.picker.on({scope:this,select:this.onSelect,beforerender:this.onRestoreState});this.picker.getSelectionModel().on({scope:this,modechange:this.onModeChange})},saveState:function(a){this.state=a||this.state;this.provider.set(this.stateName,this.state)},onSelect:function(b,a){this.state[this.STATE_ACTIVE_DATE]=a.getTime();this.saveState()},onModeChange:function(a,b){this.state[this.STATE_MODE]=b;this.saveState()},onRestoreState:function(b){var c=this.state[this.STATE_ACTIVE_DATE];var d=this.state[this.STATE_MODE];if(c!=null){b.setValue(new Date(c));b.stateRestored=true}var a=b.getSelectionModel();if(d!=null){a.suspendEvents();a.setMode(d);a.resumeEvents()}}});Ext.ux.DatePickerRange=Ext.extend(Ext.DatePicker,{selectionModel:null,initComponent:function(){Ext.ux.DatePickerRange.superclass.initComponent.call(this);this.getSelectionModel().init(this)},setSelectionMode:function(a){this.getSelectionModel().setMode()=a;this.setValue(this.value)},getSelectionModel:function(){if(this.selectionModel==null){this.selectionModel=new Ext.ux.DatePickerSelectionModel({})}return this.selectionModel},updateSelection:function(A){var a=this.activeDate;this.activeDate=A;if(a&&this.el){var k=A.getTime();if(a.getMonth()==A.getMonth()&&a.getFullYear()==A.getFullYear()){this.cells.each(function(d){if(this.isSelected(d.dom.firstChild.dateValue)){d.addClass("x-date-selected")}else{d.removeClass("x-date-selected")}},this)}}var g=A.getDaysInMonth();var l=A.getFirstDateOfMonth();var c=l.getDay()-this.startDay;if(c<=this.startDay){c+=7}var v=A.add("mo",-1);var e=v.getDaysInMonth()-c;var b=this.cells.elements;var m=this.textNodes;g+=c;var r=86400000;var y=(new Date(v.getFullYear(),v.getMonth(),e)).clearTime();var x=new Date().clearTime().getTime();var p=A.clearTime().getTime();var o=this.minDate?this.minDate.clearTime():Number.NEGATIVE_INFINITY;var s=this.maxDate?this.maxDate.clearTime():Number.POSITIVE_INFINITY;var B=this.disabledDatesRE;var n=this.disabledDatesText;var D=this.disabledDays?this.disabledDays.join(""):false;var z=this.disabledDaysText;var u=this.format;var h=function(E,d){d.title="";var i=y.getTime();d.firstChild.dateValue=i;if(i==x){d.className+=" x-date-today";d.title=E.todayText}if(E.isSelected(d.firstChild.dateValue)){d.className+=" x-date-selected"}if(i<o){d.className=" x-date-disabled";d.title=E.minText;return}if(i>s){d.className=" x-date-disabled";d.title=E.maxText;return}if(D){if(D.indexOf(y.getDay())!=-1){d.title=z;d.className=" x-date-disabled"}}if(B&&u){var w=y.dateFormat(u);if(B.test(w)){d.title=n.replace("%0",w);d.className=" x-date-disabled"}}};var q=0;for(;q<c;q++){m[q].innerHTML=(++e);y.setDate(y.getDate()+1);b[q].className="x-date-prevday";h(this,b[q])}for(;q<g;q++){intDay=q-c+1;m[q].innerHTML=(intDay);y.setDate(y.getDate()+1);b[q].className="x-date-active";h(this,b[q])}var C=0;for(;q<42;q++){m[q].innerHTML=(++C);y.setDate(y.getDate()+1);b[q].className="x-date-nextday";h(this,b[q])}this.mbtn.setText(this.monthNames[A.getMonth()]+" "+A.getFullYear());if(!this.internalRender){var f=this.el.dom.firstChild;var j=f.offsetWidth;this.el.setWidth(j+this.el.getBorderWidth("lr"));Ext.fly(f).setWidth(j);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){f.rows[0].cells[1].style.width=(j-(f.rows[0].cells[0].offsetWidth+f.rows[0].cells[2].offsetWidth))+"px";this.secondPass=true;this.update.defer(10,this,[A])}}},isSelected:function(b){b=new Date(b);var a=this.getSelectionModel();return a.isSelected(b)},handler:function(c,b){var a=this.getSelectionModel();a.onSelect(c,b);this.updateSelection(b)},onRender:function(a,j){Ext.ux.DatePickerRange.superclass.onRender.call(this,a,j);var m=this;var g=a.dom;var d=g.lastChild;var c=[["天","day"],["周","week"],["月","month"]];var k=this.getSelectionModel();var e=[];for(var h=0;h<c.length;h++){var b={text:c[h][0],mode:c[h][1],enableToggle:true,pressed:(k.getMode()==c[h][1]),toggleGroup:"modeselection",handler:function(o,p){var i=m.getSelectionModel();var q=i.getMode();if(o.pressed){if(this.mode==q){return}i.setMode(this.mode);var n=m.activeDate;if(n!=null){i.onSelect(m,n);m.updateSelection(n)}}else{if(null==q){return}i.setMode(null);i.clearSelection();i.fireEvent("selectionchange",i,i.selectDates)}},xtype:"button"};e.push(b)}var f=new Ext.Container({layout:"hbox",items:e});f.render(d);var l=d.lastChild.firstChild;l.style.width="100%"},showPrevMonth:function(a){this.updateSelection(this.activeDate.add("mo",-1))},showNextMonth:function(a){this.updateSelection(this.activeDate.add("mo",1))},onEnable:function(b){Ext.ux.DatePickerRange.superclass.onEnable.call(this,b);if(this.stateRestored==true){this.stateRestored=null;var a=b?this.value:this.activeDate;this.getSelectionModel().onSelect(this,a);this.updateSelection(a)}}});Ext.reg("datepickerrange",Ext.ux.DatePickerRange);
Ext.ns("LBUI.ctrl");LBUI.ctrl.DateTimeField=Ext.extend(LBUI.ctrl.DateField,{disabledDaysText:"禁用",disabledDatesText:"禁用",minText:"该输入项的日期必须在 {0} 之后",maxText:"该输入项的日期必须在 {0} 之前",invalidText:"{0} 是无效的日期 - 必须符合格式： {1}",format:"Y-m-d H:i",altFormats:"Y-m-d|y-m-d|Y-n-j|y-n-j|Ymd|ymd|Y.m.d|y.m.d|Y.n.j|y.n.j|Y/m/d|y/m/d|Y/n/j|y/n/j|Y-m-d H:i|Y-m-d H:i:s",triggerClass:"lb-datetime-trigger",initComponent:function(){LBUI.ctrl.DateTimeField.superclass.initComponent.call(this)},onTriggerClick:function(){if(this.disabled){return}if(this.menu==null){this.menu=new Ext.menu.DateTimeMenu({hideOnClick:false,formId:this.formId})}Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});this.menu.picker.setValue(this.getValue()||new Date());this.menu.show(this.el,"tl-bl*");this.menuEvents("on")},onSelect:function(a,b){this.setValue(b);this.fireEvent("select",this,b);this.fireEvent("change",this,b);this.menu.hide()}});Ext.reg("lb.datetimefield",LBUI.ctrl.DateTimeField);Ext.menu.DateTimeMenu=Ext.extend(Ext.menu.Menu,{enableScrolling:false,hideOnClick:false,cls:"x-date-menu",initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.strict=(Ext.isIE7&&Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20})}Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new LBUI.ctrl.DateTimePicker(Ext.apply({internalRender:this.strict||!Ext.isIE,ctCls:"x-menu-date-item"},this.initialConfig))});this.picker.purgeListeners();Ext.menu.DateTimeMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"]);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this)}},menuHide:function(){if(this.hideOnClick){this.hide(true)}},onBeforeShow:function(){if(this.picker){this.picker.hideMonthPicker(true);this.picker.hideTimePicker(true)}},onShow:function(){var b=this.picker.getEl();b.setWidth(b.getWidth())}});Ext.reg("datetimemenu",Ext.menu.DateTimeMenu);LBUI.ctrl.DateTimePicker=Ext.extend(Ext.DatePicker,{todayText:"现在",timeformat:"H:i",onRender:function(n,p){var q=['<table cellspacing="0">','<tr><td class="x-date-left"><a href="#" title="',this.prevText,'">&#160;</a></td><td class="x-date-middle" align="center"></td><td class="x-date-right"><a href="#" title="',this.nextText,'">&#160;</a></td></tr>','<tr><td colspan="3"><table  class="x-date-inner" cellspacing="0"><thead><tr>'],o=this.dayNames,l;for(l=0;l<7;l++){var d=this.startDay+l;if(d>6){d=d-7}q.push("<th><span>",o[d].substr(0,1),"</span></th>")}q[q.length]="</tr></thead><tbody><tr>";for(l=0;l<42;l++){if(l%7===0&&l!==0){q[q.length]="</tr><tr>"}q[q.length]='<td><a href="#" hidefocus="on" class="x-date-date" tabIndex="1"><em><span></span></em></a></td>'}q.push("</tr></tbody></table></td></tr>");q[q.length]='<tr><td colspan="3"><table width="100%" cellspacing="0"><tr><td class="x-date-time" align="left"></td><td class="x-date-bottom" align="center"></td><td class="x-date-ok"></td></tr></table></td></tr></table><div class="x-date-mp"></div><div class="x-date-tp"></div>';var f=document.createElement("div");f.className="x-date-picker";f.innerHTML=q.join("");n.dom.insertBefore(f,p);this.el=Ext.get(f);this.eventEl=Ext.get(f.firstChild);this.prevRepeater=new Ext.util.ClickRepeater(this.el.child("td.x-date-left a"),{handler:this.showPrevMonth,scope:this,preventDefault:true,stopDefault:true});this.nextRepeater=new Ext.util.ClickRepeater(this.el.child("td.x-date-right a"),{handler:this.showNextMonth,scope:this,preventDefault:true,stopDefault:true});this.monthPicker=this.el.down("div.x-date-mp");this.monthPicker.enableDisplayMode("block");this.timePicker=this.el.down("div.x-date-tp");this.timePicker.enableDisplayMode("block");this.keyNav=new Ext.KeyNav(this.eventEl,{left:function(a){if(a.ctrlKey){this.showPrevMonth()}else{this.update(this.activeDate.add("d",-1))}},right:function(a){if(a.ctrlKey){this.showNextMonth()}else{this.update(this.activeDate.add("d",1))}},up:function(a){if(a.ctrlKey){this.showNextYear()}else{this.update(this.activeDate.add("d",-7))}},down:function(a){if(a.ctrlKey){this.showPrevYear()}else{this.update(this.activeDate.add("d",7))}},pageUp:function(a){this.showNextMonth()},pageDown:function(a){this.showPrevMonth()},enter:function(a){a.stopPropagation();return true},scope:this});this.el.unselectable();this.cells=this.el.select("table.x-date-inner tbody td");this.textNodes=this.el.query("table.x-date-inner tbody span");this.mbtn=new Ext.Button({text:"&#160;",tooltip:this.monthYearText,renderTo:this.el.child("td.x-date-middle",true)});this.mbtn.el.child("em").addClass("x-btn-arrow");if(this.showToday){this.todayKeyListener=this.eventEl.addKeyListener(Ext.EventObject.SPACE,this.selectToday,this);var m=(new Date()).dateFormat(this.format);this.todayBtn=new Ext.Button({renderTo:this.el.child("td.x-date-bottom",true),text:String.format(this.todayText,m),tooltip:String.format(this.todayTip,m),handler:this.selectToday,scope:this})}var i=this;this.timeField=new Ext.form.TimeField({triggerConfig:{tag:"span",cls:"x-form-twin-triggers",cn:[{tag:"img ext:qtip='快速选择时间' ",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger lb-time-trigger"},{tag:"img ext:qtip='更多时间' ",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger lb-moretime-trigger"}]},initTrigger:function(){var a=this.trigger.select(".x-form-trigger",true);this.trigger1=a.elements[0];this.mon(this.trigger1,"click",this.onTrigger1Click,this,{preventDefault:true});this.trigger1.addClassOnOver("x-form-trigger-over");this.trigger1.addClassOnClick("x-form-trigger-click");this.trigger2=a.elements[1];this.mon(this.trigger2,"click",this.onTrigger2Click,this,{preventDefault:true});this.trigger2.addClassOnOver("x-form-trigger-over");this.trigger2.addClassOnClick("x-form-trigger-click")},initList:function(){Ext.form.TimeField.superclass.initList.call(this);this.list.zindex=16000;this.list.position("absolute",this.list.zindex)},onTrigger1Click:function(){Ext.form.TimeField.superclass.onTriggerClick.call(this)},onTrigger2Click:function(){i.showTimePicker()},defaultAutoCreate:{tag:"input",type:"text",size:"5",autocomplete:"off"},renderTo:this.el.child("td.x-date-time",true),listClass:"x-menu",increment:30});this.timeField.setValue(this.value);this.okBtn=new Ext.Button({renderTo:this.el.child("td.x-date-ok",true),text:"确定",handler:this.selectOk,scope:this});this.mon(this.eventEl,"mousewheel",this.handleMouseWheel,this);this.mon(this.eventEl,"click",this.handleDateClick,this,{delegate:"a.x-date-date"});this.mon(this.mbtn,"click",this.showMonthPicker,this);this.onEnable(true)},createTimePicker:function(){if(!this.timePicker.dom.firstChild){var b=new Date().clearTime();var a=new Date().clearTime().add("mi",(24*60)-1);var e=[];while(b<=a){e.push(b.dateFormat(this.timeformat));b=b.add("mi",15)}var d=['<table cellspacing="0" width="100%">','<tr><td class="x-time-middle" align="center" colspan="4"><a href="#" class="x-time-current">当前时间 '+new Date().dateFormat(this.timeformat)+"</a></td></tr>",'<tr><td colspan="4" valign="top"><div class="x-time"><table  cellspacing="0" class="x-time-inner"><tr>'];for(h=0;h<e.length;h++){if(h%4===0&&h!==0){d[d.length]="</tr><tr>"}d[d.length]='<td class="x-tp-time"><a href="#" hidefocus="on" tabIndex="1" name="';d[d.length]=e[h];d[d.length]='"><em><span>';d[d.length]=e[h];d[d.length]="</span></em></a>";d[d.length]="</td>"}d.push("</tr></table></div></td></tr>");d.push('<tr><td class="x-time-hours" ></td><td class="x-time-minutes" ></td><td class="x-time-ok"></td><td class="x-time-close"></td></tr>');d.push("</table>");this.timePicker.update(d.join(""));this.timeCells=this.timePicker.select("table.x-time-inner td");this.currentTime=new Ext.form.Label({renderTo:this.el.child("td.x-time-middle",true)});this.hoursField=new Ext.form.SpinnerField({width:24,minValue:0,maxValue:23,renderTo:this.el.child("td.x-time-hours",true)});this.minutesField=new Ext.form.SpinnerField({width:24,minValue:0,maxValue:59,renderTo:this.el.child("td.x-time-minutes",true)});this.okBtn_tp=new Ext.Button({renderTo:this.el.child("td.x-time-ok",true),text:"确定",handler:this.selectTimeOk,scope:this});this.closeBtn_tp=new Ext.Button({renderTo:this.el.child("td.x-time-close",true),text:"取消",handler:this.selectTimeClose,scope:this});this.mon(this.el.child("a.x-time-current"),"click",this.selectCurrentTime,this);this.mon(this.timePicker,"click",this.selectTime,this,{delegate:"a"})}},showTimePicker:function(){if(!this.disabled){this.createTimePicker();var b=this.el.getSize();this.timePicker.setSize(b);this.timePicker.child("table").setSize(b);var e=Date.parseDate(this.timeField.getValue(),this.timeformat);this.hoursField.setValue(e.getHours());this.minutesField.setValue(e.getMinutes());this.timePicker.slideIn("t",{duration:0.2});var d=e.dateFormat(this.timeformat);var g=this.timeformat;var c=15;this.timeCells.removeClass("x-time-selected");this.timeCells.each(function(f){var i=Date.parseDate(f.dom.firstChild.name,g);var a=(e.getTime()-i.getTime())<c*30*1000;if(f.dom.firstChild.name==d||a){f.addClass("x-time-selected");Ext.fly(f).focus(500);return false}})}},selectCurrentTime:function(){var a=new Date().dateFormat(this.timeformat);this.timeField.setValue(a);this.hideTimePicker()},selectTimeOk:function(){var c=this.hoursField.getValue();if(c<10){c="0"+c}var a=this.minutesField.getValue();if(a<10){a="0"+a}var b=c+":"+a;var e=Date.parseDate(b,this.timeformat);this.timeField.setValue(e);this.hideTimePicker()},selectTimeClose:function(c,d){this.hideTimePicker()},selectTime:function(c,d){c.preventDefault();if(!this.disabled){var e=Date.parseDate(d.name,this.timeformat);this.hoursField.setValue(e.getHours());this.minutesField.setValue(e.getMinutes());this.timeCells.removeClass("x-time-selected");this.timeCells.each(function(a){if(a.dom.firstChild.name==d.name){a.addClass("x-time-selected");return false}})}},hideTimePicker:function(b){if(this.timePicker){if(b===true){this.timePicker.hide()}else{this.timePicker.slideOut("t",{duration:0.2})}}},handleDateClick:function(c,d){c.stopEvent();if(!this.disabled&&d.dateValue&&!Ext.fly(d.parentNode).hasClass("x-date-disabled")){this.setValue(new Date(d.dateValue))}},selectToday:function(){if(this.todayBtn&&!this.todayBtn.disabled){this.setValue(new Date());this.fireEvent("select",this,this.value)}},selectOk:function(){if(this.okBtn&&!this.okBtn.disabled){var c=this.activeDate;var b=c.getFullYear()+"-";b+=("00"+(c.getMonth()+1)).slice(-2)+"-";b+=("00"+c.getDate()).slice(-2)+" ";b+=this.timeField.value;var a=new Date();if(this.format.indexOf("H:i:s")>-1){b=b+":"+("00"+(a.getSeconds())).slice(-2)}var c=Date.parseDate(b,this.format,false);this.fireEvent("select",this,c)}},setValue:function(a){this.value=a;if(this.el){this.update(this.value)}},beforeDestroy:function(){if(this.rendered){this.keyNav.disable();this.keyNav=null;Ext.destroy(this.leftClickRpt,this.rightClickRpt,this.monthPicker,this.timePicker,this.eventEl,this.mbtn,this.todayBtn)}}});Ext.reg("lb.datetimepicker",LBUI.ctrl.DateTimePicker);LBUI.ctrl.TimeField=Ext.extend(Ext.form.TwinTriggerField,{minValue:null,maxValue:null,minText:"该输入项的时间必须大于或等于： {0}",maxText:"该输入项的时间必须小于或等于： {0}",invalidText:"{0}不是有效的时间",format:"H:i",altFormats:"g:ia|g:iA|g:i a|g:i A|h:i|g:i|H:i|ga|ha|gA|h a|g a|g A|gi|hi|gia|hia|g|H",increment:15,mode:"local",typeAhead:false,initDate:"1/1/2008",trigger1Class:"lb-time-trigger",trigger2Class:"lb-moretime-trigger",width:80,initComponent:function(){var a=this;this.on("change",function(c,d,b){a.onValueChange(d,b)},this);if(typeof this.minValue=="string"){this.minValue=this.parseDate(this.minValue)}if(typeof this.maxValue=="string"){this.maxValue=this.parseDate(this.maxValue)}LBUI.ctrl.TimeField.superclass.initComponent.call(this);this.menu1=new LBUI.ctrl.TimeMenu({});this.menu2=new LBUI.ctrl.MoreTimeMenu({})},onValueChange:function(b,a){if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}},getValue:function(){var b=LBUI.ctrl.TimeField.superclass.getValue.call(this);return this.formatDate(this.parseDate(b))||""},setValue:function(b){return LBUI.ctrl.TimeField.superclass.setValue.call(this,this.formatDate(this.parseDate(b)))},validateValue:Ext.form.DateField.prototype.validateValue,parseDate:Ext.form.DateField.prototype.parseDate,formatDate:Ext.form.DateField.prototype.formatDate,beforeBlur:function(){var b=this.parseDate(this.getRawValue());if(b){this.setValue(b.dateFormat(this.format))}LBUI.ctrl.TimeField.superclass.beforeBlur.call(this)},menu1Listeners:{select:function(a,b){this.setValue(b);this.fireEvent("change",this,b)},show:function(a){this.onFocus()},hide:function(){var a=this.menu1Listeners;this.menu1.un("select",a.select,this);this.menu1.un("show",a.show,this);this.menu1.un("hide",a.hide,this)}},onTrigger1Click:function(){Ext.apply(this.menu1.picker,{minDate:this.minValue,maxDate:this.maxValue,format:this.format,value:this.value,width:this.getWidth(),increment:this.increment});this.menu1.on(Ext.apply({},this.menu1Listeners,{scope:this}));this.menu1.show(this.el,"tl-bl*");this.menu1.picker.setValue(this.getValue()||this.formatDate(this.parseDate(new Date())))},menu2Lsteners:{select:function(a,b){this.setValue(b);this.fireEvent("change",this,b)},show:function(a){this.onFocus()},hide:function(){var a=this.menu2Lsteners;this.menu2.un("select",a.select,this);this.menu2.un("show",a.show,this);this.menu2.un("hide",a.hide,this)},close:function(){this.menu2.hide()}},onTrigger2Click:function(){Ext.apply(this.menu2.picker,{minDate:this.minValue,maxDate:this.maxValue,format:this.format,value:this.value,increment:this.increment});this.menu2.on(Ext.apply({},this.menu2Lsteners,{scope:this}));this.menu2.show(this.el,"tl-bl?");this.menu2.picker.setValue(this.getValue()||this.formatDate(this.parseDate(new Date())))},menuEvents:function(b){this.menu[b]("select",this.onSelect,this);this.menu[b]("hide",this.onMenuHide,this);this.menu[b]("show",this.onFocus,this);this.menu[b]("close",this.onClose,this)},onClose:function(d,c){this.menu2.hide()},onSelect:function(d,c){this.setValue(c);this.fireEvent("select",this,c);this.menu2.hide()},onMenuHide:function(){this.focus(false,60);this.menuEvents("un")},beforeBlur:function(){var b=this.getRawValue();if(b){this.setValue(b)}}});Ext.reg("lb.timefield",LBUI.ctrl.TimeField);LBUI.ctrl.TimeMenu=Ext.extend(Ext.menu.Menu,{enableScrolling:false,cls:"x-date-menu",initComponent:function(){Ext.apply(this,{plain:true,showSeparator:false,width:this.width,items:this.picker=new LBUI.ctrl.TimePicker(this.initialConfig)});this.picker.purgeListeners();LBUI.ctrl.TimeMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"]);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this)}},menuHide:function(){this.hide(true)}});Ext.reg("lb.timemenu",LBUI.ctrl.TimeMenu);LBUI.ctrl.MoreTimeMenu=Ext.extend(Ext.menu.Menu,{enableScrolling:false,hideOnClick:false,cls:"x-date-menu",initComponent:function(){this.on("beforeshow",this.onBeforeShow,this);if(this.strict=(Ext.isIE7&&Ext.isStrict)){this.on("show",this.onShow,this,{single:true,delay:20})}Ext.apply(this,{plain:true,showSeparator:false,items:this.picker=new LBUI.ctrl.MoreTimePicker(Ext.apply({internalRender:this.strict||!Ext.isIE,ctCls:"x-menu-date-item"},this.initialConfig))});this.picker.purgeListeners();LBUI.ctrl.MoreTimeMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"]);this.on("select",this.menuHide,this);if(this.handler){this.on("select",this.handler,this.scope||this)}this.relayEvents(this.picker,["close"]);this.on("close",this.menuHide,this);if(this.handler){this.on("close",this.handler,this.scope||this)}},menuHide:function(){if(this.hideOnClick){this.hide(true)}},onBeforeShow:function(){if(this.picker){}},onShow:function(){var b=this.picker.getEl();b.setWidth(b.getWidth())}});Ext.reg("lb.moretimemenu",LBUI.ctrl.MoreTimeMenu);LBUI.ctrl.TimePicker=function(b){LBUI.ctrl.TimePicker.superclass.constructor.call(this,b);this.addEvents("select");if(this.handler){this.on("select",this.handler,this.scope,true)}};Ext.extend(LBUI.ctrl.TimePicker,Ext.Component,{value:null,clickEvent:"click",ctype:"LBUI.ctrl.TimePicker",allowReselect:false,onRender:function(e,f){this.value=this.value?this.value:new Date();var j=new Date().clearTime();var g=new Date().clearTime().add("mi",(24*60)-1);var l=[];while(j<=g){l.push(j.dateFormat(this.format));j=j.add("mi",this.increment*2)}var k=['<div style="overflow:auto;width:167px;" class="x-time"><table  cellspacing="0" cellspadding="0"  class="x-time-inner" >'];for(h=0;h<l.length;h++){k[k.length]='<tr><td><a href="#"  hidefocus="on" tabIndex="1" name="';k[k.length]=l[h];k[k.length]='"><em><span>';k[k.length]=l[h];k[k.length]="</span></em></a>";k[k.length]="</td></tr>"}k.push("</table></div>");var i=document.createElement("div");i.className="x-date-picker";i.innerHTML=k.join("");e.dom.insertBefore(i,f);this.el=Ext.get(i);this.eventEl=Ext.get(i.firstChild);this.cells=this.el.select("table.x-time-inner td");this.mon(this.el,this.clickEvent,this.handleClick,this,{delegate:"a"})},setValue:function(b){this.value=b;var d=Date.parseDate(this.value,this.format);var e=this.format;var c=this.increment;this.cells.removeClass("x-time-selected");this.cells.each(function(f){var g=Date.parseDate(f.dom.firstChild.name,e);var a=(d.getTime()-g.getTime())<c*30*1000;if(f.dom.firstChild.name==b||a){f.addClass("x-time-selected");Ext.fly(f.dom.firstChild).focus(50);return false}})},handleClick:function(c,d){c.preventDefault();if(!this.disabled){this.setValue(d.name);this.fireEvent("select",this,d.name)}}});Ext.reg("lb.timepicker",LBUI.ctrl.TimePicker);LBUI.ctrl.MoreTimePicker=function(b){LBUI.ctrl.MoreTimePicker.superclass.constructor.call(this,b);this.addEvents("select");if(this.handler){this.on("select",this.handler,this.scope,true)}this.addEvents("close");if(this.handler){this.on("close",this.handler,this.scope,true)}};Ext.extend(LBUI.ctrl.MoreTimePicker,Ext.Component,{value:null,clickEvent:"click",ctype:"LBUI.ctrl.MoreTimePicker",allowReselect:false,onRender:function(e,f){this.value=this.value?this.value:new Date();var j=new Date().clearTime();var g=new Date().clearTime().add("mi",(24*60)-1);var l=[];while(j<=g){l.push(j.dateFormat(this.format));j=j.add("mi",this.increment)}var k=['<div class="x-time-box"><table cellspacing="0" cellpadding="0" border="0" width="100%">','<tr><td class="x-time-middle" align="center" colspan="4"><a href="#" class="x-time-current">当前时间 </a></td></tr>','<tr><td colspan="4" valign="top"><div class="x-time"><table  cellspacing="0" class="x-time-inner"><tr>'];for(h=0;h<l.length;h++){if(h%4===0&&h!==0){k[k.length]="</tr><tr>"}k[k.length]='<td><a href="#"  hidefocus="on" tabIndex="1" name="';k[k.length]=l[h];k[k.length]='"><em><span>';k[k.length]=l[h];k[k.length]="</span></em></a>";k[k.length]="</td>"}k.push("</tr></table></div></td></tr>",'<tr><td class="x-time-hours" align="left" nowrap></td><td class="x-time-minutes" align="left"></td><td class="x-time-ok" align="center"></td><td class="x-time-close" align="center"></td></tr></table></div>');var i=document.createElement("div");i.className="x-date-picker";i.innerHTML=k.join("");e.dom.insertBefore(i,f);this.el=Ext.get(i);this.eventEl=Ext.get(i.firstChild);this.cells=this.el.select("table.x-time-inner td");this.currentTime=new Ext.form.Label({renderTo:this.el.child("a.x-time-current",true)});this.hoursField=new Ext.form.SpinnerField({width:40,minValue:0,maxValue:23,renderTo:this.el.child("td.x-time-hours",true)});this.minutesField=new Ext.form.SpinnerField({width:40,minValue:0,maxValue:59,renderTo:this.el.child("td.x-time-minutes",true)});this.okBtn=new Ext.Button({renderTo:this.el.child("td.x-time-ok",true),text:"确定",handler:this.selectOk,scope:this});this.closeBtn=new Ext.Button({renderTo:this.el.child("td.x-time-close",true),text:"关闭",handler:this.selectClose,scope:this});this.mon(this.el,this.clickEvent,this.handleClick,this,{delegate:"a"});this.mon(this.el.child("a.x-time-current"),this.clickEvent,this.selectTime,this);this.refresh()},refresh:function(){var b=this;var a=new Date().dateFormat(this.format);this.currentTime.setText(a);setTimeout(function(){b.refresh()},1000)},selectTime:function(){var a=new Date().dateFormat(this.format);this.fireEvent("select",this,a)},selectOk:function(){if(this.okBtn&&!this.okBtn.disabled){var c=this.hoursField.getValue();if(c<10){c="0"+c}var a=this.minutesField.getValue();if(a<10){a="0"+a}var b=c+":"+a;var e=Date.parseDate(b,this.format);this.fireEvent("select",this,e);this.fireEvent("close",this)}},selectClose:function(c,d){this.fireEvent("close",this)},setValue:function(b){this.value=b?b:new Date().dateFormat(this.format);var d=Date.parseDate(this.value,this.format);this.hoursField.setValue(d.getHours());this.minutesField.setValue(d.getMinutes());var e=this.format;var c=this.increment;this.cells.removeClass("x-time-selected");this.cells.each(function(f){var g=Date.parseDate(f.dom.firstChild.name,e);var a=(d.getTime()-g.getTime())<c*30*1000;if(f.dom.firstChild.name==b||a){f.addClass("x-time-selected");Ext.fly(f.dom.firstChild).focus(50);return false}})},handleClick:function(c,d){c.preventDefault();if(!this.disabled){this.setValue(d.name)}}});Ext.reg("lb.moretimepicker",LBUI.ctrl.MoreTimePicker);Ext.form.Spinner=Ext.extend(Ext.util.Observable,{incrementValue:1,alternateIncrementValue:5,triggerClass:"x-form-spinner-trigger",splitterClass:"x-form-spinner-splitter",alternateKey:Ext.EventObject.shiftKey,defaultValue:0,accelerate:false,constructor:function(a){Ext.form.Spinner.superclass.constructor.call(this,a);Ext.apply(this,a);this.mimicing=false},init:function(a){this.field=a;a.afterMethod("onRender",this.doRender,this);a.afterMethod("onEnable",this.doEnable,this);a.afterMethod("onDisable",this.doDisable,this);a.afterMethod("afterRender",this.doAfterRender,this);a.afterMethod("onResize",this.doResize,this);a.afterMethod("onFocus",this.doFocus,this);a.beforeMethod("onDestroy",this.doDestroy,this)},doRender:function(b,a){var c=this.el=this.field.getEl();var d=this.field;if(!d.wrap){d.wrap=this.wrap=c.wrap({cls:"x-form-field-wrap"})}else{this.wrap=d.wrap.addClass("x-form-field-wrap")}this.trigger=this.wrap.createChild({tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger "+this.triggerClass});if(!d.width){this.wrap.setWidth(c.getWidth()+this.trigger.getWidth())}this.splitter=this.wrap.createChild({tag:"div",cls:this.splitterClass,style:"width:13px; height:2px;"});this.splitter.setRight((Ext.isIE)?1:2).setTop(10).show();this.proxy=this.trigger.createProxy("",this.splitter,true);this.proxy.addClass("x-form-spinner-proxy");this.proxy.setStyle("left","0px");this.proxy.setSize(14,1);this.proxy.hide();this.dd=new Ext.dd.DDProxy(this.splitter.dom.id,"SpinnerDrag",{dragElId:this.proxy.id});this.initTrigger();this.initSpinner()},doAfterRender:function(){var a;if(Ext.isIE&&this.el.getY()!=(a=this.trigger.getY())){this.el.position();this.el.setY(a)}},doEnable:function(){if(this.wrap){this.wrap.removeClass(this.field.disabledClass)}},doDisable:function(){if(this.wrap){this.wrap.addClass(this.field.disabledClass);this.el.removeClass(this.field.disabledClass)}},doResize:function(a,b){if(typeof a=="number"){this.el.setWidth(a-this.trigger.getWidth())}this.wrap.setWidth(this.el.getWidth()+this.trigger.getWidth())},doFocus:function(){if(!this.mimicing){this.wrap.addClass("x-trigger-wrap-focus");this.mimicing=true;Ext.get(Ext.isIE?document.body:document).on("mousedown",this.mimicBlur,this,{delay:10});this.el.on("keydown",this.checkTab,this)}},checkTab:function(a){if(a.getKey()==a.TAB){this.triggerBlur()}},mimicBlur:function(a){if(!this.wrap.contains(a.target)&&this.field.validateBlur(a)){this.triggerBlur()}},triggerBlur:function(){this.mimicing=false;Ext.get(Ext.isIE?document.body:document).un("mousedown",this.mimicBlur,this);this.el.un("keydown",this.checkTab,this);this.field.beforeBlur();this.wrap.removeClass("x-trigger-wrap-focus");this.field.onBlur.call(this.field)},initTrigger:function(){this.trigger.addClassOnOver("x-form-trigger-over");this.trigger.addClassOnClick("x-form-trigger-click")},initSpinner:function(){this.field.addEvents({spin:true,spinup:true,spindown:true});this.keyNav=new Ext.KeyNav(this.el,{up:function(a){a.preventDefault();this.onSpinUp()},down:function(a){a.preventDefault();this.onSpinDown()},pageUp:function(a){a.preventDefault();this.onSpinUpAlternate()},pageDown:function(a){a.preventDefault();this.onSpinDownAlternate()},scope:this});this.repeater=new Ext.util.ClickRepeater(this.trigger,{accelerate:this.accelerate});this.field.mon(this.repeater,"click",this.onTriggerClick,this,{preventDefault:true});this.field.mon(this.trigger,{mouseover:this.onMouseOver,mouseout:this.onMouseOut,mousemove:this.onMouseMove,mousedown:this.onMouseDown,mouseup:this.onMouseUp,scope:this,preventDefault:true});this.field.mon(this.wrap,"mousewheel",this.handleMouseWheel,this);this.dd.setXConstraint(0,0,10);this.dd.setYConstraint(1500,1500,10);this.dd.endDrag=this.endDrag.createDelegate(this);this.dd.startDrag=this.startDrag.createDelegate(this);this.dd.onDrag=this.onDrag.createDelegate(this)},onMouseOver:function(){if(this.disabled){return}var a=this.getMiddle();this.tmpHoverClass=(Ext.EventObject.getPageY()<a)?"x-form-spinner-overup":"x-form-spinner-overdown";this.trigger.addClass(this.tmpHoverClass)},onMouseOut:function(){this.trigger.removeClass(this.tmpHoverClass)},onMouseMove:function(){if(this.disabled){return}var a=this.getMiddle();if(((Ext.EventObject.getPageY()>a)&&this.tmpHoverClass=="x-form-spinner-overup")||((Ext.EventObject.getPageY()<a)&&this.tmpHoverClass=="x-form-spinner-overdown")){}},onMouseDown:function(){if(this.disabled){return}var a=this.getMiddle();this.tmpClickClass=(Ext.EventObject.getPageY()<a)?"x-form-spinner-clickup":"x-form-spinner-clickdown";this.trigger.addClass(this.tmpClickClass)},onMouseUp:function(){this.trigger.removeClass(this.tmpClickClass)},onTriggerClick:function(){if(this.disabled||this.el.dom.readOnly){return}var b=this.getMiddle();var a=(Ext.EventObject.getPageY()<b)?"Up":"Down";this["onSpin"+a]()},getMiddle:function(){var b=this.trigger.getTop();var c=this.trigger.getHeight();var a=b+(c/2);return a},isSpinnable:function(){if(this.disabled||this.el.dom.readOnly){Ext.EventObject.preventDefault();return false}return true},handleMouseWheel:function(a){if(this.wrap.hasClass("x-trigger-wrap-focus")==false){return}var b=a.getWheelDelta();if(b>0){this.onSpinUp();a.stopEvent()}else{if(b<0){this.onSpinDown();a.stopEvent()}}},startDrag:function(){this.proxy.show();this._previousY=Ext.fly(this.dd.getDragEl()).getTop()},endDrag:function(){this.proxy.hide()},onDrag:function(){if(this.disabled){return}var b=Ext.fly(this.dd.getDragEl()).getTop();var a="";if(this._previousY>b){a="Up"}if(this._previousY<b){a="Down"}if(a!=""){this["onSpin"+a]()}this._previousY=b},onSpinUp:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinUpAlternate();return}else{this.spin(false,false)}this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this)},onSpinDown:function(){if(this.isSpinnable()==false){return}if(Ext.EventObject.shiftKey==true){this.onSpinDownAlternate();return}else{this.spin(true,false)}this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this)},onSpinUpAlternate:function(){if(this.isSpinnable()==false){return}this.spin(false,true);this.field.fireEvent("spin",this);this.field.fireEvent("spinup",this)},onSpinDownAlternate:function(){if(this.isSpinnable()==false){return}this.spin(true,true);this.field.fireEvent("spin",this);this.field.fireEvent("spindown",this)},spin:function(d,b){var a=parseFloat(this.field.getValue());var c=(b==true)?this.alternateIncrementValue:this.incrementValue;(d==true)?a-=c:a+=c;a=(isNaN(a))?this.defaultValue:a;a=this.fixBoundries(a);this.field.setRawValue(a)},fixBoundries:function(b){var a=b;if(this.field.minValue!=undefined&&a<this.field.minValue){a=this.field.minValue}if(this.field.maxValue!=undefined&&a>this.field.maxValue){a=this.field.maxValue}return this.fixPrecision(a)},fixPrecision:function(b){var a=isNaN(b);if(!this.field.allowDecimals||this.field.decimalPrecision==-1||a||!b){return a?"":b}return parseFloat(parseFloat(b).toFixed(this.field.decimalPrecision))},doDestroy:function(){if(this.trigger){this.trigger.remove()}if(this.wrap){this.wrap.remove();delete this.field.wrap}if(this.splitter){this.splitter.remove()}if(this.dd){this.dd.unreg();this.dd=null}if(this.proxy){this.proxy.remove()}if(this.repeater){this.repeater.purgeListeners()}}});Ext.form.SpinnerField=Ext.extend(Ext.form.NumberField,{actionMode:"wrap",deferHeight:true,autoSize:Ext.emptyFn,onBlur:Ext.emptyFn,adjustSize:Ext.BoxComponent.prototype.adjustSize,constructor:function(c){var b=Ext.copyTo({},c,"incrementValue,alternateIncrementValue,accelerate,defaultValue,triggerClass,splitterClass");var d=this.spinner=new Ext.form.Spinner(b);var a=c.plugins?(Ext.isArray(c.plugins)?c.plugins.push(d):[c.plugins,d]):d;Ext.form.SpinnerField.superclass.constructor.call(this,Ext.apply(c,{plugins:a}))},onShow:function(){if(this.wrap){this.wrap.dom.style.display="";this.wrap.dom.style.visibility="visible"}},onHide:function(){this.wrap.dom.style.display="none"},getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}},validateBlur:function(){return true}});Ext.reg("spinnerfield",Ext.form.SpinnerField);if("function"!==typeof RegExp.escape){RegExp.escape=function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}}LBUI.ctrl.ComboBoxMultiField=Ext.extend(Ext.form.ComboBox,{checkField:"checked",minWidth:180,separator:";",listClass:"lb-combo-list",constructor:function(a){a=a||{};a.listeners=a.listeners||{};Ext.applyIf(a.listeners,{scope:this,beforequery:this.onBeforeQuery,blur:this.onRealBlur});LBUI.ctrl.ComboBoxMultiField.superclass.constructor.call(this,a)},initComponent:function(){this.hiddenField=document[this.formId].elements[this.hiddenId];if(this.store){this.store=eval(this.store)}if(!this.tpl){this.tpl='<tpl for="."><div class="x-combo-list-item lb-combo-list-item-{[values.'+this.checkField+'?"checked":"unchecked"]}"><div class="lb-combo-list-item-text">{'+(this.displayField||"field2")+"}</div></div></tpl>"}LBUI.ctrl.ComboBoxMultiField.superclass.initComponent.apply(this,arguments);this.onLoad=this.onLoad.createSequence(function(){if(this.el){var v=this.el.dom.value;this.el.dom.value="";this.el.dom.value=v}})},initEvents:function(){LBUI.ctrl.ComboBoxMultiField.superclass.initEvents.apply(this,arguments);this.keyNav.tab=false},clearValue:function(){this.value="";this.setRawValue(this.value);this.store.clearFilter();this.store.each(function(a){a.set(this.checkField,false)},this);if(this.hiddenField){this.hiddenField.value=""}this.applyEmptyText()},getCheckedDisplay:function(){var a=new RegExp(this.separator,"g");return this.getCheckedValue(this.displayField).replace(a,this.separator+" ")},getCheckedValue:function(b){b=b||this.valueField;var d=[];var a=this.store.snapshot||this.store.data;a.each(function(c){if(c.get(this.checkField)){d.push(c.get(b))}},this);return d.join(this.separator)},onBeforeQuery:function(a){a.query=a.query.replace(new RegExp(RegExp.escape(this.getCheckedDisplay())+"[ "+this.separator+"]*"),"")},onRealBlur:function(){this.list.hide();var d=this.getRawValue();var a=d.split(new RegExp(RegExp.escape(this.separator)+" *"));var c=[];var b=this.store.snapshot||this.store.data;Ext.each(a,function(e){b.each(function(f){if(e===f.get(this.displayField)){c.push(f.get(this.valueField))}},this)},this);this.setValue(c.join(this.separator));this.store.clearFilter()},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){a.set(this.checkField,!a.get(this.checkField));if(this.store.isFiltered()){this.doQuery(this.allQuery)}this.setValue(this.getCheckedValue());this.fireEvent("select",this,a,b)}},setValue:function(a){if(a){a=""+a;if(this.valueField){this.store.clearFilter();this.store.each(function(c){var b=!(!a.match("(^|"+this.separator+")"+RegExp.escape(c.get(this.valueField))+"("+this.separator+"|$)"));c.set(this.checkField,b)},this);this.value=this.getCheckedValue();this.setRawValue(this.getCheckedDisplay());if(this.hiddenField){this.hiddenField.value=this.value}}else{this.value=a;this.setRawValue(a);if(this.hiddenField){this.hiddenField.value=a}}if(this.el){this.el.removeClass(this.emptyClass)}if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}}else{if(a==""){this.clearValue();if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}}}},selectAll:function(){this.store.each(function(a){a.set(this.checkField,true)},this);this.doQuery(this.allQuery);this.setValue(this.getCheckedValue())},deselectAll:function(){this.clearValue()},beforeBlur:Ext.emptyFn});Ext.reg("lb.comboboxmultifield",LBUI.ctrl.ComboBoxMultiField);LBUI.ctrl.MultiColDropListField=Ext.extend(LBUI.ctrl.AutoSizeComboBox,{minWidth:280,listWidth:280,triggerAction:"all",itemSelector:"div.x-multicoldroplist-wrap",selectedClass:"x-multicoldroplist-wrap-selected",constructor:function(a){a=a||{};a.listeners=a.listeners||{};Ext.applyIf(a.listeners,{scope:this,blur:this.onRealBlur});LBUI.ctrl.MultiColDropListField.superclass.constructor.call(this,a)},initComponent:function(){this.hiddenField=document[this.formId].elements[this.hiddenId];if(this.displayField=="ID"){this.displayField="id"}if(this.valueField=="ID"){this.valueField="id"}var frm=document.forms[this.formId];var ctl=this;if(!this.store){var url=(Ext.urlEncode({EVENT_SOURCE:"MCDropListOptSearch",Column:this.hiddenId,extResponse:true,loadStore:true},frm.action));this.store=new Ext.data.JsonStore({url:url,root:"records",totalProperty:"results",fields:[this.valueField,this.displayField],autoLoad:true,sortInfo:{field:this.valueField,direction:"ASC"}})}else{this.store=eval(this.store)}if(!this.tpl){this.tpl='<tpl for="."><div class="x-multicoldroplist-wrap" id="{'+this.valueField+'}"><li><a href="#" class="x-editable"  >{'+this.displayField+'}</a></li></div></tpl><div class="x-clear"></div>'}LBUI.ctrl.MultiColDropListField.superclass.initComponent.apply(this,arguments)},setValue:function(a){LBUI.ctrl.MultiColDropListField.superclass.setValue.call(this,a);if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}},onRealBlur:function(){this.list.hide();var a=this.getRawValue();if(a==""){this.setValue(a)}this.store.clearFilter()},collapseIf:function(d,a){var c=a.className.indexOf("x-menu")>-1;if(!d.within(this.wrap)&&!d.within(this.list)&&!c){this.collapse()}},initList:function(){LBUI.ctrl.MultiColDropListField.superclass.initList.apply(this,arguments);var ctl=this;if(this.groups){var btns=eval(this.groups);this.groupbar=this.list.insertFirst({});this.groupTb=new Ext.Toolbar({cls:"x-groupbar"});for(var i=0;i<btns.length;i++){var gfield=btns[i][0];var gvalue=btns[i][1];var gtext=btns[i][2];this.groupTb.add({text:gtext,field:gfield,value:gvalue,type:this.type,handler:function(){var isselected=this.el.hasClass("x-groupbar-selected");ctl.groupTb.items.each(function(item){item.removeClass("x-groupbar-selected")});if(isselected){ctl.store.load({params:{start:0,limit:ctl.pageSize,type:this.type}})}else{ctl.store.load({params:{start:0,limit:ctl.pageSize,group:this.field+"."+this.value}});this.addClass("x-groupbar-selected")}}});this.groupTb.addSeparator()}this.grouppanel=new Ext.Panel({width:this.listWidth,tbar:this.groupTb,renderTo:this.groupbar,tbarCfg:{cls:"x-panel-tbar-nobox"},bodyCfg:{cls:"x-panel-body-hide"}});this.assetHeight+=this.groupbar.getHeight();if(!Ext.isIE){this.assetHeight+=24}}if(this.pageSize){this.pageTb.addClass("x-groupbar");this.pageTb.refresh.hide()}},onLoad:function(){if(!this.hasFocus){return}if(this.store.getCount()>0){this.expand();this.restrictHeight();if(this.lastQuery==this.allQuery){if(this.editable){this.el.dom.select()}if(!this.selectByValue(this.value,true)){this.select(0,true)}}else{this.selectNext();if(this.typeAhead&&this.lastKey!=Ext.EventObject.BACKSPACE&&this.lastKey!=Ext.EventObject.DELETE){this.taTask.delay(this.typeAheadDelay)}}}else{this.innerList.update('<div class="x-emptyresult"><span> 没有相关纪录！</span></div>');this.expand()}},afterRender:function(){LBUI.ctrl.MultiColDropListField.superclass.afterRender.call(this);this.setRawValue(this.display)},beforeBlur:Ext.emptyFn,onTriggerClick:function(){this.lastQuery=null;LBUI.ctrl.MultiColDropListField.superclass.onTriggerClick.apply(this,arguments)}});Ext.reg("lb.multicoldroplistfield",LBUI.ctrl.MultiColDropListField);Ext.ux.TreeCheckNodeUI=function(){this.checkModel="childCascade";this.onlyLeafCheckable=false;Ext.ux.TreeCheckNodeUI.superclass.constructor.apply(this,arguments)};Ext.extend(Ext.ux.TreeCheckNodeUI,Ext.tree.TreeNodeUI,{renderElements:function(e,k,j,l){var m=e.getOwnerTree();this.checkModel=m.checkModel||this.checkModel;this.onlyLeafCheckable=m.onlyLeafCheckable||false;this.indentMarkup=e.parentNode?e.parentNode.ui.getChildIndent():"";var f=(!this.onlyLeafCheckable||k.leaf);var c=k.href?k.href:Ext.isGecko?"":"#";var d=['<li class="x-tree-node"><div ext:tree-node-id="',e.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',k.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<img src="',k.icon||this.emptyIcon,'" class="x-tree-node-icon',(k.icon?" x-tree-node-inline-icon":""),(k.iconCls?" "+k.iconCls:""),'" unselectable="on" />',f?('<input class="x-tree-node-cb" type="checkbox" '+(k.checked?'checked="checked" />':"/>")):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',c,'" tabIndex="1" ',k.hrefTarget?' target="'+k.hrefTarget+'"':"",'><span unselectable="on">',e.text,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");var b;if(l!==true&&e.nextSibling&&(b=e.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",b,d)}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",j,d)}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var i=this.elNode.childNodes;this.indentNode=i[0];this.ecNode=i[1];this.iconNode=i[2];var g=3;if(f){this.checkbox=i[3];Ext.fly(this.checkbox).on("click",this.check.createDelegate(this,[null]));g++}this.anchor=i[g];this.textNode=i[g].firstChild},check:function(f){var g=this.node;var c=g.getOwnerTree();this.checkModel=c.checkModel||this.checkModel;if(f===null){f=this.checkbox.checked}else{this.checkbox.checked=f}g.attributes.checked=f;c.fireEvent("check",g,f);if(this.checkModel=="single"){var b=c.getChecked();for(var d=0;d<b.length;d++){var e=b[d];if(e.id!=g.id){e.getUI().checkbox.checked=false;e.attributes.checked=false;c.fireEvent("check",e,false)}}}else{if(!this.onlyLeafCheckable){if(this.checkModel=="cascade"||this.checkModel=="parentCascade"){var a=g.parentNode;if(a!==null){this.parentCheck(a,f)}}if(this.checkModel=="cascade"||this.checkModel=="childCascade"){if(!g.expanded&&!g.childrenRendered){g.expand(false,false,this.childCheck)}else{this.childCheck(g)}}}}},childCheck:function(e){var b=e.attributes;if(!b.leaf){var d=e.childNodes;var f;for(var c=0;c<d.length;c++){f=d[c].getUI();if(f.checkbox.checked^b.checked){f.check(b.checked)}}}},parentCheck:function(c,b){var d=c.getUI().checkbox;if(typeof d=="undefined"){return}if(!(b^d.checked)){return}if(!b&&this.childHasChecked(c)){return}d.checked=b;c.attributes.checked=b;c.getOwnerTree().fireEvent("check",c,b);var a=c.parentNode;if(a!==null){this.parentCheck(a,b)}},childHasChecked:function(b){var c=b.childNodes;if(c||c.length>0){for(var a=0;a<c.length;a++){if(c[a].getUI().checkbox.checked){return true}}}return false},toggleCheck:function(c){var a=this.checkbox;if(a){var b=(c===undefined?!a.checked:c);this.check(b)}}});LBUI.ctrl.TreeField=Ext.extend(Ext.form.ComboBox,{minListWidth:50,minListHeight:200,separator:";",initComponent:function(){this.store=new Ext.data.SimpleStore({});this.hiddenField=document[this.formId].elements[this.hiddenId];LBUI.ctrl.TreeField.superclass.initComponent.call(this);this.setWidth(200);var a=this;this.on("change",function(c,d,b){a.onValueChange(d,b)},this)},onValueChange:function(b,a){if(this.isEventSource){LBUI.columnEvent(this.formId,this.id)}},initList:function(){if(!this.list){var a="x-combo-list";this.list=new Ext.Layer({shadow:this.shadow,cls:[a,this.listClass].join(" "),constrain:false});var b=this.listWidth||Math.max(this.wrap.getWidth(),this.minListWidth);this.list.setWidth(b);this.list.swallowEvent("mousewheel");this.list.setHeight(this.listHeight);this.innerList=this.list.createChild({cls:a+"-inner"});this.innerList.setWidth(b-this.list.getFrameWidth("lr"));this.innerList.setHeight(this.listHeight||this.minListHeight);if(!this.tree){this.tree=this.createTree(this.innerList)}this.tree.render()}},setSelectNodes:function(b){var a=[];if(!Ext.isEmpty(b)){if(typeof b=="string"){a=b.split(";")}else{if(typeof b=="array"){a=b}}var e=a.length;for(var c=0;c<e;c++){var d=this.tree.getNodeById(a[c]);if(d){d.getUI().checkbox.checked=true;d.attributes.checked=true}}}},initCheck:function(){var b=this.tree.getRootNode();var a=this.hiddenField.value;this.setSelectNodes(a)},initValue:Ext.emptyFn,createTree:function(e){var g=Ext.tree;var c=this;var f=document.forms[this.formId];var d=(Ext.urlEncode({EVENT_SOURCE:"ComboBoxTreeMultiRefObj",Column:this.hiddenId,extResponse:true,loadStore:true},f.action));TreeNodeLoader=function(i){TreeNodeLoader.superclass.constructor.call(this,i);this.on("load",function(k,j){c.initCheck()},this)};Ext.extend(TreeNodeLoader,Ext.tree.TreeLoader,{});var a=new g.TreePanel({el:e,border:false,autoScroll:true,rootVisible:false,containerScroll:true,loader:new TreeNodeLoader({dataUrl:d,baseAttrs:{uiProvider:Ext.ux.TreeCheckNodeUI}}),listeners:{check:function(j,i){c.setValue(j.id)}}});var b=new g.AsyncTreeNode({id:"1",text:"根节点"});a.setRootNode(b);b.expand(false,false);return a},reconfig:Ext.emptyFn,setValue:function(a){if(a){a=""+a;if(this.valueField){this.value=this.getCheckedValue();this.setRawValue(this.getCheckedDisplay());if(this.hiddenField){this.hiddenField.value=this.value}}else{this.value=a;this.setRawValue(a);if(this.hiddenField){this.hiddenField.value=a}}if(this.el){this.el.removeClass(this.emptyClass)}if(this.isEventSource){}}},getCheckedDisplay:function(){var a=new RegExp(this.separator,"g");return this.getCheckedValue(this.displayField).replace(a,this.separator+" ")},getCheckedValue:function(d){d=d||this.valueField;var b=this;var e=[];var a=this.tree.getChecked();Ext.each(a,function(c){if(d==b.displayField){e.push(c.text)}else{e.push(c.id)}});return e.join(this.separator)},onTriggerClick:function(){if(this.disabled){return}if(this.isExpanded()){this.collapse()}else{this.onFocus({});this.expand()}this.el.focus()}});Ext.reg("lb.comboboxtreefield",LBUI.ctrl.TreeField);



LBUI.ctrl.DropOptListField = Ext.extend(LBUI.ctrl.AutoSizeComboBox ,{
	initComponent : function() {
		LBUI.ctrl.DropOptListField.superclass.initComponent.call(this);
	},
	typeAhead: false,
    loadingText: '加载...',
    hideTrigger:false,
    resizable:false,
    selectOnFocus:false,
    triggerAction:'all',
    
    minChars:1,
    
	editable:true,
	forceSelection:true,//??

    onBlur:function(){
    	LBUI.ctrl.DropOptListField.superclass.onBlur.call(this);
		var frm = document.forms[this.formId];
		var colName = this.id;
		var v = this.el.dom.value;
		if( '' == v ){//清空字段值
			frm.elements[this.id].value = v;
			if (this.isEventSource) {
				LBUI.columnEvent(this.formId, this.id);
			} else if (this.isMultiDisp) {
				this.loadMultiDisp( {
					ID : v
				});
			}
		}
	},

	listeners:{
		'afterrender' : function(comp){
			if( Ext.isObject( comp.store.proxy ) ){
				var frm = document.forms[comp.formId];
				var url = frm.action;
				comp.store.proxy.api.read.url = url;
			}
		},
		'select' : function(combo,record,index){
			var frm = document.forms[this.formId];
			var colName = this.id;
			var v = record.id;
			if( v == frm.elements[colName].value )
				return;//值有变化才更新
			frm.elements[colName].value = v;
			if (this.isEventSource) {
				LBUI.columnEvent(this.formId, this.id);
			} else if (this.isMultiDisp) {
				this.loadMultiDisp( {
					ID : v
				});
			}
		},
		'expand' : function(combo) {
	        if(this.mode == 'local'){
	        	return;
	        }
			var minWidth = 335;
			if( minWidth > combo.list.getWidth() ){
				combo.list.setWidth(minWidth);
				combo.innerList.setWidth( minWidth - combo.list.getFrameWidth('lr') );//
				combo.pageTb.syncSize();
			}
        }
	},
	loadMultiDisp : function(params) {
		var frm = document.forms[this.formId];
		params = Ext.apply(params || {}, {
			EVENT_SOURCE : 'OptSearch.SubDisplayJSON',
			Column : this.id,
			extResponse : true
		});
		Ext.Ajax.request( {
			url : frm.action,
			params : params,
			success : function(response, opts) {
				try {
					var resp = Ext
							.decode(response.responseText);
					if (resp.retVal) {
						Ext.DomHelper.overwrite(resp.bodyId,
								resp.html);
					} else {
						LBUI.Ext.MessageBox.alert('',
								resp.message);
					}
				} catch (e) {
					LBUI.Ext.MessageBox.alert('', '数据出错');
				}
			},
			failure : function() {
				LBUI.Ext.MessageBox.alert('', '请求失败');
			}
		});
	},
	doRemoteQuery : function(q){
        this.lastServerQuery = q;
        this.getCacheStore().baseParams[this.queryParam] = q;
        var self = this;
        this.getCacheStore().load({
            params: this.getParams(q),
            callback : function(recordArr,options,success){
        		if( success ){
          		try{
            		var hasMore = self.getCacheStore().reader.jsonData.hasMore;
            		if( Ext.isBoolean( hasMore ) )
            			this.hasMore = hasMore;//this -> store of combobox
          		}catch(e){}
          		self.getCachedData();
        		}else{
        			;//load store error... 
        		}
        	}
        });
        this.expand();
  	},
	/*搜索优化：
	 *  输入一个字符后，下载一批记录到客户端,附加信息: 是否有更多数据 
	 *  之后继续输入：
	 *  a.如果没有"更多数据"，直接搜索缓存内数据
	 *  b.如果有"更多数据"，匹配的记录总数在当前显示页范围内直接取缓存，可能有超出缓存的记录则重新请求数据
	 *  
	 *  若清除文字重新输入，则重新请求数据
	 */
	doQuery : function(q, forceAll){
        if(this.mode == 'local'){
        	return LBUI.ctrl.DropOptListField.superclass.doQuery.call(this);
        }
        q = Ext.isEmpty(q) ? '' : q;
        var qe = {
            query: q,
            forceAll: forceAll,
            combo: this,
            cancel:false
        };
        if(this.fireEvent('beforequery', qe)===false || qe.cancel){
            return false;
        }
        q = qe.query;
        forceAll = qe.forceAll;
        if(forceAll === true || (q.length >= this.minChars)){
            if(this.lastQuery !== q || this.cachestore == null ){
                var bCacheQuery = Ext.isString( this.lastServerQuery ) && this.lastServerQuery.length > 0 
                				  && q.indexOf(this.lastServerQuery) != -1; 
                this.lastQuery = q;

                if( bCacheQuery)
                  {
                    this.selectedIndex = -1;
                    if(forceAll){
                        this.getCacheStore().clearFilter();
                    }else{
                    	var self = this;
                    	var match = function(record,field,key){
                    		if( !Ext.isString(field) )
                    			return false;
                    		var v = record.get(field);
                    		if( !Ext.isString(v) )
                    			return false;
                    		return v.indexOf( key ) != -1;
                    	}
                    	this.getCacheStore().filterBy(function(record,id){
                    		if( match(record,self.codeField,q )
                    		  || (self.codeField != self.displayField && match(record,self.displayField ,q ) ) 
                    		  )
                    			return true;
                    		else
                    			return false;
                    	});
                    }
                    if( this.isNeedRemoteQuery() ){
                    	//remote query 
                    	this.doRemoteQuery(q);
                    }else{
                    	this.getCachedData();
                    	//this.onLoad();
                    }
                }else{
                	this.doRemoteQuery(q);
                }
            }else{
                this.selectedIndex = -1;
                this.getCachedData();
                //this.onLoad();
            }
        }
    },
    getCacheStore : function(){
    	if( !Ext.isObject( this.cachestore ) ){
	    	this.cachestore = new Ext.data.Store({});
	    	Ext.clone( this.cachestore , this.store );//??
    	}
    	return this.cachestore;
    },
    getCachedData : function(pageInfo){
        //copy record in current page to this.store from this.cachestore 
        var pagesize = this.pageTb.pageSize;
        var cursor = 0;
        if( pageInfo == null )
        	cursor = this.pageTb.cursor;
        else{
        	cursor = pageInfo.start;
        }
        
        this.store.removeAll();
        
        var rs = [];
        for( var i = cursor ; i < this.cachestore.getCount() && i < cursor + pagesize ; i++ ){
        	var record = this.cachestore.getAt(i);
        	var nr = new Object();
        	nr.store = this.store;
        	rs[rs.length] = nr;
        	Ext.applyIf(nr,record);//clone record ....
        }
        var options = Ext.apply({add: false},{params:pageInfo});
        var count;
        if( this.cachestore.isFiltered() ) 
        	count = this.cachestore.getCount();
        else
        	count = this.cachestore.getTotalCount();
        this.store.loadRecords({
	        	success:true,
	        	records:rs,
	        	totalRecords:count
        	}, 
        	options,
        	true
        );
        this.select(0,true);
    },
    reconfig : function(config){
		this.el.dom.value = (Ext.isEmpty(config.value) ? '' : config.value);
		this.value = config.internalVal;

		var frm = document.forms[this.formId];
		var colName = this.id;
		frm.elements[this.id].value = config.internalVal;

		this.setDisabled(config.disabled);
		if( Ext.isBoolean( config.clearCache ) && config.clearCache )
			this.cachestore = null;//字段限制、sql筛选时,丢弃缓存数据
    },
    // private
    initList : function(){
    	LBUI.ctrl.DropOptListField.superclass.initList.call(this);
    	var self = this;
	    // private
	    if( this.pageTb != null ){//数据字典没有翻页
	    	this.pageTb.doLoad = function(start){//?? 翻页处理。如正在搜索,则尝试取cache数据，否则请求服务器数据
		        var o = {}, pn = this.getParams();
		        o[pn.start] = start;
		        o[pn.limit] = this.pageSize;
		        if(this.fireEvent('beforechange', this, o) !== false){
		        	 if( self.lastQuery == null || self.lastQuery.length <= 0)
		            	this.store.load({params:o});
		            else{
	                    if( self.isNeedRemoteQuery() )
	                    {
	                    	//remote query 
	                    	self.doRemoteQuery(null);
	                    }else{
	                    	self.getCachedData(o);
	                    }
	                }
		        }
		    }
		 }
    },
    isNeedRemoteQuery : function(){
    	return this.getCacheStore().hasMore == true 
                    	&& ( this.getCacheStore().getCount() < //getCount()为过滤后记录数 
                    		Math.ceil((this.pageTb.cursor + this.pageTb.pageSize) / this.pageTb.pageSize) * this.pageTb.pageSize 
                    	   );
    },
    setValue : function(v){
        var text = v;
        if(this.valueField){
            var r = this.findRecord(this.valueField, v);
            if(r){
                text = r.data[this.displayField];
            }else if(Ext.isDefined(this.valueNotFoundText)){
                text = this.valueNotFoundText;
            }
        }
        if(Ext.isObject(text)){
			text = LBUI.LBObjDisplay(text);
		 }
        this.lastSelectionText = text;
        if(this.hiddenField){
            this.hiddenField.value = Ext.value(v, '');
        }
        Ext.form.ComboBox.superclass.setValue.call(this, text);
        this.value = v;
		 
        return this;
    },
    validateBlur : function(){
    	return false;
    }
});
Ext.reg('lb.dropoptfield', LBUI.ctrl.DropOptListField);