function mqinit() { var mqtask = { showNotify : function(imgsrc){ var mqmsg = Ext.get('mqmsg').dom;//parent.mqmsg; var mqimg = mqmsg.firstChild; mqimg.src = imgsrc; mqmsg.style.display = "inline"; }, run: function(){ Ext.Ajax.request({ url: '/jsp/mq/refresh.jsp?extResponse=true', success: function(response, opts){ var msgret = null; try{ msgret = Ext.decode(response.responseText,true); }catch(e){return;} if( msgret != null ){ var hasmsg = msgret.hasmsg; if( typeof( hasmsg ) == 'boolean' && hasmsg ) { var msgs = msgret.data; if( msgs != null && msgs.length > 0 ) { try{ mqtask.showNotify( "/images/message/idea.gif" ); }catch(e){} var msghtml = ""; for( var i = 0 ; i < msgs.length ; i ++ ){ var msg = msgs[i]; var sender = msg.sender; var subject = msg.subject; var content = msg.content; msghtml += "[" + sender + "]" + subject + "
" + content ; } } //show dialog showMQDialog(); }else{ var hasHisMsg = msgret.hasHisMsg; if( Ext.isBoolean(hasHisMsg) && hasHisMsg){ mqtask.showNotify( "/images/message/idea.gif" ); }else{ mqtask.showNotify( "/images/message/hsimsg.gif" ); } } } }, failure: function(response, opts ){ }, params: { hasdata: false } }); }, interval: 30000 } Ext.TaskMgr.start(mqtask); } function showMQDialog(){ var w = 500;var h = 200; var l = window.screen.availWidth - w - 20 ; var t = window.screen.availHeight - h - 90 ; var winf = "resizable=yes,status=no,scrollbars=yes,help=no,width=" + w + "px,height=" + h + ",left=" + l + "px,top=" + t + "px"; var url = "/jsp/mq/messageforward.jsp"; window.open( url , "" , winf ); }